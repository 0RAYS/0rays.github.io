import{c as oe,a as d,R as ie,j as e,B as _,m as ee,d as et,t as $,A as tt}from"./index-DZsURnR3.js";import{I as se}from"./IconPlus-DfhceZG2.js";import{I as st}from"./IconSearch-CIRVBDY_.js";import{I as rt}from"./IconUpload-XeyonPFC.js";import{I as nt}from"./IconDownload-Dy-qQzHW.js";import{I as at}from"./IconEdit-BKIlAUJT.js";import{I as Z}from"./IconTrash-vZk-6a6j.js";import{I as it}from"./IconServer-OqmVjE0J.js";import{I as ot}from"./IconChevronRight-DoVJql1Q.js";import{I as ye}from"./IconX-P6o_B2No.js";import{I as lt}from"./IconDeviceFloppy-pHn5aZds.js";import{g as ct,d as dt,s as ut,a as mt,b as pt,c as ft,e as xt,f as ht,h as gt,u as vt,i as bt}from"./challenge-CwzD9jfF.js";import{s as jt}from"./contest-CQjuaOWt.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]],Nt=oe("outline","check","Check",yt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]],kt=oe("outline","chevron-down","ChevronDown",wt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"M9 3l6 0",key:"svg-0"}],["path",{d:"M10 9l4 0",key:"svg-1"}],["path",{d:"M10 3v6l-4 11a.7 .7 0 0 0 .5 1h11a.7 .7 0 0 0 .5 -1l-4 -11v-6",key:"svg-2"}]],Mt=oe("outline","flask","Flask",Ct);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M4 16v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]],_t=oe("outline","maximize","Maximize",zt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M15 19v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M15 5v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M5 15h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M5 9h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]],St=oe("outline","minimize","Minimize",Ot);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["path",{d:"M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3",key:"svg-0"}]],At=oe("outline","shield","Shield",Et);function Lt(t,r,s){return r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Ne(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,n)}return s}function we(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Ne(Object(s),!0).forEach(function(n){Lt(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ne(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Pt(t,r){if(t==null)return{};var s={},n=Object.keys(t),o,p;for(p=0;p<n.length;p++)o=n[p],!(r.indexOf(o)>=0)&&(s[o]=t[o]);return s}function Rt(t,r){if(t==null)return{};var s=Pt(t,r),n,o;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(o=0;o<p.length;o++)n=p[o],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function Ft(t,r){return It(t)||$t(t,r)||Dt(t,r)||Tt()}function It(t){if(Array.isArray(t))return t}function $t(t,r){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var s=[],n=!0,o=!1,p=void 0;try{for(var u=t[Symbol.iterator](),b;!(n=(b=u.next()).done)&&(s.push(b.value),!(r&&s.length===r));n=!0);}catch(P){o=!0,p=P}finally{try{!n&&u.return!=null&&u.return()}finally{if(o)throw p}}return s}}function Dt(t,r){if(t){if(typeof t=="string")return ke(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ke(t,r)}}function ke(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,n=new Array(r);s<r;s++)n[s]=t[s];return n}function Tt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ut(t,r,s){return r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Ce(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,n)}return s}function Me(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Ce(Object(s),!0).forEach(function(n){Ut(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ce(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Vt(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return function(n){return r.reduceRight(function(o,p){return p(o)},n)}}function le(t){return function r(){for(var s=this,n=arguments.length,o=new Array(n),p=0;p<n;p++)o[p]=arguments[p];return o.length>=t.length?t.apply(this,o):function(){for(var u=arguments.length,b=new Array(u),P=0;P<u;P++)b[P]=arguments[P];return r.apply(s,[].concat(o,b))}}}function xe(t){return{}.toString.call(t).includes("Object")}function qt(t){return!Object.keys(t).length}function de(t){return typeof t=="function"}function Gt(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function Ht(t,r){return xe(r)||re("changeType"),Object.keys(r).some(function(s){return!Gt(t,s)})&&re("changeField"),r}function Wt(t){de(t)||re("selectorType")}function Bt(t){de(t)||xe(t)||re("handlerType"),xe(t)&&Object.values(t).some(function(r){return!de(r)})&&re("handlersType")}function Yt(t){t||re("initialIsRequired"),xe(t)||re("initialType"),qt(t)&&re("initialContent")}function Kt(t,r){throw new Error(t[r]||t.default)}var Qt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},re=le(Kt)(Qt),me={changes:Ht,selector:Wt,handler:Bt,initial:Yt};function Xt(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};me.initial(t),me.handler(r);var s={current:t},n=le(es)(s,r),o=le(Zt)(s),p=le(me.changes)(t),u=le(Jt)(s);function b(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(T){return T};return me.selector(L),L(s.current)}function P(L){Vt(n,o,p,u)(L)}return[b,P]}function Jt(t,r){return de(r)?r(t.current):r}function Zt(t,r){return t.current=Me(Me({},t.current),r),r}function es(t,r,s){return de(r)?r(t.current):Object.keys(s).forEach(function(n){var o;return(o=r[n])===null||o===void 0?void 0:o.call(r,t.current[n])}),s}var ts={create:Xt},ss={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function rs(t){return function r(){for(var s=this,n=arguments.length,o=new Array(n),p=0;p<n;p++)o[p]=arguments[p];return o.length>=t.length?t.apply(this,o):function(){for(var u=arguments.length,b=new Array(u),P=0;P<u;P++)b[P]=arguments[P];return r.apply(s,[].concat(o,b))}}}function ns(t){return{}.toString.call(t).includes("Object")}function as(t){return t||ze("configIsRequired"),ns(t)||ze("configType"),t.urls?(is(),{paths:{vs:t.urls.monacoBase}}):t}function is(){console.warn(Oe.deprecation)}function os(t,r){throw new Error(t[r]||t.default)}var Oe={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},ze=rs(os)(Oe),ls={config:as},cs=function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return function(o){return s.reduceRight(function(p,u){return u(p)},o)}};function Se(t,r){return Object.keys(r).forEach(function(s){r[s]instanceof Object&&t[s]&&Object.assign(r[s],Se(t[s],r[s]))}),we(we({},t),r)}var ds={type:"cancelation",msg:"operation is manually canceled"};function ge(t){var r=!1,s=new Promise(function(n,o){t.then(function(p){return r?o(ds):n(p)}),t.catch(o)});return s.cancel=function(){return r=!0},s}var us=ts.create({config:ss,isInitialized:!1,resolve:null,reject:null,monaco:null}),Ee=Ft(us,2),ue=Ee[0],he=Ee[1];function ms(t){var r=ls.config(t),s=r.monaco,n=Rt(r,["monaco"]);he(function(o){return{config:Se(o.config,n),monaco:s}})}function ps(){var t=ue(function(r){var s=r.monaco,n=r.isInitialized,o=r.resolve;return{monaco:s,isInitialized:n,resolve:o}});if(!t.isInitialized){if(he({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),ge(ve);if(window.monaco&&window.monaco.editor)return Ae(window.monaco),t.resolve(window.monaco),ge(ve);cs(fs,hs)(gs)}return ge(ve)}function fs(t){return document.body.appendChild(t)}function xs(t){var r=document.createElement("script");return t&&(r.src=t),r}function hs(t){var r=ue(function(n){var o=n.config,p=n.reject;return{config:o,reject:p}}),s=xs("".concat(r.config.paths.vs,"/loader.js"));return s.onload=function(){return t()},s.onerror=r.reject,s}function gs(){var t=ue(function(s){var n=s.config,o=s.resolve,p=s.reject;return{config:n,resolve:o,reject:p}}),r=window.require;r.config(t.config),r(["vs/editor/editor.main"],function(s){Ae(s),t.resolve(s)},function(s){t.reject(s)})}function Ae(t){ue().monaco||he({monaco:t})}function vs(){return ue(function(t){var r=t.monaco;return r})}var ve=new Promise(function(t,r){return he({resolve:t,reject:r})}),Le={config:ms,init:ps,__getMonacoInstance:vs},bs={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},be=bs,js={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},ys=js;function Ns({children:t}){return ie.createElement("div",{style:ys.container},t)}var ws=Ns,ks=ws;function Cs({width:t,height:r,isEditorReady:s,loading:n,_ref:o,className:p,wrapperProps:u}){return ie.createElement("section",{style:{...be.wrapper,width:t,height:r},...u},!s&&ie.createElement(ks,null,n),ie.createElement("div",{ref:o,style:{...be.fullWidth,...!s&&be.hide},className:p}))}var Ms=Cs,Pe=d.memo(Ms);function zs(t){d.useEffect(t,[])}var Re=zs;function _s(t,r,s=!0){let n=d.useRef(!0);d.useEffect(n.current||!s?()=>{n.current=!1}:t,r)}var X=_s;function ce(){}function ae(t,r,s,n){return Os(t,n)||Ss(t,r,s,n)}function Os(t,r){return t.editor.getModel(Fe(t,r))}function Ss(t,r,s,n){return t.editor.createModel(r,s,n?Fe(t,n):void 0)}function Fe(t,r){return t.Uri.parse(r)}function Es({original:t,modified:r,language:s,originalLanguage:n,modifiedLanguage:o,originalModelPath:p,modifiedModelPath:u,keepCurrentOriginalModel:b=!1,keepCurrentModifiedModel:P=!1,theme:L="light",loading:T="Loading...",options:V={},height:Q="100%",width:D="100%",className:G,wrapperProps:H={},beforeMount:F=ce,onMount:Y=ce}){let[O,q]=d.useState(!1),[k,z]=d.useState(!0),R=d.useRef(null),S=d.useRef(null),v=d.useRef(null),j=d.useRef(Y),f=d.useRef(F),c=d.useRef(!1);Re(()=>{let h=Le.init();return h.then(a=>(S.current=a)&&z(!1)).catch(a=>(a==null?void 0:a.type)!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>R.current?I():h.cancel()}),X(()=>{if(R.current&&S.current){let h=R.current.getOriginalEditor(),a=ae(S.current,t||"",n||s||"text",p||"");a!==h.getModel()&&h.setModel(a)}},[p],O),X(()=>{if(R.current&&S.current){let h=R.current.getModifiedEditor(),a=ae(S.current,r||"",o||s||"text",u||"");a!==h.getModel()&&h.setModel(a)}},[u],O),X(()=>{let h=R.current.getModifiedEditor();h.getOption(S.current.editor.EditorOption.readOnly)?h.setValue(r||""):r!==h.getValue()&&(h.executeEdits("",[{range:h.getModel().getFullModelRange(),text:r||"",forceMoveMarkers:!0}]),h.pushUndoStop())},[r],O),X(()=>{var h,a;(a=(h=R.current)==null?void 0:h.getModel())==null||a.original.setValue(t||"")},[t],O),X(()=>{let{original:h,modified:a}=R.current.getModel();S.current.editor.setModelLanguage(h,n||s||"text"),S.current.editor.setModelLanguage(a,o||s||"text")},[s,n,o],O),X(()=>{var h;(h=S.current)==null||h.editor.setTheme(L)},[L],O),X(()=>{var h;(h=R.current)==null||h.updateOptions(V)},[V],O);let N=d.useCallback(()=>{var l;if(!S.current)return;f.current(S.current);let h=ae(S.current,t||"",n||s||"text",p||""),a=ae(S.current,r||"",o||s||"text",u||"");(l=R.current)==null||l.setModel({original:h,modified:a})},[s,r,o,t,n,p,u]),g=d.useCallback(()=>{var h;!c.current&&v.current&&(R.current=S.current.editor.createDiffEditor(v.current,{automaticLayout:!0,...V}),N(),(h=S.current)==null||h.editor.setTheme(L),q(!0),c.current=!0)},[V,L,N]);d.useEffect(()=>{O&&j.current(R.current,S.current)},[O]),d.useEffect(()=>{!k&&!O&&g()},[k,O,g]);function I(){var a,l,C,x;let h=(a=R.current)==null?void 0:a.getModel();b||((l=h==null?void 0:h.original)==null||l.dispose()),P||((C=h==null?void 0:h.modified)==null||C.dispose()),(x=R.current)==null||x.dispose()}return ie.createElement(Pe,{width:D,height:Q,isEditorReady:O,loading:T,_ref:v,className:G,wrapperProps:H})}var As=Es;d.memo(As);function Ls(t){let r=d.useRef();return d.useEffect(()=>{r.current=t},[t]),r.current}var Ps=Ls,pe=new Map;function Rs({defaultValue:t,defaultLanguage:r,defaultPath:s,value:n,language:o,path:p,theme:u="light",line:b,loading:P="Loading...",options:L={},overrideServices:T={},saveViewState:V=!0,keepCurrentModel:Q=!1,width:D="100%",height:G="100%",className:H,wrapperProps:F={},beforeMount:Y=ce,onMount:O=ce,onChange:q,onValidate:k=ce}){let[z,R]=d.useState(!1),[S,v]=d.useState(!0),j=d.useRef(null),f=d.useRef(null),c=d.useRef(null),N=d.useRef(O),g=d.useRef(Y),I=d.useRef(),h=d.useRef(n),a=Ps(p),l=d.useRef(!1),C=d.useRef(!1);Re(()=>{let m=Le.init();return m.then(w=>(j.current=w)&&v(!1)).catch(w=>(w==null?void 0:w.type)!=="cancelation"&&console.error("Monaco initialization: error:",w)),()=>f.current?M():m.cancel()}),X(()=>{var w,U,J,te;let m=ae(j.current,t||n||"",r||o||"",p||s||"");m!==((w=f.current)==null?void 0:w.getModel())&&(V&&pe.set(a,(U=f.current)==null?void 0:U.saveViewState()),(J=f.current)==null||J.setModel(m),V&&((te=f.current)==null||te.restoreViewState(pe.get(p))))},[p],z),X(()=>{var m;(m=f.current)==null||m.updateOptions(L)},[L],z),X(()=>{!f.current||n===void 0||(f.current.getOption(j.current.editor.EditorOption.readOnly)?f.current.setValue(n):n!==f.current.getValue()&&(C.current=!0,f.current.executeEdits("",[{range:f.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),f.current.pushUndoStop(),C.current=!1))},[n],z),X(()=>{var w,U;let m=(w=f.current)==null?void 0:w.getModel();m&&o&&((U=j.current)==null||U.editor.setModelLanguage(m,o))},[o],z),X(()=>{var m;b!==void 0&&((m=f.current)==null||m.revealLine(b))},[b],z),X(()=>{var m;(m=j.current)==null||m.editor.setTheme(u)},[u],z);let x=d.useCallback(()=>{var m;if(!(!c.current||!j.current)&&!l.current){g.current(j.current);let w=p||s,U=ae(j.current,n||t||"",r||o||"",w||"");f.current=(m=j.current)==null?void 0:m.editor.create(c.current,{model:U,automaticLayout:!0,...L},T),V&&f.current.restoreViewState(pe.get(w)),j.current.editor.setTheme(u),b!==void 0&&f.current.revealLine(b),R(!0),l.current=!0}},[t,r,s,n,o,p,L,T,V,u,b]);d.useEffect(()=>{z&&N.current(f.current,j.current)},[z]),d.useEffect(()=>{!S&&!z&&x()},[S,z,x]),h.current=n,d.useEffect(()=>{var m,w;z&&q&&((m=I.current)==null||m.dispose(),I.current=(w=f.current)==null?void 0:w.onDidChangeModelContent(U=>{C.current||q(f.current.getValue(),U)}))},[z,q]),d.useEffect(()=>{if(z){let m=j.current.editor.onDidChangeMarkers(w=>{var J;let U=(J=f.current.getModel())==null?void 0:J.uri;if(U&&w.find(te=>te.path===U.path)){let te=j.current.editor.getModelMarkers({resource:U});k==null||k(te)}});return()=>{m==null||m.dispose()}}return()=>{}},[z,k]);function M(){var m,w;(m=I.current)==null||m.dispose(),Q?V&&pe.set(p,f.current.saveViewState()):(w=f.current.getModel())==null||w.dispose(),f.current.dispose()}return ie.createElement(Pe,{width:D,height:G,isEditorReady:z,loading:P,_ref:c,className:H,wrapperProps:F})}var Fs=Rs,Is=d.memo(Fs),fe=Is;function $s({challenges:t=[],totalCount:r=0,currentPage:s=1,pageSize:n=10,categories:o=[],filterCategory:p="all",filterType:u="all",onPageChange:b,onAddChallenge:P,onEditChallenge:L,onDeleteChallenge:T,onUploadAttachment:V,onDownloadAttachment:Q,onTestChallenge:D,onFilterTypeChange:G,onFilterCategoryChange:H,searchQuery:F="",searchLoading:Y=!1,isSearchMode:O=!1,onSearchChange:q}){const[k,z]=d.useState({}),R=(c,N)=>{const g=`${c}-${N}`;z(I=>({...I,[g]:!I[g]}))},S=c=>{const g={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[c.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${g}`,children:c})},v=c=>{const g={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-green-400/20 text-green-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[c]||{label:c,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${g.class}`,children:g.label})},j=c=>!c||c.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:c.map((N,g)=>e.jsx("span",{className:"px-2 py-1 bg-black/30 border border-neutral-300/30 rounded text-xs font-mono text-neutral-300",title:N.value,children:N.value.length>15?`${N.value.substring(0,15)}...`:N.value},g))}),f=(c,N)=>!c||c.length===0?null:e.jsxs("div",{className:"mt-3 border-t border-neutral-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(it,{size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm text-neutral-400 font-mono",children:"容器配置："})]}),e.jsx("div",{className:"space-y-2",children:c.map((g,I)=>{const h=`${N}-${I}`,a=k[h];return e.jsxs("div",{className:"p-2 bg-black/40 border border-neutral-300/20 rounded-md text-xs font-mono",children:[e.jsx("div",{className:"flex items-center gap-1 mb-2",children:e.jsxs("span",{className:"text-cyan-400",children:["Docker 组 ",I+1]})}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1 cursor-pointer hover:text-neutral-300 transition-colors",onClick:()=>R(N,I),children:[a?e.jsx(kt,{size:14,className:"text-neutral-400"}):e.jsx(ot,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-neutral-400",children:"YAML 配置"}),e.jsxs("span",{className:"text-neutral-500",children:["(",a?"点击收缩":"点击展开",")"]})]}),a&&e.jsx("div",{className:"border border-neutral-300/20 rounded overflow-hidden",children:e.jsx(fe,{value:g.yaml||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:12,fontFamily:'Consolas, "Courier New", monospace',renderLineHighlight:"none"},height:`${16*g.yaml.split(`
`).length}px`,theme:"vs-dark"})}),!a&&e.jsx("div",{className:"p-2 bg-black/50 border border-neutral-300/20 rounded text-neutral-500 overflow-hidden",children:e.jsx("div",{className:"text-xs",children:g.yaml?e.jsxs(e.Fragment,{children:[g.yaml.split(`
`).slice(0,2).map((l,C)=>e.jsx("div",{className:"truncate",children:l||" "},C)),g.yaml.split(`
`).length>2&&e.jsx("div",{className:"text-neutral-600",children:"..."})]}):e.jsx("div",{className:"truncate",children:"暂无配置"})})})]}),g.network_policies&&g.network_policies.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-700 border-dashed",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(At,{size:12,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400",children:"网络策略:"})]}),e.jsx("div",{className:"space-y-2 pl-2 mt-1",children:g.network_policies.map((l,C)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"mb-1",children:e.jsxs("span",{className:"text-neutral-300",children:["策略 ",C+1]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 pl-2",children:[l.from&&l.from.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"From:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.from.map((x,M)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:x.cidr||"任意"}),x.except&&x.except.length>0&&x.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",x.except.join(", ")]})]},M))})]}),l.to&&l.to.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"To:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.to.map((x,M)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:x.cidr||"任意"}),x.except&&x.except.length>0&&x.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",x.except.join(", ")]})]},M))})]})]})]},C))})]})]},I)})})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"题目管理"}),e.jsx(_,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(se,{size:16}),onClick:P,children:"添加题目"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"搜索题目"}),e.jsxs("div",{className:"relative",children:[e.jsx(st,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:F,placeholder:"输入题目名搜索...",onChange:c=>q==null?void 0:q(c.target.value),className:`w-full h-10 pl-10 pr-10 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`}),Y&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border border-geek-400 border-t-transparent rounded-full animate-spin"})})]})]})})}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex gap-8",children:[{id:"all",label:"全部"},{id:"static",label:"静态题目"},{id:"question",label:"问答题目"},{id:"dynamic",label:"动态题目"},{id:"pods",label:"容器题目"}].map(c=>e.jsxs("div",{className:"relative",children:[e.jsx(_,{variant:u===c.id?"primary":"ghost",size:"sm",className:`!px-2 !min-w-0 !border-0 pb-3 ${u===c.id?"!bg-transparent !text-geek-400":"!text-neutral-400"}`,onClick:()=>G(c.id),children:c.label}),u===c.id&&e.jsx(ee.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]},c.id))})}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:p,onChange:c=>H(c.target.value),className:"select-custom select-custom-sm",children:[e.jsx("option",{value:"all",children:"全部分类"}),o.map(c=>e.jsx("option",{value:c,children:c},c))]})})})]})}),t.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:O?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-neutral-300/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("span",{className:"font-mono text-neutral-400",children:"未找到匹配的题目"})]}):e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:t.map(c=>e.jsx(ee.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:c.name}),e.jsxs("div",{className:"flex gap-2",children:[S(c.category),v(c.type)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>V(c),children:e.jsx(rt,{size:18})}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>Q(c),children:e.jsx(nt,{size:18})}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-orange-400 hover:!text-orange-300",onClick:()=>D(c),title:"测试题目",children:e.jsx(Mt,{size:18})}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>L(c),children:e.jsx(at,{size:18})}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>T(c),children:e.jsx(Z,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:c.desc}),c.type!=="pods"&&c.type!=="question"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"Flags:"}),j(c.flags)]}),c.type==="pods"&&f(c.dockers,c.id||c.name)]})},c.id||c.name))}),!O&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",disabled:s===1,onClick:()=>b(s>1?s-1:1),className:s===1?"!border-neutral-700 !text-neutral-600":"",children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[s," / ",Math.ceil(r/n)]}),e.jsx(_,{variant:"ghost",size:"sm",disabled:s>=Math.ceil(r/n),onClick:()=>b(s<Math.ceil(r/n)?s+1:Math.ceil(r/n)),className:s>=Math.ceil(r/n)?"!border-neutral-700 !text-neutral-600":"",children:"下一页"})]})})]})}const ne=`
services:
  service1:
    container_name: service1
    image: nicolaka/netshoot:latest
    ports:
      - "80:80/tcp"
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=static{static_flag}
    volumes:
      - FLAG_0:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network1:
        ipv4_address: 192.168.0.2

  service2:
    container_name: service2
    image: nicolaka/netshoot:latest
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=dynamic{dynamic_flag}
    volumes:
      - FLAG_1:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network1:
        ipv4_address: 192.168.0.3
      network2:
        ipv4_address: 192.168.1.3

  service3:
    container_name: service3
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=uuid{}
    volumes:
      - FLAG_2:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network2:
        ipv4_address: 192.168.1.4
      network3:
        ipv4_address: 192.168.2.4

volumes:
  FLAG_0:
    labels:
      - value=static{static_flag}
  FLAG_1:
    labels:
      - value=dynamic{dynamic_flag}
  FLAG_2:
    labels:
      - value=uuid{}

networks:
  network1:
    external: true
    ipam:
      config:
        - subnet: 192.168.0.0/24
          gateway: 192.168.0.1

  network2:
    ipam:
      config:
        - subnet: 192.168.1.0/24
          gateway: 192.168.1.1

  network3:
    ipam:
      config:
        - subnet: 192.168.2.0/24
          gateway: 192.168.2.1
`.trim();function Ds({isOpen:t=!1,mode:r="add",challenge:s={name:"",desc:"",category:"",type:"static",generator_image:"",flags:[""],options:[],docker_compose:"",network_policies:[{from:[{cidr:"",except:[""]}],to:[{cidr:"",except:[""]}]}]},categories:n=[],onClose:o,onSubmit:p,onChange:u,onAddFlag:b,onRemoveFlag:P,onFlagChange:L,onAddOption:T,onRemoveOption:V,onOptionChange:Q,onCorrectOptionChange:D}){const[G,H]=d.useState({isOpen:!1,value:""}),F=()=>{H({isOpen:!0,value:s.docker_compose||ne})};d.useEffect(()=>{s.type==="pods"&&!s.docker_compose&&u({...s,docker_compose:ne})},[s.type,s.docker_compose,u]);const Y=()=>{H({isOpen:!1,value:""})},O=()=>{const a=G.value||ne;u({...s,docker_compose:a}),Y()},q=a=>{H({...G,value:a})},k=a=>{u({...s,docker_compose:a||ne})},z=()=>{const a=[...s.network_policies||[],{from:[{cidr:"",except:[""]}],to:[{cidr:"0.0.0.0/0",except:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10"]}]}];u({...s,network_policies:a})},R=a=>{const l=s.network_policies.filter((C,x)=>x!==a);u({...s,network_policies:l})},S=(a,l)=>{const C=[...s.network_policies],x={...C[a]};x[l]=[...x[l],{cidr:"",except:[""]}],C[a]=x,u({...s,network_policies:C})},v=(a,l,C)=>{const x=[...s.network_policies],M={...x[a]};M[l]=M[l].filter((m,w)=>w!==C),x[a]=M,u({...s,network_policies:x})},j=(a,l,C,x)=>{const M=[...s.network_policies],m={...M[a]},w={...m[l][C]};w.cidr=x,m[l]=[...m[l]],m[l][C]=w,M[a]=m,u({...s,network_policies:M})},f=(a,l,C)=>{const x=[...s.network_policies],M={...x[a]},m={...M[l][C]};m.except=[...m.except,""],M[l]=[...M[l]],M[l][C]=m,x[a]=M,u({...s,network_policies:x})},c=(a,l,C,x)=>{const M=[...s.network_policies],m={...M[a]},w={...m[l][C]};w.except=w.except.filter((U,J)=>J!==x),m[l]=[...m[l]],m[l][C]=w,M[a]=m,u({...s,network_policies:M})},N=(a,l,C,x,M)=>{const m=[...s.network_policies],w={...m[a]},U={...w[l][C]};U.except=[...U.except],U.except[x]=M,w[l]=[...w[l]],w[l][C]=U,m[a]=w,u({...s,network_policies:m})};d.useEffect(()=>{const a=l=>{G.isOpen&&(l.key==="Escape"?Y():l.ctrlKey&&l.key==="s"&&(l.preventDefault(),O()))};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[G.isOpen,G.value]);const g="w-full h-10 bg-black/20 border border-neutral-300/30 rounded-md px-4 text-neutral-50 focus:outline-none focus:border-geek-400",I="select-custom select-custom-md",h="w-full h-20 bg-black/20 border border-neutral-300/30 rounded-md px-4 py-2 text-neutral-50 focus:outline-none focus:border-geek-400 resize-none";return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:[e.jsxs(ee.div,{className:"w-full max-w-4xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:r==="add"?"添加题目":r==="edit"?"编辑题目":"删除题目"}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:o,children:e.jsx(ye,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:r==="delete"?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-red-400/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(Z,{size:40,className:"text-red-400"})}),e.jsx("h3",{className:"text-2xl font-mono text-neutral-50 mb-4",children:"确认删除题目"}),e.jsx("p",{className:"text-neutral-400 font-mono text-lg mb-2",children:"您确定要删除这个题目吗？"}),e.jsx("p",{className:"text-red-400 font-mono text-sm",children:"⚠️ 此操作无法撤销，请谨慎操作"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>u({...s,name:a.target.value}),className:g,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目分类"}),e.jsx("input",{type:"text",value:s.category,onChange:a=>u({...s,category:a.target.value}),className:I,placeholder:"请选择分类",list:"category-options"}),e.jsx("datalist",{id:"category-options",children:n.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目类型"}),e.jsxs("select",{value:s.type,onChange:a=>u({...s,type:a.target.value}),className:I,children:[e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"question",children:"问答题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:s.desc,onChange:a=>u({...s,desc:a.target.value}),className:h,placeholder:"输入题目描述内容"})]})]})]}),s.type==="dynamic"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"生成器镜像"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Generator镜像地址"}),e.jsx("input",{type:"text",value:s.generator_image,onChange:a=>u({...s,generator_image:a.target.value}),className:g,placeholder:"输入Generator镜像地址"})]})]}),s.type!=="pods"&&s.type!=="question"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag设置"}),e.jsx(_,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(se,{size:16}),onClick:b,children:"添加Flag"})]}),e.jsx("div",{className:"space-y-3",children:s.flags.map((a,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:typeof a=="string"?a:a.value||"",onChange:C=>L(l,C.target.value),className:g,placeholder:`Flag ${l+1}`}),s.flags.length>1&&e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>P(l),children:e.jsx(Z,{size:18})})]},l))})]}),s.type==="question"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"选项设置"}),e.jsx(_,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(se,{size:16}),onClick:T,children:"添加选项"})]}),e.jsxs("div",{className:"space-y-3",children:[(s.options||[]).map((a,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1 flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:a.content||"",onChange:C=>Q(l,C.target.value),className:g,placeholder:`选项 ${l+1}`}),e.jsx(_,{variant:a.correct?"primary":"ghost",size:"icon",className:`!bg-transparent ${a.correct?"!text-green-400 hover:!text-green-300":"!text-red-400 hover:!text-red-300"}`,onClick:()=>D(l),title:a.correct?"取消正确答案":"设为正确答案",children:a.correct?e.jsx(Nt,{size:18}):e.jsx(ye,{size:18})})]}),(s.options||[]).length>1&&e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>V(l),children:e.jsx(Z,{size:18})})]},a.rand_id||l)),(s.options||[]).length===0&&e.jsx("div",{className:"text-center py-4 text-neutral-500 font-mono text-sm",children:"暂无选项，请添加选项"})]})]}),s.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"docker-compose注意事项"}),e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-400 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 volumes.FLAG_x.labels.value 字段指定值",e.jsx("br",{}),e.jsx("br",{}),"services参数只接受: image, expose, ports, environment, volumes, working_dir, command, cpus, mem_limit",e.jsx("br",{}),e.jsx("br",{}),"可通过networks配置多个网段, 每个容器可占据多个网段",e.jsx("br",{}),"当设置networks时, 每个容器必须指定所使用的network; 不指定时具体IP时, 随机从定义的网段中选取",e.jsx("br",{}),"当不设置networks时, 容器之间共用同一个随机IP地址, 容器间通信请使用本地地址: 127.0.0.1",e.jsx("br",{}),"共用IP地址时, 请注意端口唯一性",e.jsx("br",{}),e.jsx("br",{}),"下述示例中包含了所有可接受字段, 未在其中的字段将被忽略; 务必使用2个空格进行缩进"]})})]}),s.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"容器设置"}),r==="edit"&&e.jsx("span",{className:"text-xs text-neutral-500",children:"容器配置仅在创建时确定"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border border-neutral-700 rounded-md p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["docker-compose.yaml",r==="edit"&&e.jsx("span",{className:"ml-2 text-xs text-neutral-500",children:"(只读)"})]}),r==="add"&&e.jsx(_,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_t,{size:14}),className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300 !text-xs",onClick:F,children:"全屏编辑"})]}),r==="add"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(fe,{value:s.docker_compose||ne,onChange:k,language:"yaml",options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:`${19*(s.docker_compose||ne).split(`
`).length}px`,theme:"vs-dark"})}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 labels value 字段指定值",e.jsx("br",{}),"Docker参数只接受: image, expose, ports, environment, volumes, working_dir, command",e.jsx("br",{}),"同一道题目中, 所有的容器名必须唯一, 作为唯一 DNS Hostname",e.jsx("br",{}),"容器间通过 Hostname 或 本地地址 通信"]})]}):e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(fe,{value:s.docker_compose||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:`${19*(s.docker_compose||ne).split(`
`).length}px`,theme:"vs-dark"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"网络策略"}),e.jsx(_,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:z,children:"添加策略"})]}),e.jsx("div",{className:"space-y-4",children:(s.network_policies||[]).map((a,l)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-3 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h5",{className:"text-sm font-mono text-neutral-200",children:["策略 ",l+1]}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>R(l),children:e.jsx(Z,{size:16})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"允许入站"}),e.jsx(_,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>S(l,"from"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(a.from||[]).map((C,x)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),a.from.length>1&&e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>v(l,"from",x),children:e.jsx(Z,{size:12})})]}),e.jsx("input",{type:"text",value:C.cidr,onChange:M=>j(l,"from",x,M.target.value),className:"w-full h-8 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"192.168.1.0/24"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"排除列表"}),e.jsx(_,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>f(l,"from",x),children:"添加排除"})]}),e.jsx("div",{className:"space-y-1",children:(C.except||[]).map((M,m)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"text",value:M,onChange:w=>N(l,"from",x,m,w.target.value),className:"flex-1 h-6 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"192.168.1.1"}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300 !w-6 !h-6",onClick:()=>c(l,"from",x,m),children:e.jsx(Z,{size:10})})]},m))})]})]},x))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"允许出站"}),e.jsx(_,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>S(l,"to"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(a.to||[]).map((C,x)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),a.to.length>1&&e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>v(l,"to",x),children:e.jsx(Z,{size:12})})]}),e.jsx("input",{type:"text",value:C.cidr,onChange:M=>j(l,"to",x,M.target.value),className:"w-full h-8 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"0.0.0.0/0"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"排除列表"}),e.jsx(_,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>f(l,"to",x),children:"添加排除"})]}),e.jsx("div",{className:"space-y-1",children:(C.except||[]).map((M,m)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"text",value:M,onChange:w=>N(l,"to",x,m,w.target.value),className:"flex-1 h-6 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"10.0.0.0/8"}),e.jsx(_,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300 !w-6 !h-6",onClick:()=>c(l,"to",x,m),children:e.jsx(Z,{size:10})})]},m))})]})]},x))})]})]},l))})]})]})})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:o,children:"取消"}),e.jsx(_,{variant:"primary",size:"sm",onClick:()=>p(s),children:r==="add"?"添加题目":r==="edit"?"保存更改":"确认删除"})]})]}),G.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center",children:e.jsxs(ee.div,{className:"w-[95vw] h-[95vh] bg-neutral-900 border border-neutral-700 rounded-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"全屏编辑 - docker-compose.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"primary",size:"sm",onClick:O,children:[e.jsx(lt,{size:16,className:"mr-2"}),"保存 (Ctrl+S)"]}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:Y,children:[e.jsx(St,{size:16,className:"mr-2"}),"退出 (Esc)"]})]})]}),e.jsx("div",{className:"flex-1 h-full",children:e.jsx(fe,{value:G.value,onChange:q,language:"yaml",options:{readOnly:!1,minimap:{enabled:!0},scrollBeyondLastLine:!1,lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:16,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:"calc(95vh - 70px)",theme:"vs-dark"})})]})})]}):null}const Ts=t=>{t=Math.floor(t);const r=Math.floor(t/3600),s=Math.floor(t%3600/60),n=Math.floor(t%60);return`${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`};function Us({challenge:t,isOpen:r,onClose:s}){var R,S;const[n,o]=d.useState({status:!1,downloading:!1,starting:!1,stopping:!1}),[p,u]=d.useState(null),[b,P]=d.useState(null),[L,T]=d.useState(0),[V,Q]=d.useState({}),D=d.useRef(null),{addMessageHandler:G}=et();d.useEffect(()=>G(v=>{if(v.type==="start_victim"||v.type==="stop_victim"){o(f=>({...f,starting:!1,stopping:!1})),H(!1);const j={start_victim:"靶机启动完成",stop_victim:"靶机停止完成"};j[v.type]&&$.success({description:j[v.type]})}}),[G]);const H=d.useCallback(async(v=!1)=>{var j,f,c;if(t!=null&&t.id){o(N=>({...N,status:!0})),u(null);try{const N=await ct(t.id);N.code===200?(P(N.data),(j=N.data.remote)!=null&&j.remaining&&T(N.data.remote.remaining),v&&$.success({description:"状态刷新成功"})):(u(N.msg||"获取测试状态失败"),$.danger({description:N.msg||"获取测试状态失败"}))}catch(N){console.error("获取测试状态失败:",N);const g=((c=(f=N.response)==null?void 0:f.data)==null?void 0:c.msg)||N.message||"获取测试状态失败";u(g),$.danger({description:g})}finally{o(N=>({...N,status:!1}))}}},[t==null?void 0:t.id]);d.useEffect(()=>{r&&(t!=null&&t.id)&&H(!1)},[r,t==null?void 0:t.id,H]),d.useEffect(()=>{r||(u(null),P(null),T(0),Q({}),D.current&&(clearInterval(D.current),D.current=null))},[r]),d.useEffect(()=>{var v;(v=b==null?void 0:b.remote)!=null&&v.remaining&&T(b.remote.remaining)},[(R=b==null?void 0:b.remote)==null?void 0:R.remaining]),d.useEffect(()=>{var j;if(!(!b||!r||!(((j=b.remote)==null?void 0:j.status)==="Running")||!L))return D.current&&clearInterval(D.current),D.current=setInterval(()=>{T(f=>f<=0?(clearInterval(D.current),0):f-1)},1e3),()=>{D.current&&clearInterval(D.current)}},[(S=b==null?void 0:b.remote)==null?void 0:S.status,r,L]);const F=d.useCallback(async(v,j,...f)=>{var c,N;u(null),o(g=>({...g,[v]:!0}));try{const g=await j(...f);g.code===200?(await H(!1),$.success({description:"任务下发成功"})):(u(g.msg||"操作失败"),$.danger({description:g.msg||"操作失败"}))}catch(g){console.error("操作失败:",g);const I=((N=(c=g.response)==null?void 0:c.data)==null?void 0:N.msg)||g.message||"操作失败";u(I),$.danger({description:I})}finally{v!=="starting"&&v!=="stopping"&&o(g=>({...g,[v]:!1}))}},[H]),Y=d.useCallback(async()=>{if(t!=null&&t.id){o(v=>({...v,downloading:!0}));try{const v=await dt(t.id),j=window.URL.createObjectURL(new Blob([v.data])),f=document.createElement("a");f.href=j,f.setAttribute("download","test_attachment.zip"),document.body.appendChild(f),f.click(),f.remove(),window.URL.revokeObjectURL(j),$.success({description:"测试附件下载成功"})}catch(v){console.error("下载测试附件失败:",v),u("下载测试附件失败"),$.danger({description:"下载测试附件失败"})}finally{o(v=>({...v,downloading:!1}))}}},[t==null?void 0:t.id]),O=()=>{F("starting",ut,t.id)},q=()=>{F("stopping",mt,t.id)},k=d.useCallback(v=>{navigator.clipboard.writeText(v),Q(j=>({...j,[v]:!0})),$.success({description:"IP地址已复制到剪贴板"}),setTimeout(()=>{Q(j=>({...j,[v]:!1}))},2e3)},[]),z=d.useCallback(()=>{var f,c;if(!b)return null;const v=((f=b.remote)==null?void 0:f.status)==="Running",j=((c=b.remote)==null?void 0:c.target)||[];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${v?"bg-green-400":"bg-neutral-400"}`}),e.jsx("span",{className:"text-neutral-50 font-mono text-sm",children:v?"RUNNING":"NOT RUNNING"})]}),v&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Time:"}),e.jsx("span",{className:"text-yellow-400 font-mono text-sm",children:Ts(L)})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsx(_,{variant:"danger",size:"sm",onClick:q,disabled:n.stopping,loading:n.stopping,children:n.stopping?"STOPPING...":"STOP INSTANCE"}):e.jsx(_,{variant:"primary",size:"sm",onClick:O,disabled:n.starting,loading:n.starting,className:n.starting?"border-yellow-400 text-yellow-400":"",children:n.starting?"LAUNCHING...":"LAUNCH INSTANCE"})})]}),v&&e.jsx("div",{className:"h-1.5 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx(ee.div,{className:"h-full bg-yellow-400",initial:{width:0},animate:{width:`${Math.max(0,Math.min(100,L/3600*100))}%`},transition:{duration:.5}})}),v&&j.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between p-2 bg-neutral-900 rounded-md",children:e.jsx("span",{className:"text-neutral-400 text-xs",children:"Address:"})}),j.map((N,g)=>e.jsxs("div",{className:"flex justify-between p-1.5",children:[e.jsx("span",{className:"font-mono text-neutral-50 text-sm cursor-pointer",onClick:()=>k(N),children:N}),e.jsx(_,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-geek-400",onClick:()=>k(N),children:V[N]?"✓":"📋"})]},g))]})]})},[b,L,n.starting,n.stopping,O,q,k,V]);return r?e.jsx(tt,{children:r&&e.jsxs("div",{className:"fixed inset-0 z-[900] flex items-center justify-center",children:[e.jsx(ee.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{u(null),s()}}),e.jsx("div",{className:"relative z-10 w-full max-w-[800px] p-4",children:e.jsxs(ee.div,{className:"relative w-full bg-black/80 border border-neutral-300 rounded-md",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-5 border-b border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:"测试"}),e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono",children:t==null?void 0:t.name}),e.jsx("span",{className:"text-yellow-400 font-mono",children:t==null?void 0:t.type})]}),e.jsx(_,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-50",onClick:()=>{u(null),s()},children:"✕"})]})}),e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-1.5 flex-1 min-w-0",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Description"}),e.jsx("p",{className:"text-neutral-50",children:t==null?void 0:t.desc})]})}),p&&e.jsx(ee.div,{className:"text-red-400 text-sm mt-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:p}),((t==null?void 0:t.type)==="dynamic"||(b==null?void 0:b.file)!=="")&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"测试附件"}),e.jsx("div",{className:"space-y-1.5",children:e.jsxs(ee.div,{className:`flex items-center gap-2 p-2 border border-neutral-300/30 rounded-md\r
                                  text-neutral-300 hover:text-geek-400 hover:border-geek-400\r
                                  transition-colors duration-200 cursor-pointer`,whileHover:{x:5},onClick:Y,children:[e.jsx("span",{className:"text-sm",children:"📎"}),e.jsx("span",{className:"font-mono text-sm",children:"test_attachment.zip"}),e.jsx("span",{className:"text-neutral-400 text-sm ml-auto",children:n.downloading?"GENERATING...":"生成并下载"})]})})]}),(t==null?void 0:t.type)==="pods"&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"测试靶机"}),z()]})]})]})})]})}):null}const W=[];for(let t=0;t<256;++t)W.push((t+256).toString(16).slice(1));function Vs(t,r=0){return(W[t[r+0]]+W[t[r+1]]+W[t[r+2]]+W[t[r+3]]+"-"+W[t[r+4]]+W[t[r+5]]+"-"+W[t[r+6]]+W[t[r+7]]+"-"+W[t[r+8]]+W[t[r+9]]+"-"+W[t[r+10]]+W[t[r+11]]+W[t[r+12]]+W[t[r+13]]+W[t[r+14]]+W[t[r+15]]).toLowerCase()}let je;const qs=new Uint8Array(16);function Gs(){if(!je){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");je=crypto.getRandomValues.bind(crypto)}return je(qs)}const Hs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_e={randomUUID:Hs};function Ws(t,r,s){var o;if(_e.randomUUID&&!t)return _e.randomUUID();t=t||{};const n=t.random??((o=t.rng)==null?void 0:o.call(t))??Gs();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Vs(n)}const Bs=()=>Ws();function or(){const[t,r]=d.useState([]),[s,n]=d.useState(0),[o,p]=d.useState(1),[u,b]=d.useState("all"),[P,L]=d.useState([]),[T,V]=d.useState("all"),[Q,D]=d.useState(!1),[G,H]=d.useState(!1),[F,Y]=d.useState("add"),[O,q]=d.useState(null),[k,z]=d.useState({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],options:[],docker_compose:"",network_policies:[]}),R=d.useRef(null),S=10,[v,j]=d.useState(""),[f,c]=d.useState([]),[N,g]=d.useState(!1),[I,h]=d.useState(!1);d.useEffect(()=>{a()},[]),d.useEffect(()=>{I||l()},[o,u,T,I]);const a=async()=>{try{const i=await pt();if(i.code===200){const y=["Web","Misc","Pwn","Crypto","Reverse"],E=[...new Set([...y,...i.data||[]])];L(E)}else L(["Web","Misc","Pwn","Crypto","Reverse"])}catch(i){console.error("获取题目分类失败:",i),$.danger({description:"获取题目分类失败"}),L(["Web","Misc","Pwn","Crypto","Reverse"])}},l=async()=>{try{const i={limit:S,offset:(o-1)*S};u!=="all"&&(i.type=u),T!=="all"&&(i.category=T);const y=await ft(i);y.code===200?(r(y.data.challenges.map(E=>{let A=[];return E.flags&&Array.isArray(E.flags)?A=E.flags:E.flag?A=[E.flag]:A=[""],{...E,flags:A,options:E.options||[]}})),n(y.data.count)):$.danger({description:y.msg||"获取题目列表失败"})}catch(i){$.danger({description:"获取题目列表失败"}),console.error(i)}},C=async i=>{if(!i||i.trim()===""){c([]),h(!1);return}g(!0);try{const y=await jt({model:"challenge",name:i.trim(),limit:10,offset:0,type:u!=="all"?u:"",category:T!=="all"?T:""});if(y.code===200){const A=(y.data.results||[]).map(K=>{let B=[];return K.flags&&Array.isArray(K.flags)?B=K.flags:K.flag?B=[K.flag]:B=[""],{...K,flags:B,options:K.options||[]}});c(A),h(!0)}else $.danger({description:y.msg||"搜索失败"}),c([]),h(!1)}catch(y){console.error("搜索失败:",y),$.danger({description:"搜索失败"}),c([]),h(!1)}finally{g(!1)}},x=(()=>{let i;return y=>{clearTimeout(i),i=setTimeout(()=>{C(y)},300)}})(),M=i=>{j(i),!i||i.trim()===""?(h(!1),c([])):x(i)},m=i=>{b(i),p(1),h(!1),j(""),c([])},w=i=>{V(i),p(1),h(!1),j(""),c([])},U=()=>{Y("add"),z({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],options:[],docker_compose:"",network_policies:[]}),D(!0)},J=i=>{Y("edit"),q(i),z({...i,options:i.options||[]}),D(!0)},te=i=>{Y("delete"),q(i),D(!0)},Ie=i=>{var y;(y=R.current)==null||y.click(),q(i)},$e=async i=>{try{const y=await xt(i.id,"attachment.zip"),E=window.URL.createObjectURL(new Blob([y.data])),A=document.createElement("a");A.href=E,A.setAttribute("download","attachment.zip"),document.body.appendChild(A),A.click(),A.remove()}catch(y){console.error("下载附件失败:",y),$.danger({description:"下载附件失败"})}},De=i=>{q(i),H(!0)},Te=async i=>{var E;const y=(E=i.target.files)==null?void 0:E[0];if(i.target.value="",!!y){if(O.type==="static"&&y.name!=="attachment.zip"||O.type==="question"&&y.name!=="attachment.zip"||O.type==="dynamic"&&y.name!=="generator.zip"||O.type==="pods"&&y.name!=="attachment.zip"){$.danger({description:"文件名必须与题目类型匹配"});return}try{const A=await bt(O.id,y);A.code===200?$.success({description:"上传附件成功"}):$.danger({description:A.msg||"上传附件失败"})}catch(A){console.error("上传附件失败:",A),$.danger({description:"上传附件失败"})}}},Ue=i=>{i.type!==k.type&&(i.type==="pods"?i.flags=[]:k.type==="pods"&&(i.flags=[{id:0,value:""}]),i.type==="question"&&(i.options=[])),z(i)},Ve=()=>{k.type!=="pods"&&z({...k,flags:[...k.flags||[],{id:0,value:""}]})},qe=i=>{if(k.type==="pods")return;const y=[...k.flags||[]];y.splice(i,1),z({...k,flags:y})},Ge=(i,y)=>{if(k.type==="pods")return;const E=[...k.flags||[]];E[i]={id:k.flags[i]&&k.flags[i].id||0,value:y},z({...k,flags:E})},He=()=>{if(k.type!=="question")return;const i=[...k.options||[]];i.push({rand_id:Bs(),content:"",correct:!1}),z({...k,options:i})},We=i=>{if(k.type!=="question")return;const y=[...k.options||[]];y.splice(i,1),z({...k,options:y})},Be=(i,y)=>{if(k.type!=="question")return;const E=[...k.options||[]];E[i]={...E[i],content:y},z({...k,options:E})},Ye=i=>{if(k.type!=="question")return;const y=[...k.options||[]];y[i].correct=!y[i].correct,z({...k,options:y})},Ke=()=>{D(!1)},Qe=()=>{H(!1)},Xe=async i=>{var y;try{let E;if(F==="delete")E=await ht(O.id);else{const A={name:i.name,desc:i.desc,category:i.category,type:i.type};i.type==="question"&&(A.options=i.options||[]);let K;if(i.type==="pods"?K=[]:F==="add"?K=i.flags.map(B=>typeof B=="string"?B:B.value||""):F==="edit"&&(K=i.flags.map(B=>typeof B=="string"?{id:0,value:B}:{id:B.id||0,value:B.value||""})),i.type==="static")A.flags=K||[];else if(i.type==="dynamic")A.flags=K||[],A.generator_image=i.generator_image||"";else if(i.type==="pods")A.docker_compose=i.docker_compose||"",A.generator_image=i.generator_image||"",A.flags=K,A.network_policies=((y=i.network_policies)==null?void 0:y.map(B=>({from:B.from||[],to:B.to||[]})))||[];else if(i.type==="question")A.flags=[],A.options=i.options||[];else{$.danger({description:"错误的题目类型"});return}F==="add"?E=await gt(A):F==="edit"&&(E=await vt(O.id,A))}E.code===200?($.success({description:`${F==="add"?"创建":F==="edit"?"更新":"删除"}题目成功`}),D(!1),await l()):$.danger({description:E.msg||`${F==="add"?"创建":F==="edit"?"更新":"删除"}题目失败`})}catch(E){console.error(`${F==="add"?"创建":F==="edit"?"更新":"删除"}题目失败:`,E),$.danger({description:`${F==="add"?"创建":F==="edit"?"更新":"删除"}题目失败`})}},Je=I?f:t,Ze=I?f.length:s;return e.jsxs(e.Fragment,{children:[e.jsx($s,{challenges:Je,totalCount:Ze,currentPage:o,pageSize:S,categories:P,filterCategory:T,filterType:u,onPageChange:p,onAddChallenge:U,onEditChallenge:J,onDeleteChallenge:te,onUploadAttachment:Ie,onDownloadAttachment:$e,onTestChallenge:De,onFilterTypeChange:m,onFilterCategoryChange:w,searchQuery:v,searchLoading:N,isSearchMode:I,onSearchChange:M}),e.jsx(Ds,{isOpen:Q,mode:F,challenge:k,categories:P,onClose:Ke,onSubmit:Xe,onChange:Ue,onAddFlag:Ve,onRemoveFlag:qe,onFlagChange:Ge,onAddOption:He,onRemoveOption:We,onOptionChange:Be,onCorrectOptionChange:Ye}),e.jsx(Us,{challenge:O,isOpen:G,onClose:Qe}),e.jsx("input",{type:"file",ref:R,className:"hidden",onChange:Te})]})}export{or as default};
