import{c as ce,a as u,R as ae,j as e,B as k,m as fe,t as H}from"./index-BBMUkGmi.js";import{I as te}from"./IconPlus-CHXkvznM.js";import{I as Qe}from"./IconSearch-D6p6NmPN.js";import{I as Xe}from"./IconUpload-BQ1IAj67.js";import{I as Je}from"./IconDownload-CReY4zru.js";import{I as Ze}from"./IconEdit-DMtzJPEw.js";import{I as Z}from"./IconTrash-PGXHqy21.js";import{I as et}from"./IconServer-eb9ZmzVQ.js";import{I as tt}from"./IconChevronRight-CyAyUJgG.js";import{I as ye}from"./IconX-BvF2DaKv.js";import{I as rt}from"./IconDeviceFloppy-BFUwYgn_.js";import{g as nt,a as st,d as at,b as it,c as ot,u as lt,e as ct}from"./challenge-DTBdLFus.js";import{s as dt}from"./contest-u8QN84w8.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]],mt=ce("outline","check","Check",ut);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]],ft=ce("outline","chevron-down","ChevronDown",pt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M4 16v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]],ht=ce("outline","maximize","Maximize",xt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M15 19v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M15 5v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M5 15h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M5 9h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]],vt=ce("outline","minimize","Minimize",gt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3",key:"svg-0"}]],jt=ce("outline","shield","Shield",bt);function yt(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function we(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,s)}return r}function Ne(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?we(Object(r),!0).forEach(function(s){yt(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function wt(t,n){if(t==null)return{};var r={},s=Object.keys(t),c,m;for(m=0;m<s.length;m++)c=s[m],!(n.indexOf(c)>=0)&&(r[c]=t[c]);return r}function Nt(t,n){if(t==null)return{};var r=wt(t,n),s,c;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(t);for(c=0;c<m.length;c++)s=m[c],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function kt(t,n){return Ct(t)||Ot(t,n)||_t(t,n)||zt()}function Ct(t){if(Array.isArray(t))return t}function Ot(t,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var r=[],s=!0,c=!1,m=void 0;try{for(var p=t[Symbol.iterator](),z;!(s=(z=p.next()).done)&&(r.push(z.value),!(n&&r.length===n));s=!0);}catch(E){c=!0,m=E}finally{try{!s&&p.return!=null&&p.return()}finally{if(c)throw m}}return r}}function _t(t,n){if(t){if(typeof t=="string")return ke(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ke(t,n)}}function ke(t,n){(n==null||n>t.length)&&(n=t.length);for(var r=0,s=new Array(n);r<n;r++)s[r]=t[r];return s}function zt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mt(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function Ce(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,s)}return r}function Oe(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ce(Object(r),!0).forEach(function(s){Mt(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function St(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(s){return n.reduceRight(function(c,m){return m(c)},s)}}function ie(t){return function n(){for(var r=this,s=arguments.length,c=new Array(s),m=0;m<s;m++)c[m]=arguments[m];return c.length>=t.length?t.apply(this,c):function(){for(var p=arguments.length,z=new Array(p),E=0;E<p;E++)z[E]=arguments[E];return n.apply(r,[].concat(c,z))}}}function xe(t){return{}.toString.call(t).includes("Object")}function Et(t){return!Object.keys(t).length}function le(t){return typeof t=="function"}function Lt(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function Ft(t,n){return xe(n)||re("changeType"),Object.keys(n).some(function(r){return!Lt(t,r)})&&re("changeField"),n}function Pt(t){le(t)||re("selectorType")}function At(t){le(t)||xe(t)||re("handlerType"),xe(t)&&Object.values(t).some(function(n){return!le(n)})&&re("handlersType")}function Rt(t){t||re("initialIsRequired"),xe(t)||re("initialType"),Et(t)&&re("initialContent")}function $t(t,n){throw new Error(t[n]||t.default)}var Dt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},re=ie($t)(Dt),ue={changes:Ft,selector:Pt,handler:At,initial:Rt};function It(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.initial(t),ue.handler(n);var r={current:t},s=ie(Vt)(r,n),c=ie(qt)(r),m=ie(ue.changes)(t),p=ie(Ut)(r);function z(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function($){return $};return ue.selector(F),F(r.current)}function E(F){St(s,c,m,p)(F)}return[z,E]}function Ut(t,n){return le(n)?n(t.current):n}function qt(t,n){return t.current=Oe(Oe({},t.current),n),n}function Vt(t,n,r){return le(n)?n(t.current):Object.keys(r).forEach(function(s){var c;return(c=n[s])===null||c===void 0?void 0:c.call(n,t.current[s])}),r}var Gt={create:It},Tt={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function Ht(t){return function n(){for(var r=this,s=arguments.length,c=new Array(s),m=0;m<s;m++)c[m]=arguments[m];return c.length>=t.length?t.apply(this,c):function(){for(var p=arguments.length,z=new Array(p),E=0;E<p;E++)z[E]=arguments[E];return n.apply(r,[].concat(c,z))}}}function Wt(t){return{}.toString.call(t).includes("Object")}function Bt(t){return t||_e("configIsRequired"),Wt(t)||_e("configType"),t.urls?(Yt(),{paths:{vs:t.urls.monacoBase}}):t}function Yt(){console.warn(Me.deprecation)}function Kt(t,n){throw new Error(t[n]||t.default)}var Me={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},_e=Ht(Kt)(Me),Qt={config:Bt},Xt=function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return function(c){return r.reduceRight(function(m,p){return p(m)},c)}};function Se(t,n){return Object.keys(n).forEach(function(r){n[r]instanceof Object&&t[r]&&Object.assign(n[r],Se(t[r],n[r]))}),Ne(Ne({},t),n)}var Jt={type:"cancelation",msg:"operation is manually canceled"};function ge(t){var n=!1,r=new Promise(function(s,c){t.then(function(m){return n?c(Jt):s(m)}),t.catch(c)});return r.cancel=function(){return n=!0},r}var Zt=Gt.create({config:Tt,isInitialized:!1,resolve:null,reject:null,monaco:null}),Ee=kt(Zt,2),de=Ee[0],he=Ee[1];function er(t){var n=Qt.config(t),r=n.monaco,s=Nt(n,["monaco"]);he(function(c){return{config:Se(c.config,s),monaco:r}})}function tr(){var t=de(function(n){var r=n.monaco,s=n.isInitialized,c=n.resolve;return{monaco:r,isInitialized:s,resolve:c}});if(!t.isInitialized){if(he({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),ge(ve);if(window.monaco&&window.monaco.editor)return Le(window.monaco),t.resolve(window.monaco),ge(ve);Xt(rr,sr)(ar)}return ge(ve)}function rr(t){return document.body.appendChild(t)}function nr(t){var n=document.createElement("script");return t&&(n.src=t),n}function sr(t){var n=de(function(s){var c=s.config,m=s.reject;return{config:c,reject:m}}),r=nr("".concat(n.config.paths.vs,"/loader.js"));return r.onload=function(){return t()},r.onerror=n.reject,r}function ar(){var t=de(function(r){var s=r.config,c=r.resolve,m=r.reject;return{config:s,resolve:c,reject:m}}),n=window.require;n.config(t.config),n(["vs/editor/editor.main"],function(r){Le(r),t.resolve(r)},function(r){t.reject(r)})}function Le(t){de().monaco||he({monaco:t})}function ir(){return de(function(t){var n=t.monaco;return n})}var ve=new Promise(function(t,n){return he({resolve:t,reject:n})}),Fe={config:er,init:tr,__getMonacoInstance:ir},or={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},be=or,lr={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},cr=lr;function dr({children:t}){return ae.createElement("div",{style:cr.container},t)}var ur=dr,mr=ur;function pr({width:t,height:n,isEditorReady:r,loading:s,_ref:c,className:m,wrapperProps:p}){return ae.createElement("section",{style:{...be.wrapper,width:t,height:n},...p},!r&&ae.createElement(mr,null,s),ae.createElement("div",{ref:c,style:{...be.fullWidth,...!r&&be.hide},className:m}))}var fr=pr,Pe=u.memo(fr);function xr(t){u.useEffect(t,[])}var Ae=xr;function hr(t,n,r=!0){let s=u.useRef(!0);u.useEffect(s.current||!r?()=>{s.current=!1}:t,n)}var K=hr;function oe(){}function se(t,n,r,s){return gr(t,s)||vr(t,n,r,s)}function gr(t,n){return t.editor.getModel(Re(t,n))}function vr(t,n,r,s){return t.editor.createModel(n,r,s?Re(t,s):void 0)}function Re(t,n){return t.Uri.parse(n)}function br({original:t,modified:n,language:r,originalLanguage:s,modifiedLanguage:c,originalModelPath:m,modifiedModelPath:p,keepCurrentOriginalModel:z=!1,keepCurrentModifiedModel:E=!1,theme:F="light",loading:$="Loading...",options:I={},height:X="100%",width:W="100%",className:C,wrapperProps:B={},beforeMount:q=oe,onMount:V=oe}){let[h,R]=u.useState(!1),[G,M]=u.useState(!0),P=u.useRef(null),O=u.useRef(null),Y=u.useRef(null),_=u.useRef(V),o=u.useRef(q),L=u.useRef(!1);Ae(()=>{let f=Fe.init();return f.then(a=>(O.current=a)&&M(!1)).catch(a=>(a==null?void 0:a.type)!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>P.current?Q():f.cancel()}),K(()=>{if(P.current&&O.current){let f=P.current.getOriginalEditor(),a=se(O.current,t||"",s||r||"text",m||"");a!==f.getModel()&&f.setModel(a)}},[m],h),K(()=>{if(P.current&&O.current){let f=P.current.getModifiedEditor(),a=se(O.current,n||"",c||r||"text",p||"");a!==f.getModel()&&f.setModel(a)}},[p],h),K(()=>{let f=P.current.getModifiedEditor();f.getOption(O.current.editor.EditorOption.readOnly)?f.setValue(n||""):n!==f.getValue()&&(f.executeEdits("",[{range:f.getModel().getFullModelRange(),text:n||"",forceMoveMarkers:!0}]),f.pushUndoStop())},[n],h),K(()=>{var f,a;(a=(f=P.current)==null?void 0:f.getModel())==null||a.original.setValue(t||"")},[t],h),K(()=>{let{original:f,modified:a}=P.current.getModel();O.current.editor.setModelLanguage(f,s||r||"text"),O.current.editor.setModelLanguage(a,c||r||"text")},[r,s,c],h),K(()=>{var f;(f=O.current)==null||f.editor.setTheme(F)},[F],h),K(()=>{var f;(f=P.current)==null||f.updateOptions(I)},[I],h);let j=u.useCallback(()=>{var l;if(!O.current)return;o.current(O.current);let f=se(O.current,t||"",s||r||"text",m||""),a=se(O.current,n||"",c||r||"text",p||"");(l=P.current)==null||l.setModel({original:f,modified:a})},[r,n,c,t,s,m,p]),S=u.useCallback(()=>{var f;!L.current&&Y.current&&(P.current=O.current.editor.createDiffEditor(Y.current,{automaticLayout:!0,...I}),j(),(f=O.current)==null||f.editor.setTheme(F),R(!0),L.current=!0)},[I,F,j]);u.useEffect(()=>{h&&_.current(P.current,O.current)},[h]),u.useEffect(()=>{!G&&!h&&S()},[G,h,S]);function Q(){var a,l,x,g;let f=(a=P.current)==null?void 0:a.getModel();z||((l=f==null?void 0:f.original)==null||l.dispose()),E||((x=f==null?void 0:f.modified)==null||x.dispose()),(g=P.current)==null||g.dispose()}return ae.createElement(Pe,{width:W,height:X,isEditorReady:h,loading:$,_ref:Y,className:C,wrapperProps:B})}var jr=br;u.memo(jr);function yr(t){let n=u.useRef();return u.useEffect(()=>{n.current=t},[t]),n.current}var wr=yr,me=new Map;function Nr({defaultValue:t,defaultLanguage:n,defaultPath:r,value:s,language:c,path:m,theme:p="light",line:z,loading:E="Loading...",options:F={},overrideServices:$={},saveViewState:I=!0,keepCurrentModel:X=!1,width:W="100%",height:C="100%",className:B,wrapperProps:q={},beforeMount:V=oe,onMount:h=oe,onChange:R,onValidate:G=oe}){let[M,P]=u.useState(!1),[O,Y]=u.useState(!0),_=u.useRef(null),o=u.useRef(null),L=u.useRef(null),j=u.useRef(h),S=u.useRef(V),Q=u.useRef(),f=u.useRef(s),a=wr(m),l=u.useRef(!1),x=u.useRef(!1);Ae(()=>{let d=Fe.init();return d.then(b=>(_.current=b)&&Y(!1)).catch(b=>(b==null?void 0:b.type)!=="cancelation"&&console.error("Monaco initialization: error:",b)),()=>o.current?y():d.cancel()}),K(()=>{var b,A,J,ee;let d=se(_.current,t||s||"",n||c||"",m||r||"");d!==((b=o.current)==null?void 0:b.getModel())&&(I&&me.set(a,(A=o.current)==null?void 0:A.saveViewState()),(J=o.current)==null||J.setModel(d),I&&((ee=o.current)==null||ee.restoreViewState(me.get(m))))},[m],M),K(()=>{var d;(d=o.current)==null||d.updateOptions(F)},[F],M),K(()=>{!o.current||s===void 0||(o.current.getOption(_.current.editor.EditorOption.readOnly)?o.current.setValue(s):s!==o.current.getValue()&&(x.current=!0,o.current.executeEdits("",[{range:o.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),o.current.pushUndoStop(),x.current=!1))},[s],M),K(()=>{var b,A;let d=(b=o.current)==null?void 0:b.getModel();d&&c&&((A=_.current)==null||A.editor.setModelLanguage(d,c))},[c],M),K(()=>{var d;z!==void 0&&((d=o.current)==null||d.revealLine(z))},[z],M),K(()=>{var d;(d=_.current)==null||d.editor.setTheme(p)},[p],M);let g=u.useCallback(()=>{var d;if(!(!L.current||!_.current)&&!l.current){S.current(_.current);let b=m||r,A=se(_.current,s||t||"",n||c||"",b||"");o.current=(d=_.current)==null?void 0:d.editor.create(L.current,{model:A,automaticLayout:!0,...F},$),I&&o.current.restoreViewState(me.get(b)),_.current.editor.setTheme(p),z!==void 0&&o.current.revealLine(z),P(!0),l.current=!0}},[t,n,r,s,c,m,F,$,I,p,z]);u.useEffect(()=>{M&&j.current(o.current,_.current)},[M]),u.useEffect(()=>{!O&&!M&&g()},[O,M,g]),f.current=s,u.useEffect(()=>{var d,b;M&&R&&((d=Q.current)==null||d.dispose(),Q.current=(b=o.current)==null?void 0:b.onDidChangeModelContent(A=>{x.current||R(o.current.getValue(),A)}))},[M,R]),u.useEffect(()=>{if(M){let d=_.current.editor.onDidChangeMarkers(b=>{var J;let A=(J=o.current.getModel())==null?void 0:J.uri;if(A&&b.find(ee=>ee.path===A.path)){let ee=_.current.editor.getModelMarkers({resource:A});G==null||G(ee)}});return()=>{d==null||d.dispose()}}return()=>{}},[M,G]);function y(){var d,b;(d=Q.current)==null||d.dispose(),X?I&&me.set(m,o.current.saveViewState()):(b=o.current.getModel())==null||b.dispose(),o.current.dispose()}return ae.createElement(Pe,{width:W,height:C,isEditorReady:M,loading:E,_ref:L,className:B,wrapperProps:q})}var kr=Nr,Cr=u.memo(kr),pe=Cr;function Or({challenges:t=[],totalCount:n=0,currentPage:r=1,pageSize:s=10,categories:c=[],filterCategory:m="all",filterType:p="all",onPageChange:z,onAddChallenge:E,onEditChallenge:F,onDeleteChallenge:$,onUploadAttachment:I,onDownloadAttachment:X,onFilterTypeChange:W,onFilterCategoryChange:C,searchQuery:B="",searchLoading:q=!1,isSearchMode:V=!1,onSearchChange:h}){const[R,G]=u.useState({}),M=(o,L)=>{const j=`${o}-${L}`;G(S=>({...S,[j]:!S[j]}))},P=o=>{const j={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[o.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${j}`,children:o})},O=o=>{const j={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-green-400/20 text-green-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[o]||{label:o,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${j.class}`,children:j.label})},Y=o=>!o||o.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:o.map((L,j)=>e.jsx("span",{className:"px-2 py-1 bg-black/30 border border-neutral-300/30 rounded text-xs font-mono text-neutral-300",title:L.value,children:L.value.length>15?`${L.value.substring(0,15)}...`:L.value},j))}),_=(o,L)=>!o||o.length===0?null:e.jsxs("div",{className:"mt-3 border-t border-neutral-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(et,{size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm text-neutral-400 font-mono",children:"容器配置："})]}),e.jsx("div",{className:"space-y-2",children:o.map((j,S)=>{const Q=`${L}-${S}`,f=R[Q];return e.jsxs("div",{className:"p-2 bg-black/40 border border-neutral-300/20 rounded-md text-xs font-mono",children:[e.jsx("div",{className:"flex items-center gap-1 mb-2",children:e.jsxs("span",{className:"text-cyan-400",children:["Docker 组 ",S+1]})}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1 cursor-pointer hover:text-neutral-300 transition-colors",onClick:()=>M(L,S),children:[f?e.jsx(ft,{size:14,className:"text-neutral-400"}):e.jsx(tt,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-neutral-400",children:"YAML 配置"}),e.jsxs("span",{className:"text-neutral-500",children:["(",f?"点击收缩":"点击展开",")"]})]}),f&&e.jsx("div",{className:"border border-neutral-300/20 rounded overflow-hidden",children:e.jsx(pe,{value:j.yaml||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:12,fontFamily:'Consolas, "Courier New", monospace',renderLineHighlight:"none"},height:`${16*j.yaml.split(`
`).length}px`,theme:"vs-dark"})}),!f&&e.jsx("div",{className:"p-2 bg-black/50 border border-neutral-300/20 rounded text-neutral-500 overflow-hidden",children:e.jsx("div",{className:"text-xs",children:j.yaml?e.jsxs(e.Fragment,{children:[j.yaml.split(`
`).slice(0,2).map((a,l)=>e.jsx("div",{className:"truncate",children:a||" "},l)),j.yaml.split(`
`).length>2&&e.jsx("div",{className:"text-neutral-600",children:"..."})]}):e.jsx("div",{className:"truncate",children:"暂无配置"})})})]}),j.network_policies&&j.network_policies.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-700 border-dashed",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(jt,{size:12,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400",children:"网络策略:"})]}),e.jsx("div",{className:"space-y-2 pl-2 mt-1",children:j.network_policies.map((a,l)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"mb-1",children:e.jsxs("span",{className:"text-neutral-300",children:["策略 ",l+1]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 pl-2",children:[a.from&&a.from.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"From:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.from.map((x,g)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:x.cidr||"任意"}),x.except&&x.except.length>0&&x.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",x.except.join(", ")]})]},g))})]}),a.to&&a.to.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"To:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.to.map((x,g)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:x.cidr||"任意"}),x.except&&x.except.length>0&&x.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",x.except.join(", ")]})]},g))})]})]})]},l))})]})]},S)})})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"题目管理"}),e.jsx(k,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(te,{size:16}),onClick:E,children:"添加题目"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"搜索题目"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:B,placeholder:"输入题目名搜索...",onChange:o=>h==null?void 0:h(o.target.value),className:`w-full h-10 pl-10 pr-10 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`}),q&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border border-geek-400 border-t-transparent rounded-full animate-spin"})})]})]})})}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex gap-8",children:[{id:"all",label:"全部"},{id:"static",label:"静态题目"},{id:"question",label:"问答题目"},{id:"dynamic",label:"动态题目"},{id:"pods",label:"容器题目"}].map(o=>e.jsxs("div",{className:"relative",children:[e.jsx(k,{variant:p===o.id?"primary":"ghost",size:"sm",className:`!px-2 !min-w-0 !border-0 pb-3 ${p===o.id?"!bg-transparent !text-geek-400":"!text-neutral-400"}`,onClick:()=>W(o.id),children:o.label}),p===o.id&&e.jsx(fe.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]},o.id))})}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:m,onChange:o=>C(o.target.value),className:"select-custom select-custom-sm",children:[e.jsx("option",{value:"all",children:"全部分类"}),c.map(o=>e.jsx("option",{value:o,children:o},o))]})})})]})}),t.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:V?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-neutral-300/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("span",{className:"font-mono text-neutral-400",children:"未找到匹配的题目"})]}):e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:t.map(o=>e.jsx(fe.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:o.name}),e.jsxs("div",{className:"flex gap-2",children:[P(o.category),O(o.type)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>I(o),children:e.jsx(Xe,{size:18})}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>X(o),children:e.jsx(Je,{size:18})}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>F(o),children:e.jsx(Ze,{size:18})}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>$(o),children:e.jsx(Z,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:o.desc}),o.type!=="pods"&&o.type!=="question"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"Flags:"}),Y(o.flags)]}),o.type==="pods"&&_(o.dockers,o.id||o.name)]})},o.id||o.name))}),!V&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",disabled:r===1,onClick:()=>z(r>1?r-1:1),className:r===1?"!border-neutral-700 !text-neutral-600":"",children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[r," / ",Math.ceil(n/s)]}),e.jsx(k,{variant:"ghost",size:"sm",disabled:r>=Math.ceil(n/s),onClick:()=>z(r<Math.ceil(n/s)?r+1:Math.ceil(n/s)),className:r>=Math.ceil(n/s)?"!border-neutral-700 !text-neutral-600":"",children:"下一页"})]})})]})}const ne=`
services:
  service1:
    container_name: service1
    image: nicolaka/netshoot:latest
    ports:
      - "80:80/tcp"
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=static{static_flag}
    volumes:
      - FLAG_0:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network1:
        ipv4_address: 192.168.0.2

  service2:
    container_name: service2
    image: nicolaka/netshoot:latest
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=dynamic{dynamic_flag}
    volumes:
      - FLAG_1:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network1:
        ipv4_address: 192.168.0.3
      network2:
        ipv4_address: 192.168.1.3

  service3:
    container_name: service3
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=uuid{}
    volumes:
      - FLAG_2:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network2:
        ipv4_address: 192.168.1.4
      network3:
        ipv4_address: 192.168.2.4

volumes:
  FLAG_0:
    labels:
      - value=static{static_flag}
  FLAG_1:
    labels:
      - value=dynamic{dynamic_flag}
  FLAG_2:
    labels:
      - value=uuid{}

networks:
  network1:
    external: true
    ipam:
      config:
        - subnet: 192.168.0.0/24
          gateway: 192.168.0.1

  network2:
    ipam:
      config:
        - subnet: 192.168.1.0/24
          gateway: 192.168.1.1

  network3:
    ipam:
      config:
        - subnet: 192.168.2.0/24
          gateway: 192.168.2.1
`.trim();function _r({isOpen:t=!1,mode:n="add",challenge:r={name:"",desc:"",category:"",type:"static",generator_image:"",flags:[""],options:[],docker_compose:"",network_policies:[{from:[{cidr:"",except:[""]}],to:[{cidr:"",except:[""]}]}]},categories:s=[],onClose:c,onSubmit:m,onChange:p,onAddFlag:z,onRemoveFlag:E,onFlagChange:F,onAddOption:$,onRemoveOption:I,onOptionChange:X,onCorrectOptionChange:W}){const[C,B]=u.useState({isOpen:!1,value:""}),q=()=>{B({isOpen:!0,value:r.docker_compose||ne})};u.useEffect(()=>{r.type==="pods"&&!r.docker_compose&&p({...r,docker_compose:ne})},[r.type,r.docker_compose,p]);const V=()=>{B({isOpen:!1,value:""})},h=()=>{const a=C.value||ne;p({...r,docker_compose:a}),V()},R=a=>{B({...C,value:a})},G=a=>{p({...r,docker_compose:a||ne})},M=()=>{const a=[...r.network_policies||[],{from:[{cidr:"",except:[""]}],to:[{cidr:"0.0.0.0/0",except:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10"]}]}];p({...r,network_policies:a})},P=a=>{const l=r.network_policies.filter((x,g)=>g!==a);p({...r,network_policies:l})},O=(a,l)=>{const x=[...r.network_policies],g={...x[a]};g[l]=[...g[l],{cidr:"",except:[""]}],x[a]=g,p({...r,network_policies:x})},Y=(a,l,x)=>{const g=[...r.network_policies],y={...g[a]};y[l]=y[l].filter((d,b)=>b!==x),g[a]=y,p({...r,network_policies:g})},_=(a,l,x,g)=>{const y=[...r.network_policies],d={...y[a]},b={...d[l][x]};b.cidr=g,d[l]=[...d[l]],d[l][x]=b,y[a]=d,p({...r,network_policies:y})},o=(a,l,x)=>{const g=[...r.network_policies],y={...g[a]},d={...y[l][x]};d.except=[...d.except,""],y[l]=[...y[l]],y[l][x]=d,g[a]=y,p({...r,network_policies:g})},L=(a,l,x,g)=>{const y=[...r.network_policies],d={...y[a]},b={...d[l][x]};b.except=b.except.filter((A,J)=>J!==g),d[l]=[...d[l]],d[l][x]=b,y[a]=d,p({...r,network_policies:y})},j=(a,l,x,g,y)=>{const d=[...r.network_policies],b={...d[a]},A={...b[l][x]};A.except=[...A.except],A.except[g]=y,b[l]=[...b[l]],b[l][x]=A,d[a]=b,p({...r,network_policies:d})};u.useEffect(()=>{const a=l=>{C.isOpen&&(l.key==="Escape"?V():l.ctrlKey&&l.key==="s"&&(l.preventDefault(),h()))};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[C.isOpen,C.value]);const S="w-full h-10 bg-black/20 border border-neutral-300/30 rounded-md px-4 text-neutral-50 focus:outline-none focus:border-geek-400",Q="select-custom select-custom-md",f="w-full h-20 bg-black/20 border border-neutral-300/30 rounded-md px-4 py-2 text-neutral-50 focus:outline-none focus:border-geek-400 resize-none";return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:[e.jsxs(fe.div,{className:"w-full max-w-4xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:n==="add"?"添加题目":n==="edit"?"编辑题目":"删除题目"}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:c,children:e.jsx(ye,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:n==="delete"?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-red-400/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(Z,{size:40,className:"text-red-400"})}),e.jsx("h3",{className:"text-2xl font-mono text-neutral-50 mb-4",children:"确认删除题目"}),e.jsx("p",{className:"text-neutral-400 font-mono text-lg mb-2",children:"您确定要删除这个题目吗？"}),e.jsx("p",{className:"text-red-400 font-mono text-sm",children:"⚠️ 此操作无法撤销，请谨慎操作"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:r.name,onChange:a=>p({...r,name:a.target.value}),className:S,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目分类"}),e.jsx("input",{type:"text",value:r.category,onChange:a=>p({...r,category:a.target.value}),className:Q,placeholder:"请选择分类",list:"category-options"}),e.jsx("datalist",{id:"category-options",children:s.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目类型"}),e.jsxs("select",{value:r.type,onChange:a=>p({...r,type:a.target.value}),className:Q,children:[e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"question",children:"问答题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:r.desc,onChange:a=>p({...r,desc:a.target.value}),className:f,placeholder:"输入题目描述内容"})]})]})]}),r.type==="dynamic"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"生成器镜像"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Generator镜像地址"}),e.jsx("input",{type:"text",value:r.generator_image,onChange:a=>p({...r,generator_image:a.target.value}),className:S,placeholder:"输入Generator镜像地址"})]})]}),r.type!=="pods"&&r.type!=="question"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag设置"}),e.jsx(k,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(te,{size:16}),onClick:z,children:"添加Flag"})]}),e.jsx("div",{className:"space-y-3",children:r.flags.map((a,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:typeof a=="string"?a:a.value||"",onChange:x=>F(l,x.target.value),className:S,placeholder:`Flag ${l+1}`}),r.flags.length>1&&e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>E(l),children:e.jsx(Z,{size:18})})]},l))})]}),r.type==="question"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"选项设置"}),e.jsx(k,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(te,{size:16}),onClick:$,children:"添加选项"})]}),e.jsxs("div",{className:"space-y-3",children:[(r.options||[]).map((a,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1 flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:a.content||"",onChange:x=>X(l,x.target.value),className:S,placeholder:`选项 ${l+1}`}),e.jsx(k,{variant:a.correct?"primary":"ghost",size:"icon",className:`!bg-transparent ${a.correct?"!text-green-400 hover:!text-green-300":"!text-red-400 hover:!text-red-300"}`,onClick:()=>W(l),title:a.correct?"取消正确答案":"设为正确答案",children:a.correct?e.jsx(mt,{size:18}):e.jsx(ye,{size:18})})]}),(r.options||[]).length>1&&e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>I(l),children:e.jsx(Z,{size:18})})]},a.rand_id||l)),(r.options||[]).length===0&&e.jsx("div",{className:"text-center py-4 text-neutral-500 font-mono text-sm",children:"暂无选项，请添加选项"})]})]}),r.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"docker-compose注意事项"}),e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-400 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 volumes.FLAG_x.labels.value 字段指定值",e.jsx("br",{}),e.jsx("br",{}),"services参数只接受: image, expose, ports, environment, volumes, working_dir, command, cpus, mem_limit",e.jsx("br",{}),e.jsx("br",{}),"可通过networks配置多个网段, 每个容器可占据多个网段",e.jsx("br",{}),"当设置networks时, 每个容器必须指定所使用的network; 不指定时具体IP时, 随机从定义的网段中选取",e.jsx("br",{}),"当不设置networks时, 容器之间共用同一个随机IP地址, 容器间通信请使用本地地址: 127.0.0.1",e.jsx("br",{}),"共用IP地址时, 请注意端口唯一性",e.jsx("br",{}),e.jsx("br",{}),"下述示例中包含了所有可接受字段, 未在其中的字段将被忽略; 务必使用2个空格进行缩进"]})})]}),r.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"容器设置"}),n==="edit"&&e.jsx("span",{className:"text-xs text-neutral-500",children:"容器配置仅在创建时确定"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border border-neutral-700 rounded-md p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["docker-compose.yaml",n==="edit"&&e.jsx("span",{className:"ml-2 text-xs text-neutral-500",children:"(只读)"})]}),n==="add"&&e.jsx(k,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(ht,{size:14}),className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300 !text-xs",onClick:q,children:"全屏编辑"})]}),n==="add"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(pe,{value:r.docker_compose||ne,onChange:G,language:"yaml",options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:`${19*(r.docker_compose||ne).split(`
`).length}px`,theme:"vs-dark"})}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 labels value 字段指定值",e.jsx("br",{}),"Docker参数只接受: image, expose, ports, environment, volumes, working_dir, command",e.jsx("br",{}),"同一道题目中, 所有的容器名必须唯一, 作为唯一 DNS Hostname",e.jsx("br",{}),"容器间通过 Hostname 或 本地地址 通信"]})]}):e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(pe,{value:r.docker_compose||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:`${19*(r.docker_compose||ne).split(`
`).length}px`,theme:"vs-dark"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"网络策略"}),e.jsx(k,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:M,children:"添加策略"})]}),e.jsx("div",{className:"space-y-4",children:(r.network_policies||[]).map((a,l)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-3 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h5",{className:"text-sm font-mono text-neutral-200",children:["策略 ",l+1]}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>P(l),children:e.jsx(Z,{size:16})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"允许入站"}),e.jsx(k,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>O(l,"from"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(a.from||[]).map((x,g)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),a.from.length>1&&e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>Y(l,"from",g),children:e.jsx(Z,{size:12})})]}),e.jsx("input",{type:"text",value:x.cidr,onChange:y=>_(l,"from",g,y.target.value),className:"w-full h-8 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"192.168.1.0/24"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"排除列表"}),e.jsx(k,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>o(l,"from",g),children:"添加排除"})]}),e.jsx("div",{className:"space-y-1",children:(x.except||[]).map((y,d)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"text",value:y,onChange:b=>j(l,"from",g,d,b.target.value),className:"flex-1 h-6 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"192.168.1.1"}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300 !w-6 !h-6",onClick:()=>L(l,"from",g,d),children:e.jsx(Z,{size:10})})]},d))})]})]},g))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"允许出站"}),e.jsx(k,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>O(l,"to"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(a.to||[]).map((x,g)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),a.to.length>1&&e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>Y(l,"to",g),children:e.jsx(Z,{size:12})})]}),e.jsx("input",{type:"text",value:x.cidr,onChange:y=>_(l,"to",g,y.target.value),className:"w-full h-8 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"0.0.0.0/0"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"排除列表"}),e.jsx(k,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>o(l,"to",g),children:"添加排除"})]}),e.jsx("div",{className:"space-y-1",children:(x.except||[]).map((y,d)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"text",value:y,onChange:b=>j(l,"to",g,d,b.target.value),className:"flex-1 h-6 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"10.0.0.0/8"}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300 !w-6 !h-6",onClick:()=>L(l,"to",g,d),children:e.jsx(Z,{size:10})})]},d))})]})]},g))})]})]},l))})]})]})})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:c,children:"取消"}),e.jsx(k,{variant:"primary",size:"sm",onClick:()=>m(r),children:n==="add"?"添加题目":n==="edit"?"保存更改":"确认删除"})]})]}),C.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center",children:e.jsxs(fe.div,{className:"w-[95vw] h-[95vh] bg-neutral-900 border border-neutral-700 rounded-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"全屏编辑 - docker-compose.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"primary",size:"sm",onClick:h,children:[e.jsx(rt,{size:16,className:"mr-2"}),"保存 (Ctrl+S)"]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:V,children:[e.jsx(vt,{size:16,className:"mr-2"}),"退出 (Esc)"]})]})]}),e.jsx("div",{className:"flex-1 h-full",children:e.jsx(pe,{value:C.value,onChange:R,language:"yaml",options:{readOnly:!1,minimap:{enabled:!0},scrollBeyondLastLine:!1,lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:16,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:"calc(95vh - 70px)",theme:"vs-dark"})})]})})]}):null}const D=[];for(let t=0;t<256;++t)D.push((t+256).toString(16).slice(1));function zr(t,n=0){return(D[t[n+0]]+D[t[n+1]]+D[t[n+2]]+D[t[n+3]]+"-"+D[t[n+4]]+D[t[n+5]]+"-"+D[t[n+6]]+D[t[n+7]]+"-"+D[t[n+8]]+D[t[n+9]]+"-"+D[t[n+10]]+D[t[n+11]]+D[t[n+12]]+D[t[n+13]]+D[t[n+14]]+D[t[n+15]]).toLowerCase()}let je;const Mr=new Uint8Array(16);function Sr(){if(!je){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");je=crypto.getRandomValues.bind(crypto)}return je(Mr)}const Er=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ze={randomUUID:Er};function Lr(t,n,r){var c;if(ze.randomUUID&&!t)return ze.randomUUID();t=t||{};const s=t.random??((c=t.rng)==null?void 0:c.call(t))??Sr();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,zr(s)}const Fr=()=>Lr();function Br(){const[t,n]=u.useState([]),[r,s]=u.useState(0),[c,m]=u.useState(1),[p,z]=u.useState("all"),[E,F]=u.useState([]),[$,I]=u.useState("all"),[X,W]=u.useState(!1),[C,B]=u.useState("add"),[q,V]=u.useState(null),[h,R]=u.useState({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],options:[],docker_compose:"",network_policies:[]}),G=u.useRef(null),M=10,[P,O]=u.useState(""),[Y,_]=u.useState([]),[o,L]=u.useState(!1),[j,S]=u.useState(!1);u.useEffect(()=>{Q()},[]),u.useEffect(()=>{j||f()},[c,p,$,j]);const Q=async()=>{try{const i=await nt();if(i.code===200){const v=["Web","Misc","Pwn","Crypto","Reverse"],w=[...new Set([...v,...i.data||[]])];F(w)}else F(["Web","Misc","Pwn","Crypto","Reverse"])}catch(i){console.error("获取题目分类失败:",i),H.danger({description:"获取题目分类失败"}),F(["Web","Misc","Pwn","Crypto","Reverse"])}},f=async()=>{try{const i={limit:M,offset:(c-1)*M};p!=="all"&&(i.type=p),$!=="all"&&(i.category=$);const v=await st(i);v.code===200?(n(v.data.challenges.map(w=>{let N=[];return w.flags&&Array.isArray(w.flags)?N=w.flags:w.flag?N=[w.flag]:N=[""],{...w,flags:N,options:w.options||[]}})),s(v.data.count)):H.danger({description:v.msg||"获取题目列表失败"})}catch(i){H.danger({description:"获取题目列表失败"}),console.error(i)}},a=async i=>{if(!i||i.trim()===""){_([]),S(!1);return}L(!0);try{const v=await dt({model:"challenge",name:i.trim(),limit:10,offset:0,type:p!=="all"?p:"",category:$!=="all"?$:""});if(v.code===200){const N=(v.data.results||[]).map(T=>{let U=[];return T.flags&&Array.isArray(T.flags)?U=T.flags:T.flag?U=[T.flag]:U=[""],{...T,flags:U,options:T.options||[]}});_(N),S(!0)}else H.danger({description:v.msg||"搜索失败"}),_([]),S(!1)}catch(v){console.error("搜索失败:",v),H.danger({description:"搜索失败"}),_([]),S(!1)}finally{L(!1)}},l=(()=>{let i;return v=>{clearTimeout(i),i=setTimeout(()=>{a(v)},300)}})(),x=i=>{O(i),!i||i.trim()===""?(S(!1),_([])):l(i)},g=i=>{z(i),m(1),S(!1),O(""),_([])},y=i=>{I(i),m(1),S(!1),O(""),_([])},d=()=>{B("add"),R({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],options:[],docker_compose:"",network_policies:[]}),W(!0)},b=i=>{B("edit"),V(i),R({...i,options:i.options||[]}),W(!0)},A=i=>{B("delete"),V(i),W(!0)},J=i=>{var v;(v=G.current)==null||v.click(),V(i)},ee=async i=>{try{const v=await at(i.id,"attachment.zip"),w=window.URL.createObjectURL(new Blob([v.data])),N=document.createElement("a");N.href=w,N.setAttribute("download","attachment.zip"),document.body.appendChild(N),N.click(),N.remove()}catch(v){console.error("下载附件失败:",v),H.danger({description:"下载附件失败"})}},$e=async i=>{var w;const v=(w=i.target.files)==null?void 0:w[0];if(i.target.value="",!!v){if(q.type==="static"&&v.name!=="attachment.zip"||q.type==="question"&&v.name!=="attachment.zip"||q.type==="dynamic"&&v.name!=="generator.zip"||q.type==="pods"&&v.name!=="attachment.zip"){H.danger({description:"文件名必须与题目类型匹配"});return}try{const N=await ct(q.id,v);N.code===200?H.success({description:"上传附件成功"}):H.danger({description:N.msg||"上传附件失败"})}catch(N){console.error("上传附件失败:",N),H.danger({description:"上传附件失败"})}}},De=i=>{i.type!==h.type&&(i.type==="pods"?i.flags=[]:h.type==="pods"&&(i.flags=[{id:0,value:""}]),i.type==="question"&&(i.options=[])),R(i)},Ie=()=>{h.type!=="pods"&&R({...h,flags:[...h.flags||[],{id:0,value:""}]})},Ue=i=>{if(h.type==="pods")return;const v=[...h.flags||[]];v.splice(i,1),R({...h,flags:v})},qe=(i,v)=>{if(h.type==="pods")return;const w=[...h.flags||[]];w[i]={id:h.flags[i]&&h.flags[i].id||0,value:v},R({...h,flags:w})},Ve=()=>{if(h.type!=="question")return;const i=[...h.options||[]];i.push({rand_id:Fr(),content:"",correct:!1}),R({...h,options:i})},Ge=i=>{if(h.type!=="question")return;const v=[...h.options||[]];v.splice(i,1),R({...h,options:v})},Te=(i,v)=>{if(h.type!=="question")return;const w=[...h.options||[]];w[i]={...w[i],content:v},R({...h,options:w})},He=i=>{if(h.type!=="question")return;const v=[...h.options||[]];v[i].correct=!v[i].correct,R({...h,options:v})},We=()=>{W(!1)},Be=async i=>{var v;try{let w;if(C==="delete")w=await it(q.id);else{const N={name:i.name,desc:i.desc,category:i.category,type:i.type};i.type==="question"&&(N.options=i.options||[]);let T;if(i.type==="pods"?T=[]:C==="add"?T=i.flags.map(U=>typeof U=="string"?U:U.value||""):C==="edit"&&(T=i.flags.map(U=>typeof U=="string"?{id:0,value:U}:{id:U.id||0,value:U.value||""})),i.type==="static")N.flags=T||[];else if(i.type==="dynamic")N.flags=T||[],N.generator_image=i.generator_image||"";else if(i.type==="pods")N.docker_compose=i.docker_compose||"",N.generator_image=i.generator_image||"",N.flags=T,N.network_policies=((v=i.network_policies)==null?void 0:v.map(U=>({from:U.from||[],to:U.to||[]})))||[];else if(i.type==="question")N.flags=[],N.options=i.options||[];else{H.danger({description:"错误的题目类型"});return}C==="add"?w=await ot(N):C==="edit"&&(w=await lt(q.id,N))}w.code===200?(H.success({description:`${C==="add"?"创建":C==="edit"?"更新":"删除"}题目成功`}),W(!1),await f()):H.danger({description:w.msg||`${C==="add"?"创建":C==="edit"?"更新":"删除"}题目失败`})}catch(w){console.error(`${C==="add"?"创建":C==="edit"?"更新":"删除"}题目失败:`,w),H.danger({description:`${C==="add"?"创建":C==="edit"?"更新":"删除"}题目失败`})}},Ye=j?Y:t,Ke=j?Y.length:r;return e.jsxs(e.Fragment,{children:[e.jsx(Or,{challenges:Ye,totalCount:Ke,currentPage:c,pageSize:M,categories:E,filterCategory:$,filterType:p,onPageChange:m,onAddChallenge:d,onEditChallenge:b,onDeleteChallenge:A,onUploadAttachment:J,onDownloadAttachment:ee,onFilterTypeChange:g,onFilterCategoryChange:y,searchQuery:P,searchLoading:o,isSearchMode:j,onSearchChange:x}),e.jsx(_r,{isOpen:X,mode:C,challenge:h,categories:E,onClose:We,onSubmit:Be,onChange:De,onAddFlag:Ie,onRemoveFlag:Ue,onFlagChange:qe,onAddOption:Ve,onRemoveOption:Ge,onOptionChange:Te,onCorrectOptionChange:He}),e.jsx("input",{type:"file",ref:G,className:"hidden",onChange:$e})]})}export{Br as default};
