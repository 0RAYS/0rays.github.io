import{c as $,j as e,m as z,B as m,a as c,u as E,t as p}from"./index-DU2x9rtW.js";import{I as L}from"./IconPlus-YGFUEh_g.js";import{I as _}from"./IconEdit-nKwM1swG.js";import{I as H}from"./IconTrash-BSV0gM0o.js";import{I as q}from"./IconChevronRight-C1vvQXW3.js";import{A as G,M as S}from"./AdminModal-KhVt7ngV.js";import{g as J,u as K,c as Q,d as V}from"./contest-BmDE9t3I.js";import"./IconX-DLF60IfU.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]],X=$("outline","chevron-left","ChevronLeft",W);function Y({contests:d=[],totalCount:h=0,currentPage:o=1,pageSize:f=6,onPageChange:r,onCreateContest:y,onDeleteContest:b,onContestClick:l,onAvatarUpload:n}){const g=(t,a)=>{const i=new Date().getTime()/1e3,x=new Date(t).getTime()/1e3,w=x+a;return i<x?"upcoming":i>w?"ended":"running"},u=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),v=t=>`${Math.floor(t/3600)}h`;return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"比赛管理"}),e.jsx(m,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(L,{size:16}),onClick:y,children:"添加比赛"})]}),e.jsx("div",{className:"space-y-4",children:d.map(t=>{const a=g(t.start,t.duration);return e.jsx(z.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(89, 126, 247, 0.1)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4 flex h-[200px]",onClick:()=>l==null?void 0:l(t),children:[e.jsx("div",{className:"w-[200px] p-4",children:e.jsxs("div",{className:"relative w-full h-full rounded-md overflow-hidden group cursor-pointer",onClick:i=>{i.stopPropagation(),n==null||n(t)},children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-neutral-300",children:"更换封面"})})]})}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-mono
                                                        ${a==="upcoming"?"bg-green-400/20 text-green-400":a==="running"?"bg-geek-400/20 text-geek-400":"bg-neutral-400/20 text-neutral-400"}`,children:a==="upcoming"?"未开始":a==="running"?"进行中":"已结束"}),t.hidden&&e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-mono bg-yellow-400/20 text-yellow-400",children:"隐藏"})]})]}),e.jsx("p",{className:"text-sm text-neutral-400 mt-2 line-clamp-2",children:t.desc})]}),e.jsx("div",{className:"h-[1px] bg-neutral-300/30 my-4"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-neutral-400 font-mono",children:[e.jsxs("span",{children:["开始时间: ",u(t.start)]}),e.jsxs("span",{children:["持续时间: ",v(t.duration)]}),e.jsxs("span",{children:["每队人数: ",t.size,"人"]}),e.jsxs("span",{children:["报名总数: ",t.users,"人"]}),e.jsxs("span",{children:["队伍总数: ",t.teams,"队"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"!bg-yellow-400/20 !text-yellow-400 hover:!bg-yellow-400/30",children:e.jsx(_,{size:18})}),e.jsx(m,{variant:"ghost",size:"icon",className:"!bg-red-400/20 !text-red-400 hover:!bg-red-400/30",onClick:i=>{i.stopPropagation(),b==null||b(t)},children:e.jsx(H,{size:18})})]})]})]})]})},t.id)})}),h>f&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"!bg-black/30",onClick:()=>r==null?void 0:r(o-1),disabled:o===1,children:e.jsx(X,{size:18})}),Array.from({length:Math.ceil(h/f)}).map((t,a)=>e.jsx(m,{variant:o===a+1?"primary":"ghost",size:"icon",className:o===a+1?"":"!bg-black/30",onClick:()=>r==null?void 0:r(a+1),children:a+1},a)),e.jsx(m,{variant:"ghost",size:"icon",className:"!bg-black/30",onClick:()=>r==null?void 0:r(o+1),disabled:o===Math.ceil(h/f),children:e.jsx(q,{size:18})})]})]})})}const I=()=>{const d=new Date;return d.setDate(d.getDate()+1),d.toISOString().slice(0,16)};function ne(){const[d,h]=c.useState([]),[o,f]=c.useState(0),[r,y]=c.useState(1),[b,l]=c.useState(!1),[n,g]=c.useState("create"),[u,v]=c.useState(null),[t,a]=c.useState({name:"",desc:"",captcha:"",prefix:"CBCTF",size:4,start:I(),duration:24}),i=c.useRef(null),x=6,w=E();c.useEffect(()=>{N()},[r]);const N=async()=>{try{const s=await J({limit:x,offset:(r-1)*x});s.code===200&&(h(s.data.contests),f(s.data.count))}catch(s){p.danger({description:"获取比赛列表失败"}),console.error(s)}},M=()=>{g("create"),a({name:"",desc:"",captcha:"",prefix:"CBCTF",size:4,start:I(),duration:24}),l(!0)},D=s=>{g("delete"),v(s),l(!0)},T=s=>{w(`/admin/contests/${s.id}`)},F=s=>{var j;v(s),(j=i.current)==null||j.click()},A=async s=>{var k;const j=(k=s.target.files)==null?void 0:k[0];if(s.target.value="",!!j)try{(await K(u.id,j)).code===200&&(p.success({description:"更新封面成功"}),N())}catch(C){console.error("更新封面失败: ",C),p.danger({description:"更新封面失败"})}},B=async()=>{try{n==="create"?(t.start=new Date(t.start).toISOString(),t.duration=parseInt(t.duration)*3600,(await Q(t)).code===200&&(p.success({description:"创建赛事成功"}),l(!1),N())):(await V(u.id)).code===200&&(p.success({description:"删除赛事成功"}),l(!1),N())}catch(s){console.error(`${n==="create"?"创建赛事成功":"删除赛事失败"}: `,s),p.danger({description:`${n==="create"?"创建赛事成功":"删除赛事失败"}`})}},O=()=>n==="create"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Contest Name"}),e.jsx("input",{type:"text",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.name,onChange:s=>a({...t,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Description"}),e.jsx("textarea",{className:"w-full h-[100px] bg-black/20 border border-neutral-300 rounded-md p-4 text-neutral-50 resize-none",value:t.desc,onChange:s=>a({...t,desc:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Flag Prefix"}),e.jsx("input",{type:"text",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.prefix,onChange:s=>a({...t,prefix:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Team Size"}),e.jsx("input",{type:"number",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.size,onChange:s=>a({...t,size:parseInt(s.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.start,onChange:s=>a({...t,start:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Duration (hours)"}),e.jsx("input",{type:"number",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.duration,onChange:s=>a({...t,duration:parseInt(s.target.value)})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("p",{className:"text-neutral-50",children:["Are you sure you want to delete the contest ",e.jsx("span",{className:"font-bold",children:u==null?void 0:u.name}),"?"]}),e.jsx("p",{className:"text-red-400 text-sm mt-2",children:"This action cannot be undone."})]}),R=()=>e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"default",onClick:()=>l(!1),children:"Cancel"}),e.jsx(S,{variant:n==="delete"?"danger":"primary",onClick:B,children:n==="create"?"Create":"Delete"})]});return e.jsxs(e.Fragment,{children:[e.jsx(Y,{contests:d,totalCount:o,currentPage:r,pageSize:x,onPageChange:y,onCreateContest:M,onDeleteContest:D,onContestClick:T,onAvatarUpload:F}),e.jsx(G,{isOpen:b,onClose:()=>l(!1),title:n==="create"?"Create Contest":"Delete Contest",size:n==="create"?"lg":"sm",footer:R(),children:O()}),e.jsx("input",{type:"file",ref:i,className:"hidden",accept:"image/*",onChange:A})]})}export{ne as default};
