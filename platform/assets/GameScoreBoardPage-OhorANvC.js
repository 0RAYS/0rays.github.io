import{j as e,m as T,B as h,g as ee,a as d,L as te}from"./index-C1-VdUwR.js";import{I as se,a as ae}from"./IconChevronsRight-CyFr62wG.js";import{S as ne,c as F,I as A,a as R,b as _}from"./ScoreboardStats-Dzi9FCV4.js";import{S as re}from"./ScrollingText-Brgjk3Q9.js";import{c as oe,a as ie,d as le,e as ce}from"./contest-QgjSpEj8.js";import{g as de}from"./team-Dib1EotZ.js";import{I as B}from"./IconTable-DP2qM5XA.js";import"./index-Ba_GdWnw.js";const me={Web:"bg-blue-400",Crypto:"bg-purple-400",Pwn:"bg-red-400",Reverse:"bg-green-400",Misc:"bg-yellow-400"};function xe({solved:n=[],totalSolved:i=0}){return console.log(n),console.log(i),!Array.isArray(n)||n.length===0?null:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.map(({category:m,solved:x,all:f})=>e.jsxs("div",{className:"flex flex-col items-center",title:`${m}: ${x}/${f}`,children:[e.jsx("div",{className:"text-[10px] font-mono text-neutral-400 mb-1",children:m.toUpperCase()}),e.jsx("div",{className:"h-6 w-1.5 rounded-full bg-neutral-700 relative overflow-hidden",children:e.jsx(T.div,{className:`absolute bottom-0 left-0 right-0 ${me[m]||"bg-neutral-400"}`,initial:{height:0},animate:{height:`${x/f*100}%`},transition:{duration:1}})}),e.jsx("div",{className:"text-[10px] font-mono text-neutral-300 mt-1",children:x})]},m)),e.jsx("div",{className:"h-full w-[1px] bg-neutral-300/10 mx-2"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-2xl font-mono text-geek-400",children:i}),e.jsx("div",{className:"text-[10px] text-neutral-400",children:"TOTAL"})]})]})}function D({currentPage:n,totalPages:i,onPageChange:m,showTotal:x=!1,totalItems:f}){const y=()=>{const s=[],c=Math.floor(2.5);let g=Math.max(n-c,1),b=Math.min(g+5-1,i);b-g+1<5&&(g=Math.max(b-5+1,1)),g>2?(s.push(1),s.push("prev-dot")):g===2&&s.push(1);for(let w=g;w<=b;w++)s.push(w);return b<i-1?(s.push("next-dot"),s.push(i)):b===i-1&&s.push(i),s},N=(s,t)=>typeof s=="string"?e.jsx("span",{className:"w-8 h-8 flex items-center justify-center text-neutral-400 font-mono",children:"..."},s):e.jsx(h,{variant:n===s?"primary":"ghost",size:"icon",className:`!w-8 !h-8 ${n===s?"":"!bg-black/30"}`,onClick:()=>m(s),children:s},s),C=s=>{const t=s==="next",c=t?n>=i:n<=1;return e.jsx(h,{variant:"ghost",size:"sm",disabled:c,onClick:()=>!c&&m(t?n+1:n-1),className:`!bg-black/30 ${c?"!border-neutral-300/10 !text-neutral-600":""}`,children:t?"下一页":"上一页"})},S=()=>{const s=n<=1,t=n>=i;return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",size:"icon",disabled:s,onClick:()=>!s&&m(1),className:`!w-8 !h-8 !bg-black/30 ${s?"!border-neutral-300/10 !text-neutral-600":""}`,children:e.jsx(se,{size:16})}),e.jsx(h,{variant:"ghost",size:"icon",disabled:t,onClick:()=>!t&&m(i),className:`!w-8 !h-8 !bg-black/30 ${t?"!border-neutral-300/10 !text-neutral-600":""}`,children:e.jsx(ae,{size:16})})]})};return e.jsxs(T.div,{className:"flex flex-wrap items-center justify-center gap-2 max-w-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[x&&f!==void 0&&e.jsxs("span",{className:"text-sm font-mono text-neutral-400 mr-4 whitespace-nowrap",children:["共 ",f," 条"]}),i>7&&e.jsx("div",{className:"flex items-center mr-1",children:S()}),C("prev"),e.jsx("div",{className:"flex items-center gap-1 md:gap-2 flex-wrap justify-center",children:y().map((s,t)=>N(s))}),C("next")]})}function ue({teams:n,currentPage:i,totalPages:m,onPageChange:x,viewMode:f="ranking",challenges:y=[],totalCount:N=0,tableCurrentPage:C,onTablePageChange:S,tableLoading:s=!1}){return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:f==="ranking"?e.jsxs(e.Fragment,{children:[e.jsxs(T.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[60px_240px_100px_auto_180px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:n.map((t,c)=>e.jsxs(T.div,{className:"grid grid-cols-[60px_240px_100px_auto_180px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200 cursor-pointer",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("span",{className:`font-mono text-xl
                                        ${t.rank===1?"text-yellow-400":t.rank===2?"text-neutral-300":t.rank===3?"text-orange-400":"text-neutral-400"}
                                    `,children:["#",t.rank]})}),e.jsxs("div",{className:"flex items-center gap-4 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar})`}}),e.jsx(re,{text:t.name,className:"text-neutral-50 font-mono",maxWidth:240,speed:15})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-geek-400 font-mono",children:t.score.toLocaleString()})}),t.solved&&e.jsx(xe,{solved:t.solved,totalSolved:t.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:t.lastSubmit})})]},c))})]}),m>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx(D,{currentPage:i,totalPages:m,onPageChange:x,showTotal:!0,totalItems:N})})]}):f==="table"?e.jsx(ne,{teams:n,challenges:y,totalCount:N,currentPage:C||1,pageSize:10,onPageChange:S,isAdmin:!1,PaginationComponent:D,loading:s}):e.jsx(F,{timelineData:y})})}function Ne(){const{contestId:n}=ee(),[i,m]=d.useState(1),[x]=d.useState(10),[f,y]=d.useState(0),[N,C]=d.useState(0),[S,s]=d.useState(!0),[t,c]=d.useState("ranking"),[g,b]=d.useState([]),[w,G]=d.useState([]),[O,U]=d.useState(1),[V,W]=d.useState(0),[H,z]=d.useState(!1),I=10,[L,K]=d.useState([]),[k,q]=d.useState({stats:{totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0},teams:[],userTeam:null}),$=(a,l)=>{const r=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-";return{rank:(i-1)*x+l+1,name:a.name,avatar:a.avatar,score:a.score,solved:a.solved,totalSolved:a.solved.reduce((o,p)=>o+p.solved,0),lastSubmit:r(a.last)}},J=a=>{const l=new Map;return a.forEach(r=>{r.solved&&Array.isArray(r.solved)&&r.solved.forEach(o=>{const p=o.category,v=o.all||0;for(let u=0;u<v;u++){const j=`${p}-${u+1}`;l.has(j)||l.set(j,{id:j,name:`${p} ${u+1}`,category:p,solved:0})}})}),Array.from(l.values()).sort((r,o)=>r.category!==o.category?r.category.localeCompare(o.category):r.name.localeCompare(o.name))},P=a=>a.teams.map((l,r)=>$(l,r)),Q=a=>{m(a),E(a)},X=a=>{U(a),M(a)},Y=async()=>{try{const a=await ce(n);a.code===200&&K(a.data||[])}catch(a){console.error("获取时间线数据失败:",a)}},M=async a=>{var l;z(!0);try{const r=await le(n,{limit:I,offset:(a-1)*I});if(r.code===200){b(r.data.teams||[]),W(r.data.count||0);const o=[],p=new Map;(l=r.data.teams)==null||l.forEach(v=>{var u;(u=v.challenges)==null||u.forEach(j=>{p.has(j.id)||(p.set(j.id,j),o.push(j))})}),o.sort((v,u)=>v.category!==u.category?v.category.localeCompare(u.category):v.name.localeCompare(u.name)),G(o)}}catch(r){console.error("获取表格数据失败:",r)}finally{z(!1)}},E=async a=>{s(!0);try{const l=await oe(n,x,(a-1)*x),r=await de(n),o=await ie(n);l.code===200&&r.code===200&&(q({stats:{totalTeams:o.data.teams||0,totalPlayers:o.data.users||0,totalSolves:o.data.solved||0,highestScore:o.data.highest||0},teams:P(l.data),userTeam:$(r.data)}),y(Math.ceil(l.data.count/x)),C(l.data.count))}catch(l){console.error("获取排行榜数据失败:",l)}finally{s(!1)}};if(d.useEffect(()=>{E(1)},[n]),d.useEffect(()=>{t==="table"&&g.length===0?M(1):t==="timeline"&&L.length===0&&Y()},[t]),S)return e.jsx(te,{});const Z=J(k.teams);return t==="timeline"?e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/30 border border-neutral-300/30 rounded-md",children:[e.jsx(h,{variant:t==="ranking"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(A,{size:16}),onClick:()=>c("ranking")}),e.jsx(h,{variant:t==="table"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(B,{size:16}),onClick:()=>c("table")}),e.jsx(h,{variant:t==="timeline"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(R,{size:16}),onClick:()=>c("timeline")})]})})]}),e.jsx(_,{...k.stats}),e.jsx(F,{timelineData:L})]}):e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/30 border border-neutral-300/30 rounded-md",children:[e.jsx(h,{variant:t==="ranking"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(A,{size:16}),onClick:()=>c("ranking")}),e.jsx(h,{variant:t==="table"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(B,{size:16}),onClick:()=>c("table")}),e.jsx(h,{variant:t==="timeline"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(R,{size:16}),onClick:()=>c("timeline")})]})})]}),e.jsx(_,{...k.stats}),e.jsx(ue,{...k,currentPage:i,totalPages:f,onPageChange:Q,viewMode:t,onViewModeChange:c,challenges:t==="table"?w:Z,totalCount:t==="table"?V:N,teams:t==="table"?g:k.teams,tableCurrentPage:O,onTablePageChange:X,tableLoading:H})]})}export{Ne as default};
