import{a as d,j as e,A as k,m as p,B as g,u as C,d as T,L as S,t as v}from"./index-C1-VdUwR.js";import{g as E}from"./contest-QgjSpEj8.js";import{g as _,j as O,c as I}from"./team-Dib1EotZ.js";function z({games:r=[],currentIndex:t,onIndexChange:i,onGameAction:u,user:c}){const[f,m]=d.useState(0),x=typeof t=="number"?t:f,n=r[x];d.useEffect(()=>{typeof t=="number"&&m(t)},[t]);const j=l=>{switch(l){case"upcoming":return"text-yellow-400";case"active":return"text-green-400";case"ended":return"text-neutral-400";default:return"text-neutral-300"}},o=()=>{const l=(x+1)%r.length;m(l),i==null||i(l)},b=()=>{const l=(x-1+r.length)%r.length;m(l),i==null||i(l)},h=()=>{if(!n)return;const l=n.status==="ended"?"view":"join";u==null||u(n.id,l)};return n?e.jsx("div",{className:"w-full max-w-[1200px] mx-auto relative",children:e.jsx(k,{mode:"wait",children:e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"relative",children:[e.jsx("div",{className:`absolute left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 
                            border rounded-md overflow-hidden
                            bg-black/30 backdrop-blur-[2px] group cursor-pointer
                            transition-all duration-200
                            ${r.length<=1?"border-neutral-600 opacity-50 cursor-not-allowed":"border-neutral-300 hover:border-geek-400"}`,onClick:()=>r.length>1&&b(),children:e.jsx(p.div,{className:"w-full h-full flex items-center justify-center",whileTap:r.length>1?{scale:.9}:{},children:e.jsx("span",{className:`text-xl transition-colors duration-200
                                ${r.length<=1?"text-neutral-600":"text-neutral-300 group-hover:text-geek-400"}`,children:"←"})})}),e.jsx("div",{className:`absolute right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 
                            border rounded-md overflow-hidden
                            bg-black/30 backdrop-blur-[2px] group cursor-pointer
                            transition-all duration-200
                            ${r.length<=1?"border-neutral-600 opacity-50 cursor-not-allowed":"border-neutral-300 hover:border-geek-400"}`,onClick:()=>r.length>1&&o(),children:e.jsx(p.div,{className:"w-full h-full flex items-center justify-center",whileTap:r.length>1?{scale:.9}:{},children:e.jsx("span",{className:`text-xl transition-colors duration-200
                                ${r.length<=1?"text-neutral-600":"text-neutral-300 group-hover:text-geek-400"}`,children:"→"})})}),e.jsxs(p.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.3},className:"relative h-[500px] border border-neutral-300 rounded-md overflow-hidden bg-black/30 backdrop-blur-[4px]",children:[e.jsx("div",{className:"absolute inset-0 opacity-40",style:{backgroundImage:`url(${n.image})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsxs("div",{className:"relative h-full p-8 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("h2",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:n.title}),e.jsx("span",{className:`px-3 py-1 border rounded-md text-sm ${j(n.status)}`,children:n.status.toUpperCase()})]}),e.jsx("p",{className:"text-neutral-300 max-w-[600px] line-clamp-3",children:n.description})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400",children:"Start:"}),e.jsx("span",{className:"text-neutral-200 font-mono",children:new Date(n.startTime).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400",children:"End:"}),e.jsx("span",{className:"text-neutral-200 font-mono",children:new Date(n.endTime).toLocaleString()})]})]}),e.jsx(g,{variant:"primary",size:"action",onClick:h,children:c!=null&&c.user?n.status==="ended"?"RESULTS":"JOIN NOW":n.status==="ended"?"ENDED":"LOGIN"})]})]}),r.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:r.map((l,N)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors duration-200 
                                            ${N===x?"bg-geek-400":"bg-neutral-300"}`},N))})]})]},x)})}):null}function G({isOpen:r,onClose:t,onCreateTeam:i,onJoinTeam:u}){const[c,f]=d.useState("select"),[m,x]=d.useState(!1),[n,j]=d.useState(null),[o,b]=d.useState({teamName:"",description:"",contestCode:""}),[h,l]=d.useState({teamName:"",teamCode:""}),N=async a=>{a.preventDefault(),j(null),x(!0);try{c==="create"?await i(o):c==="join"&&await u(h),t()}catch(s){j(s.message)}finally{x(!1)}};return r?e.jsxs("div",{className:"fixed inset-0 z-[900] flex items-center justify-center",children:[e.jsx(p.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t}),e.jsx("div",{className:"relative z-10 w-full max-w-[500px] p-4",children:e.jsxs(p.div,{className:"relative w-full bg-black/80 border border-neutral-300 rounded-md overflow-hidden",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-5 border-b border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono",children:c==="select"?"JOIN CONTEST":c==="create"?"CREATE TEAM":"JOIN TEAM"}),e.jsx(g,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-50",onClick:t,children:"✕"})]})}),e.jsx("div",{className:"p-6",children:e.jsx(k,{mode:"wait",children:c==="select"?e.jsxs(p.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[e.jsx(g,{variant:"primary",size:"lg",fullWidth:!0,className:"shadow-[0_0_20px_rgba(89,126,247,0.4)]",onClick:()=>f("create"),children:"CREATE NEW TEAM"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-[1px] flex-1 bg-neutral-300/30"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"OR"}),e.jsx("div",{className:"h-[1px] flex-1 bg-neutral-300/30"})]}),e.jsx(g,{variant:"outline",size:"lg",fullWidth:!0,onClick:()=>f("join"),children:"JOIN EXISTING TEAM"})]},"select"):c==="create"?e.jsxs(p.form,{className:"space-y-4",onSubmit:N,initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Team Name"}),e.jsx("input",{type:"text",value:o.teamName,onChange:a=>b(s=>({...s,teamName:a.target.value})),className:`w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200`,placeholder:"Enter team name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:a=>b(s=>({...s,description:a.target.value})),className:`w-full h-[80px] bg-black/20 border border-neutral-300 rounded-md p-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200 resize-none`,placeholder:"Describe your team"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Contest Invitation Code"}),e.jsx("input",{type:"text",value:o.contestCode,onChange:a=>b(s=>({...s,contestCode:a.target.value})),className:`w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200`,placeholder:"Enter contest code"})]}),n&&e.jsx(p.div,{className:"text-red-400 text-sm",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:n}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx(g,{type:"button",variant:"outline",fullWidth:!0,onClick:()=>f("select"),children:"BACK"}),e.jsx(g,{type:"submit",variant:"primary",fullWidth:!0,className:"shadow-[0_0_20px_rgba(89,126,247,0.4)]",disabled:!o.teamName||m,loading:m,children:m?"CREATING...":"CREATE"})]})]},"create"):e.jsxs(p.form,{className:"space-y-4",onSubmit:N,initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Team Name"}),e.jsx("input",{type:"text",value:h.teamName,onChange:a=>l(s=>({...s,teamName:a.target.value})),className:`w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200`,placeholder:"Enter team name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Team Invitation Code"}),e.jsx("input",{type:"text",value:h.teamCode,onChange:a=>l(s=>({...s,teamCode:a.target.value})),className:`w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200`,placeholder:"Enter team invitation code"})]}),n&&e.jsx(p.div,{className:"text-red-400 text-sm",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:n}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx(g,{type:"button",variant:"outline",fullWidth:!0,onClick:()=>f("select"),children:"BACK"}),e.jsx(g,{type:"submit",variant:"primary",fullWidth:!0,className:"shadow-[0_0_20px_rgba(89,126,247,0.4)]",disabled:!h.teamName||!h.teamCode||m,loading:m,children:m?"JOINING...":"JOIN"})]})]},"join")})})]})})]}):null}const $=(r,t)=>{const i=new Date().getTime(),u=new Date(r).getTime(),c=u+t*1e3;return i<u?"upcoming":i>c?"ended":"active"},A=r=>r.map(t=>{const i=new Date(t.start),u=new Date(i.getTime()+t.duration*1e3);return{id:t.id,title:`${t.prefix} ${t.name}`,description:t.desc,status:$(t.start,t.duration),startTime:i.toISOString(),endTime:u.toISOString(),image:t.avatar||"https://images.unsplash.com/photo-1562813733-b31f71025d54?q=80&w=2069&auto=format&fit=crop",teamSize:t.size,teamsCount:t.teams,usersCount:t.users,noticesCount:t.notices,isBlood:t.blood,isHidden:t.hidden}});function R(){const[r,t]=d.useState([]),[i,u]=d.useState(!0),[c,f]=d.useState(0),[m,x]=d.useState(!1),[n,j]=d.useState(null),o=C(),b=T(a=>a.user);d.useEffect(()=>{(async()=>{try{const s=await E();if(s.code===200){const w=A(s.data.contests);t(w)}}catch(s){v.danger({title:"获取比赛列表失败",description:s.message}),t([])}finally{u(!1)}})()},[]);const h=async(a,s)=>{if(!b.user){o("/login");return}if(r.find(y=>y.id===a))try{if((await _(a)).code===200)o(`/contests/${a}`);else switch(s){case"join":j(a),x(!0);break;default:o("/games");break}}catch(y){v.danger({title:"检查队伍状态失败",description:y.message})}},l=async a=>{try{(await I(n,{name:a.teamName,desc:a.description,captcha:a.contestCode})).code===200&&(v.success({description:"创建队伍成功"}),o(`/contests/${n}`))}catch(s){v.danger({title:"创建队伍失败",description:s.message})}},N=async a=>{try{const s=await O(n,{name:a.teamName,captcha:a.teamCode});if(s.code===200)v.success({description:"加入队伍成功"}),o(`/contests/${n}`);else throw new Error(s.msg||"加入队伍失败")}catch(s){v.danger({title:"加入队伍失败",description:s.message})}};return i?e.jsx(S,{}):e.jsxs("div",{children:[e.jsx(z,{games:r,currentIndex:c,onIndexChange:f,onGameAction:h,user:b}),e.jsx(G,{isOpen:m,onClose:()=>x(!1),onCreateTeam:l,onJoinTeam:N})]})}export{R as default};
