import{a as r,j as e,m as C,B as k,L as M,r as w,t as I}from"./index-Db61s3TU.js";import{A as E}from"./AdminPagination-Ba71d1IJ.js";import{I as z}from"./IconTrash-D6GVHslU.js";import{I as L}from"./IconUpload-B74oeHpd.js";import{I as T}from"./IconDownload-DhpYPX_g.js";import{A,M as S}from"./AdminModal-DPfqu6Km.js";import"./IconChevronsRight-dvjrSZ7h.js";import"./IconX-DTt29-Vh.js";function B({images:a=[],totalCount:c=0,currentPage:N=1,pageSize:g=12,loading:x=!1,onPageChange:y,onDelete:u,onBatchDelete:i,onDownload:h}){const[n,d]=r.useState([]),j=t=>{if(t===0)return"0 B";const l=1024,p=["B","KB","MB","GB"],v=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,v)).toFixed(2))+" "+p[v]},f=t=>{d(l=>l.includes(t)?l.filter(p=>p!==t):[...l,t])},b=()=>{d(t=>t.length===a.length?[]:a.map(l=>l.id))};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"图片管理"}),e.jsx("div",{className:"flex items-center gap-4",children:n.length>0&&e.jsxs(k,{variant:"danger",size:"sm",align:"icon-left",icon:e.jsx(z,{size:16}),onClick:()=>{i==null||i(n),d([])},children:["批量删除 (",n.length,")"]})})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.length===a.length&&a.length>0,onChange:b,className:"w-4 h-4 rounded border-neutral-300/30 bg-black/30 text-geek-400 focus:ring-0 focus:ring-offset-0"}),e.jsx("span",{className:"text-sm font-mono text-neutral-400",children:"全选"})]}),x?e.jsx(M,{}):a.length===0?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(L,{size:48,className:"text-neutral-400/30"}),e.jsx("span",{className:"text-sm font-mono text-neutral-400",children:"暂无图片"})]})}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6",children:a.map(t=>e.jsxs(C.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 overflow-hidden group",whileHover:{y:-2,borderColor:"rgba(89, 126, 247, 0.5)"},children:[e.jsxs("div",{className:"relative h-48 bg-black/50",children:[e.jsx("img",{src:t.url,alt:t.filename,className:"w-full h-full object-contain"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-black/50 !text-neutral-300 hover:!text-geek-400",onClick:()=>h==null?void 0:h(t),children:e.jsx(T,{size:20})}),e.jsx(k,{variant:"ghost",size:"icon",className:"!bg-black/50 !text-neutral-300 hover:!text-red-400",onClick:()=>u==null?void 0:u(t),children:e.jsx(z,{size:20})})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.includes(t.id),onChange:()=>f(t.id),className:"w-4 h-4 rounded border-neutral-300/30 bg-black/30 text-geek-400 focus:ring-0 focus:ring-offset-0"}),e.jsx("span",{className:"text-sm font-mono text-neutral-300 truncate max-w-[150px]",children:t.filename})]}),e.jsx("span",{className:"text-xs font-mono text-neutral-400",children:j(t.size)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-mono text-neutral-400",children:new Date(t.uploadTime).toLocaleDateString()}),e.jsx("span",{className:"text-xs font-mono text-neutral-400 uppercase",children:t.type})]})]})]},t.id))}),c>g&&e.jsx(E,{total:Math.ceil(c/g),current:N,onChange:y,showTotal:!0,totalItems:c})]})})}function F({limit:a=12,offset:c=0}){return w({url:"/admin/avatars",method:"GET",params:{limit:a,offset:c}})}function P({file_ids:a=[]}){return w({url:"/admin/avatars",method:"DELETE",data:{file_ids:a}})}function O(a){return`${w.defaults.baseURL}/avatars/${a}`}function D(){const[a,c]=r.useState([]),[N,g]=r.useState(0),[x,y]=r.useState(1),[u,i]=r.useState(!1),[h,n]=r.useState(!1),[d,j]=r.useState([]),f=12;r.useEffect(()=>{b()},[x]);const b=async()=>{i(!0);try{const s=await F({limit:f,offset:(x-1)*f});if(s.code===200){const o=s.data.avatars.map(m=>({id:m.id,url:O(m.id),filename:m.filename,size:m.size,type:m.type,uploadTime:m.date}));c(o),g(s.data.count)}}catch(s){I.danger({description:"获取图片列表失败"}),console.error(s)}finally{i(!1)}},t=s=>{j([s.id]),n(!0)},l=s=>{j(s),n(!0)},p=s=>{const o=document.createElement("a");o.href=s.url,o.download=s.filename,document.body.appendChild(o),o.click(),o.remove()},v=async()=>{try{(await P({file_ids:d})).code===200&&(I.success({description:"删除图片成功"}),n(!1),b())}catch(s){console.error("删除图片失败:",s),I.danger({description:"删除图片失败"})}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{images:a,totalCount:N,currentPage:x,pageSize:f,loading:u,onPageChange:y,onDelete:t,onBatchDelete:l,onDownload:p}),e.jsx(A,{isOpen:h,onClose:()=>n(!1),title:"确认删除",size:"sm",footer:e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"default",onClick:()=>n(!1),children:"取消"}),e.jsx(S,{variant:"danger",onClick:v,children:"确认"})]}),children:e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("p",{className:"text-neutral-50",children:["确定要删除选中的 ",d.length," 张图片吗？"]}),e.jsx("p",{className:"text-red-400 text-sm mt-2",children:"此操作不可恢复。"})]})})]})}export{D as default};
