import{r as v,a as d,t as y,j as e,m as i,B as b,A as N,u as _,b as k,s as g,f as P}from"./index-CGfkfi28.js";import{l as S,r as E}from"./auth-B-v5HK3-.js";const O=()=>v({url:"/oauth",method:"GET"});function I(){const[c,s]=d.useState({}),[u,a]=d.useState(!0);d.useEffect(()=>{o()},[]);const o=async()=>{try{a(!0);const r=await O();r.code===200&&s(r.data)}catch(r){console.error("获取OAuth提供商失败:",r),y.danger({description:"获取第三方登录提供商失败"})}finally{a(!1)}},t=(r,l)=>{window.location.href=l};return u?e.jsx("div",{className:"flex justify-center items-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-neutral-300"})}):Object.keys(c).length===0?null:e.jsxs(i.div,{className:"space-y-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-neutral-600"})}),e.jsx("div",{className:"relative flex justify-center text-xs",children:e.jsx("span",{className:"bg-black/40 px-2 text-neutral-400",children:"或使用第三方登录"})})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(c).map(([r,l])=>e.jsxs(i.button,{onClick:()=>t(r,l.url),className:`w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 \r
                     text-neutral-50 hover:border-geek-400 hover:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                     transition-all duration-200 flex items-center justify-center gap-3`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("img",{src:l.avatar,alt:l.name,className:"w-5 h-5 rounded-full",onError:p=>{p.target.style.display="none"}}),e.jsxs("span",{className:"font-medium",children:["使用 ",l.name," 登录"]})]},r))})]})}function L({onSubmit:c}){const[s,u]=d.useState(!0),[a,o]=d.useState({username:"",password:"",confirmPassword:"",email:""}),[t,r]=d.useState({}),[l,p]=d.useState(!1),w=()=>{const n={};return a.username.length<3&&(n.username="Username must be at least 3 characters"),a.password.length<6&&(n.password="Password must be at least 6 characters"),s||(a.confirmPassword!==a.password&&(n.confirmPassword="Passwords do not match"),/\S+@\S+\.\S+/.test(a.email)||(n.email="Invalid email address")),r(n),Object.keys(n).length===0},j=async n=>{if(n.preventDefault(),!!w()){p(!0);try{await c({type:s?"login":"register",data:{username:a.username,password:a.password,...s?{}:{email:a.email,confirmPassword:a.confirmPassword}}})}catch(m){r(h=>({...h,submit:m.message}))}finally{p(!1)}}},x=n=>{const{name:m,value:h}=n.target;o(f=>({...f,[m]:h})),t[m]&&r(f=>({...f,[m]:""}))};return e.jsxs(i.div,{className:"w-[400px] bg-black/40 backdrop-blur-[2px] border border-neutral-300 rounded-md p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:[e.jsxs("div",{className:"relative flex justify-center mb-8",children:[e.jsx("div",{className:"absolute -top-[3px] -right-[3px] w-[10px] h-[10px] border-t border-r border-neutral-300"}),e.jsx("div",{className:"absolute -bottom-[3px] -left-[3px] w-[10px] h-[10px] border-b border-l border-neutral-300"}),e.jsx(i.span,{className:"text-neutral-300 text-2xl font-mono tracking-wider",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:s?"LOGIN":"REGISTER"},s?"login":"register")]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-8",children:[e.jsx(b,{variant:s?"primary":"outline",size:"sm",className:"min-w-[100px]",onClick:()=>u(!0),children:"LOGIN"}),e.jsx(b,{variant:s?"outline":"primary",size:"sm",className:"min-w-[100px]",onClick:()=>u(!1),children:"REGISTER"})]}),e.jsxs(i.form,{onSubmit:j,className:"space-y-4",animate:{height:"auto"},transition:{duration:.2},children:[e.jsx(N,{mode:"wait",children:e.jsx(i.div,{initial:{opacity:0,x:s?-20:20},animate:{opacity:1,x:0},exit:{opacity:0,x:s?20:-20},transition:{duration:.2,ease:"easeOut"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",required:!0,name:"username",value:a.username,onChange:x,placeholder:"Username",className:`
                                        w-full h-[40px] bg-black/20 border rounded-md px-4 
                                        text-neutral-50 placeholder-neutral-400
                                        transition-all duration-200
                                        ${t.username?"border-red-500 focus:border-red-500 focus:shadow-[0_0_15px_rgba(239,68,68,0.3)]":"border-neutral-300 focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]"}
                                    `}),t.username&&e.jsx(i.span,{className:"text-red-500 text-xs mt-1 block",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},children:t.username})]}),!s&&e.jsxs(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.15,ease:"easeInOut"},children:[e.jsx("input",{type:"email",name:"email",required:!0,value:a.email,onChange:x,placeholder:"Email",className:`
                                            w-full h-[40px] bg-black/20 border rounded-md px-4 
                                            text-neutral-50 placeholder-neutral-400
                                            transition-all duration-200
                                            ${t.email?"border-red-500 focus:border-red-500 focus:shadow-[0_0_15px_rgba(239,68,68,0.3)]":"border-neutral-300 focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]"}
                                        `}),t.email&&e.jsx(i.span,{className:"text-red-500 text-xs mt-1 block",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:t.email})]}),e.jsxs("div",{children:[e.jsx("input",{type:"password",name:"password",required:!0,value:a.password,onChange:x,placeholder:"Password",className:`
                                        w-full h-[40px] bg-black/20 border rounded-md px-4 
                                        text-neutral-50 placeholder-neutral-400
                                        transition-all duration-200
                                        ${t.password?"border-red-500 focus:border-red-500 focus:shadow-[0_0_15px_rgba(239,68,68,0.3)]":"border-neutral-300 focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]"}
                                    `}),t.password&&e.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:t.password})]}),!s&&e.jsxs(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.15,ease:"easeInOut"},children:[e.jsx("input",{type:"password",name:"confirmPassword",required:!0,value:a.confirmPassword,onChange:x,placeholder:"Confirm Password",className:`
                                            w-full h-[40px] bg-black/20 border rounded-md px-4 
                                            text-neutral-50 placeholder-neutral-400
                                            transition-all duration-200
                                            ${t.confirmPassword?"border-red-500 focus:border-red-500 focus:shadow-[0_0_15px_rgba(239,68,68,0.3)]":"border-neutral-300 focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]"}
                                        `}),t.confirmPassword&&e.jsx(i.span,{className:"text-red-500 text-xs mt-1 block",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:t.confirmPassword})]})]})},s?"login-form":"register-form")}),e.jsx(b,{type:"submit",variant:"primary",fullWidth:!0,className:"shadow-[0_0_20px_rgba(89,126,247,0.4)]",disabled:l,children:l?"Processing...":s?"LOGIN":"REGISTER"})]}),e.jsx(I,{})]})}function G(){const c=_(),s=k(),u=async({type:a,data:o})=>{const t=(a==="login"?"登录":"注册")+"失败";try{let r;s(g({effect:a,loading:!0})),a==="login"?r=await S({name:o.username,password:o.password}):r=await E({name:o.username,email:o.email,password:o.password}),r.code===200&&(await s(P()),c("/games"))}catch(r){throw console.error(`${a} failed:`,r.message),y.danger({title:t,description:r.message}),r}finally{s(g({effect:a,loading:!1}))}};return e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-190px)]",children:e.jsx(L,{onSubmit:u})})}export{G as default};
