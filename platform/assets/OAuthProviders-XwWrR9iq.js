import{r as g,j as e,m as S,B as j,a as i,t as d}from"./index-D2Yzijmo.js";import{A as M,L as k}from"./AdminList-jRxxkjGb.js";import{A as R}from"./AdminPagination-Df6DGPbV.js";import{I as U}from"./IconPlus-sBoH389S.js";import{I as T}from"./IconEdit-CoV0FDlD.js";import{I as z}from"./IconTrash-B2jorrnw.js";import{A as E,M as y}from"./AdminModal-B5PymiOA.js";import"./IconChevronsRight-DNm20Ug4.js";import"./IconX-Pvzn4-wk.js";const F=(n={limit:10,offset:0})=>g({url:"/admin/oauth",method:"GET",params:n}),D=n=>g({url:"/admin/oauth",method:"POST",data:n}),B=(n,o)=>g({url:`/admin/oauth/${n}`,method:"PUT",data:o}),G=n=>g({url:`/admin/oauth/${n}`,method:"DELETE"});function $({providers:n=[],totalCount:o=0,currentPage:_=1,pageSize:f=10,loading:m=!1,onPageChange:v,onCreateProvider:x,onEditProvider:h,onDeleteProvider:s,onProviderClick:c}){const p=[{key:"avatar",label:"Logo",width:"5%"},{key:"provider",label:"服务商",width:"5%"},{key:"uri",label:"URI",width:"5%"},{key:"status",label:"启用",width:"5%"},{key:"callback_url",label:"CallbackURL",width:"10%"},{key:"actions",label:"操作",width:"5%"}],u=(a,r)=>{switch(r.key){case"avatar":return e.jsx("div",{className:"relative w-10 h-10 rounded-full overflow-hidden",children:e.jsx("img",{src:a.avatar,alt:a.provider,className:"w-full h-full object-cover"})});case"provider":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-neutral-50 font-medium",children:a.provider}),e.jsxs("span",{className:"text-xs text-neutral-400",children:["ID: ",a.id]})]});case"uri":return e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:a.uri});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:a.on?e.jsx(k,{type:"success",text:"已启用"}):e.jsx(k,{type:"warning",text:"已禁用"})});case"callback_url":return e.jsx("div",{className:"max-w-25 truncate",title:a.callback_url,children:e.jsx("span",{className:"text-neutral-300 text-sm",children:a.callback_url||""})});case"actions":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),h==null||h(a)},className:"p-1",children:e.jsx(T,{size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),s==null||s(a)},className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(z,{size:16})})]});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(S.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"Oauth 管理"}),e.jsx(j,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(U,{size:16}),onClick:x,children:"添加 Oauth Provider"})]}),e.jsx(M,{data:n,columns:p,renderCell:u,onRowClick:c,loading:m,emptyMessage:"暂无 OAuth Provider"}),o>f&&e.jsx(R,{current:_,total:Math.ceil(o/f),onChange:v,showTotal:!0,totalItems:o})]})})}function ee(){const[n,o]=i.useState([]),[_,f]=i.useState(0),[m,v]=i.useState(1),x=10,[h,s]=i.useState(!1),[c,p]=i.useState(null),[u,a]=i.useState("edit"),[r,l]=i.useState({provider:"",uri:"",auth_url:"",token_url:"",user_info_url:"",callback_url:"",client_id:"",client_secret:"",avatar:"",resp_avatar_field:"",resp_name_field:"",resp_email_field:"",resp_desc_field:"",resp_id_field:"",on:!1});i.useEffect(()=>{b()},[m]);const b=async()=>{try{const t=await F({limit:x,offset:(m-1)*x});t.code===200&&(o(t.data.providers),f(t.data.count))}catch(t){d.danger({description:"获取OAuth Provider列表失败"}),console.error(t)}},C=()=>{a("create"),p(null),l({provider:"",uri:"",auth_url:"",token_url:"",user_info_url:"",callback_url:"",client_id:"",client_secret:"",avatar:"",resp_avatar_field:"",resp_name_field:"",resp_email_field:"",resp_desc_field:"",resp_id_field:"",on:!1}),s(!0)},N=t=>{a("edit"),p(t),l({provider:t.provider,uri:t.uri,auth_url:t.auth_url,token_url:t.token_url,user_info_url:t.user_info_url,callback_url:t.callback_url||"",client_id:t.client_id,client_secret:t.client_secret,avatar:t.avatar,resp_avatar_field:t.resp_avatar_field,resp_name_field:t.resp_name_field,resp_email_field:t.resp_email_field,resp_desc_field:t.resp_desc_field,resp_id_field:t.resp_id_field,on:t.on}),s(!0)},w=t=>{a("delete"),p(t),s(!0)},P=t=>{N(t)},A=async()=>{try{(await D(r)).code===200&&(d.success({description:"创建OAuth Provider成功"}),s(!1),b())}catch(t){d.danger({description:"创建OAuth Provider失败"}),console.error(t)}},O=async()=>{try{(await B(c.id,r)).code===200&&(d.success({description:"更新OAuth Provider成功"}),s(!1),b())}catch(t){d.danger({description:"更新OAuth Provider失败"}),console.error(t)}},q=async()=>{try{(await G(c.id)).code===200&&(d.success({description:"删除OAuth Provider成功"}),s(!1),b())}catch(t){d.danger({description:"删除OAuth Provider失败"}),console.error(t)}},I=()=>u==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-neutral-300 mb-4",children:["确定要删除 OAuth Provider ",e.jsx("span",{className:"font-semibold text-red-400",children:c==null?void 0:c.provider})," ","吗？"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"此操作不可撤销。"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"提供商名称 *"}),e.jsx("input",{type:"text",required:!0,value:r.provider,onChange:t=>l({...r,provider:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: Github"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"URI *"}),e.jsx("input",{type:"text",required:!0,value:r.uri,onChange:t=>l({...r,uri:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: github, url 将拼接为 /oauth/github"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"授权URL *"}),e.jsx("input",{type:"url",required:!0,value:r.auth_url,onChange:t=>l({...r,auth_url:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/oauth/authorize"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"Token URL *"}),e.jsx("input",{type:"url",required:!0,value:r.token_url,onChange:t=>l({...r,token_url:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/oauth/token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"用户信息URL *"}),e.jsx("input",{type:"url",required:!0,value:r.user_info_url,onChange:t=>l({...r,user_info_url:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://api.example.com/user"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"回调URL"}),e.jsx("input",{type:"url",required:!0,value:r.callback_url,onChange:t=>l({...r,callback_url:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/oauth/callback"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"ClientID"}),e.jsx("input",{type:"text",required:!0,value:r.client_id,onChange:t=>l({...r,client_id:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ClientID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"ClientSecret"}),e.jsx("input",{type:"password",required:!0,value:r.client_secret,onChange:t=>l({...r,client_secret:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ClientSecret"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-neutral-200 font-medium",children:"字段映射"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"头像字段"}),e.jsx("input",{type:"text",required:!0,value:r.resp_avatar_field,onChange:t=>l({...r,resp_avatar_field:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"{avatar_url}"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"名称字段"}),e.jsx("input",{type:"text",required:!0,value:r.resp_name_field,onChange:t=>l({...r,resp_name_field:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"{name}"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮箱字段"}),e.jsx("input",{type:"text",required:!0,value:r.resp_email_field,onChange:t=>l({...r,resp_email_field:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"{email}"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"描述字段"}),e.jsx("input",{type:"text",required:!0,value:r.resp_desc_field,onChange:t=>l({...r,resp_desc_field:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"{bio}"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"ID字段"}),e.jsx("input",{type:"text",required:!0,value:r.resp_id_field,onChange:t=>l({...r,resp_id_field:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"{id}"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"Logo URL"}),e.jsx("input",{type:"url",value:r.avatar,onChange:t=>l({...r,avatar:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/avatar.png"})]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"on",checked:r.on,onChange:t=>l({...r,on:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"on",className:"text-neutral-300",children:"启用"})]})]}),L=()=>e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:()=>s(!1),children:"取消"}),e.jsx(y,{variant:u==="delete"?"danger":"primary",onClick:u==="create"?A:u==="edit"?O:q,children:u==="create"?"创建":u==="edit"?"保存":"删除"})]});return e.jsxs(e.Fragment,{children:[e.jsx($,{providers:n,totalCount:_,currentPage:m,pageSize:x,loading:!1,onPageChange:v,onCreateProvider:C,onEditProvider:N,onDeleteProvider:w,onProviderClick:P}),e.jsx(E,{isOpen:h,onClose:()=>s(!1),title:u==="create"?"创建 OAuth Provider":u==="edit"?"编辑 OAuth Provider":"删除 OAuth Provider",size:u!=="delete"?"lg":"sm",footer:L(),children:I()})]})}export{ee as default};
