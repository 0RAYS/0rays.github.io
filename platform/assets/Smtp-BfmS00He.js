import{c as V,r as v,j as e,m as z,B as w,a as i,t as h}from"./index-CGfkfi28.js";import{A,L as k}from"./AdminList-l_GlyEnL.js";import{A as L}from"./AdminPagination-Bz9TGggw.js";import{I as ee}from"./IconPlus-CycaSgt5.js";import{I as te}from"./IconEdit-BaCsBMQe.js";import{I as se}from"./IconTrash-B-Auo0pt.js";import{I as ae}from"./IconEye-CqzBL1Jv.js";import{A as I,M}from"./AdminModal-DQWuAHfX.js";import"./IconChevronsRight-DLBn-j29.js";import"./IconX-Dek9knIy.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z",key:"svg-0"}],["path",{d:"M3 7l9 6l9 -6",key:"svg-1"}]],ne=V("outline","mail","Mail",le),re=(l={limit:10,offset:0})=>v({url:"/admin/smtp",method:"GET",params:l}),ce=l=>v({url:"/admin/smtp",method:"POST",data:l}),ie=(l,x)=>v({url:`/admin/smtp/${l}`,method:"PUT",data:x}),oe=l=>v({url:`/admin/smtp/${l}`,method:"DELETE"}),de=(l={limit:10,offset:0})=>v({url:"/admin/email",method:"GET",params:l});function me({smtpConfigs:l=[],totalCount:x=0,currentPage:g=1,pageSize:p=10,loading:f=!1,onPageChange:N,onCreateSmtp:d,onEditSmtp:j,onDeleteSmtp:r,onSmtpClick:o}){const c=[{key:"id",label:"ID",width:"5%"},{key:"address",label:"邮箱地址",width:"15%"},{key:"host",label:"SMTP服务器",width:"15%"},{key:"port",label:"端口",width:"8%"},{key:"status",label:"状态",width:"10%"},{key:"success",label:"成功次数",width:"10%"},{key:"failure",label:"失败次数",width:"10%"},{key:"actions",label:"操作",width:"5%"}],n=(a,s)=>{switch(s.key){case"id":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-neutral-50 font-medium",children:["#",a.id]})});case"address":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-50 font-medium",children:a.address})});case"host":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:a.host})});case"port":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:a.port})});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:a.on?e.jsx(k,{type:"success",text:"已启用"}):e.jsx(k,{type:"warning",text:"已禁用"})});case"success":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-green-400 font-medium",children:a.success||0}),a.success_last&&e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(a.success_last).toLocaleString()})]});case"failure":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-red-400 font-medium",children:a.failure||0}),a.failure_last&&e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(a.failure_last).toLocaleString()})]});case"actions":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),j==null||j(a)},className:"p-1",children:e.jsx(te,{size:16})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),r==null||r(a)},className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(se,{size:16})})]});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(z.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"SMTP 管理"}),e.jsx(w,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(ee,{size:16}),onClick:d,children:"添加 SMTP 配置"})]}),e.jsx(A,{data:l,columns:c,renderCell:n,onRowClick:o,loading:f,empty:l.length===0,emptyContent:"暂无 SMTP 配置"}),x>p&&e.jsx(L,{currentPage:g,totalCount:x,pageSize:p,onPageChange:N})]})})}function xe({emailHistory:l=[],totalCount:x=0,currentPage:g=1,pageSize:p=10,loading:f=!1,onPageChange:N,onViewEmail:d,onEmailClick:j}){const r=[{key:"id",label:"ID",width:"5%"},{key:"from",label:"发件人",width:"15%"},{key:"to",label:"收件人",width:"15%"},{key:"subject",label:"主题",width:"20%"},{key:"status",label:"状态",width:"10%"},{key:"time",label:"发送时间",width:"15%"},{key:"actions",label:"操作",width:"5%"}],o=(c,n)=>{switch(n.key){case"id":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-neutral-50 font-medium",children:["#",c.id]})});case"from":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-50 font-medium",children:c.from})});case"to":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:c.to})});case"subject":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 text-sm truncate max-w-48",title:c.subject,children:c.subject||"无主题"})});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:c.success?e.jsx(k,{type:"success",text:"发送成功"}):e.jsx(k,{type:"error",text:"发送失败"})});case"time":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 text-sm",children:new Date(c.time).toLocaleString()})});case"actions":return e.jsx("div",{className:"flex gap-2",children:e.jsx(w,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),d==null||d(c)},className:"p-1",title:"查看详情",children:e.jsx(ae,{size:16})})});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(z.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{size:24,className:"text-neutral-50"}),e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"邮件发送历史"})]})}),e.jsx(A,{data:l,columns:r,renderCell:o,onRowClick:j,loading:f,empty:l.length===0,emptyContent:"暂无邮件发送记录"}),x>p&&e.jsx(L,{currentPage:g,totalCount:x,pageSize:p,onPageChange:N})]})})}function ke(){const[l,x]=i.useState([]),[g,p]=i.useState(0),[f,N]=i.useState(1),d=10,[j,r]=i.useState(!1),[o,c]=i.useState(null),[n,a]=i.useState("edit"),[s,m]=i.useState({address:"",host:"",port:587,pwd:"",on:!1}),[D,O]=i.useState([]),[F,_]=i.useState(0),[S,q]=i.useState(1),[H,C]=i.useState(!1),[u,R]=i.useState(null),[b,P]=i.useState("smtp");i.useEffect(()=>{b==="smtp"?y():b==="history"&&$()},[f,S,b]);const y=async()=>{try{const t=await re({limit:d,offset:(f-1)*d});t.code===200&&(x(t.data.smtps||t.data),p(t.data.count||t.data.length))}catch(t){h.danger({description:"获取SMTP配置列表失败"}),console.error(t)}},$=async()=>{try{const t=await de({limit:d,offset:(S-1)*d});t.code===200&&(O(t.data.emails||t.data),_(t.data.count||t.data.length))}catch(t){h.danger({description:"获取邮件历史记录失败"}),console.error(t)}},B=()=>{a("create"),c(null),m({address:"",host:"",port:587,pwd:"",on:!1}),r(!0)},T=t=>{a("edit"),c(t),m({address:t.address,host:t.host,port:t.port,pwd:"",on:t.on}),r(!0)},G=t=>{a("delete"),c(t),r(!0)},U=t=>{T(t)},E=t=>{R(t),C(!0)},J=t=>{E(t)},K=async()=>{try{(await ce(s)).code===200&&(h.success({description:"创建SMTP配置成功"}),r(!1),y())}catch(t){h.danger({description:"创建SMTP配置失败"}),console.error(t)}},Q=async()=>{try{const t={};s.address!==o.address&&(t.address=s.address),s.host!==o.host&&(t.host=s.host),s.port!==o.port&&(t.port=s.port),s.pwd&&(t.pwd=s.pwd),s.on!==o.on&&(t.on=s.on),(await ie(o.id,t)).code===200&&(h.success({description:"更新SMTP配置成功"}),r(!1),y())}catch(t){h.danger({description:"更新SMTP配置失败"}),console.error(t)}},W=async()=>{try{(await oe(o.id)).code===200&&(h.success({description:"删除SMTP配置成功"}),r(!1),y())}catch(t){h.danger({description:"删除SMTP配置失败"}),console.error(t)}},X=()=>n==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-neutral-300 mb-4",children:["确定要删除 SMTP 配置 ",e.jsx("span",{className:"font-semibold text-red-400",children:o==null?void 0:o.address})," 吗？"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"此操作不可撤销。"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮箱地址 *"}),e.jsx("input",{type:"email",required:!0,value:s.address,onChange:t=>m({...s,address:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: noreply@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"SMTP服务器 *"}),e.jsx("input",{type:"text",required:!0,value:s.host,onChange:t=>m({...s,host:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: smtp.gmail.com"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"端口 *"}),e.jsx("input",{type:"number",required:!0,value:s.port,onChange:t=>m({...s,port:parseInt(t.target.value)||587}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"587",min:"1",max:"65535"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:n==="create"?"密码 *":"密码 (留空不修改)"}),e.jsx("input",{type:"password",required:n==="create",value:s.pwd,onChange:t=>m({...s,pwd:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:n==="create"?"邮箱密码或应用专用密码":"留空不修改密码"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"on",checked:s.on,onChange:t=>m({...s,on:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"on",className:"text-neutral-300",children:"启用此SMTP配置"})]})]}),Y=()=>e.jsxs(e.Fragment,{children:[e.jsx(M,{onClick:()=>r(!1),children:"取消"}),e.jsx(M,{variant:n==="delete"?"danger":"primary",onClick:n==="create"?K:n==="edit"?Q:W,children:n==="create"?"创建":n==="edit"?"保存":"删除"})]}),Z=()=>u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件ID"}),e.jsxs("div",{className:"text-neutral-50 font-mono",children:["#",u.id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发送状态"}),e.jsx("div",{children:u.success?e.jsx("span",{className:"text-green-400",children:"发送成功"}):e.jsx("span",{className:"text-red-400",children:"发送失败"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发件人"}),e.jsx("div",{className:"text-neutral-50",children:u.from})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"收件人"}),e.jsx("div",{className:"text-neutral-50",children:u.to})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件主题"}),e.jsx("div",{className:"text-neutral-50",children:u.subject||"无主题"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发送时间"}),e.jsx("div",{className:"text-neutral-50",children:new Date(u.time).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件内容"}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3 max-h-60 overflow-y-auto",children:e.jsx("pre",{className:"text-neutral-300 text-sm whitespace-pre-wrap font-mono",children:u.content||"无内容"})})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full max-w-[1200px] mx-auto mb-6",children:e.jsxs("div",{className:"flex border-b border-neutral-700",children:[e.jsx("button",{className:`px-6 py-3 text-sm font-medium transition-colors ${b==="smtp"?"text-blue-400 border-b-2 border-blue-400":"text-neutral-400 hover:text-neutral-300"}`,onClick:()=>P("smtp"),children:"SMTP 配置"}),e.jsx("button",{className:`px-6 py-3 text-sm font-medium transition-colors ${b==="history"?"text-blue-400 border-b-2 border-blue-400":"text-neutral-400 hover:text-neutral-300"}`,onClick:()=>P("history"),children:"邮件历史"})]})}),b==="smtp"&&e.jsx(me,{smtpConfigs:l,totalCount:g,currentPage:f,pageSize:d,loading:!1,onPageChange:N,onCreateSmtp:B,onEditSmtp:T,onDeleteSmtp:G,onSmtpClick:U}),b==="history"&&e.jsx(xe,{emailHistory:D,totalCount:F,currentPage:S,pageSize:d,loading:!1,onPageChange:q,onViewEmail:E,onEmailClick:J}),e.jsx(I,{isOpen:j,onClose:()=>r(!1),title:n==="create"?"创建 SMTP 配置":n==="edit"?"编辑 SMTP 配置":"删除 SMTP 配置",size:n!=="delete"?"lg":"sm",footer:Y(),children:X()}),e.jsx(I,{isOpen:H,onClose:()=>C(!1),title:"邮件详情",size:"lg",footer:e.jsx(M,{onClick:()=>C(!1),children:"关闭"}),children:Z()})]})}export{ke as default};
