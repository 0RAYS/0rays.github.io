import{c as le,r as v,j as e,m as D,B as k,a as i,t as f}from"./index-D2Yzijmo.js";import{A as O,L as M}from"./AdminList-jRxxkjGb.js";import{A as F}from"./AdminPagination-Df6DGPbV.js";import{I as ne}from"./IconPlus-sBoH389S.js";import{I as re}from"./IconEdit-CoV0FDlD.js";import{I as ie,a as ce}from"./IconHistory-DxOPwWAn.js";import{I as oe}from"./IconTrash-B2jorrnw.js";import{A as L,M as I}from"./AdminModal-B5PymiOA.js";import"./IconChevronsRight-DNm20Ug4.js";import"./IconX-Pvzn4-wk.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z",key:"svg-0"}],["path",{d:"M3 7l9 6l9 -6",key:"svg-1"}]],me=le("outline","mail","Mail",de),xe=(r={limit:10,offset:0})=>v({url:"/admin/smtp",method:"GET",params:r}),ue=r=>v({url:"/admin/smtp",method:"POST",data:r}),he=(r,c)=>v({url:`/admin/smtp/${r}`,method:"PUT",data:c}),pe=r=>v({url:`/admin/smtp/${r}`,method:"DELETE"}),fe=(r,c={limit:10,offset:0})=>v({url:`/admin/smtp/${r}/email`,method:"GET",params:c}),je=(r={limit:10,offset:0})=>v({url:"/admin/email",method:"GET",params:r});function be({smtpConfigs:r=[],totalCount:c=0,currentPage:y=1,pageSize:u=10,loading:j=!1,onPageChange:w,onCreateSmtp:m,onEditSmtp:h,onDeleteSmtp:b,onSmtpClick:o,onViewHistory:l}){const x=[{key:"id",label:"ID",width:"5%"},{key:"address",label:"邮箱地址",width:"15%"},{key:"host",label:"SMTP服务器",width:"15%"},{key:"port",label:"端口",width:"8%"},{key:"status",label:"状态",width:"10%"},{key:"success",label:"成功次数",width:"10%"},{key:"failure",label:"失败次数",width:"10%"},{key:"actions",label:"操作",width:"5%"}],s=(n,a)=>{switch(a.key){case"id":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-neutral-50 font-medium",children:["#",n.id]})});case"address":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-50 font-medium",children:n.address})});case"host":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:n.host})});case"port":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:n.port})});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:n.on?e.jsx(M,{type:"success",text:"已启用"}):e.jsx(M,{type:"warning",text:"已禁用"})});case"success":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-green-400 font-medium",children:n.success||0}),n.success_last&&e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(n.success_last).toLocaleString()})]});case"failure":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-red-400 font-medium",children:n.failure||0}),n.failure_last&&e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(n.failure_last).toLocaleString()})]});case"actions":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:d=>{d.stopPropagation(),h==null||h(n)},className:"p-1",children:e.jsx(re,{size:16})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:d=>{d.stopPropagation(),l==null||l(n)},className:"p-1",title:"查看历史",children:e.jsx(ie,{size:16})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:d=>{d.stopPropagation(),b==null||b(n)},className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(oe,{size:16})})]});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(D.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"SMTP 管理"}),e.jsx(k,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(ne,{size:16}),onClick:m,children:"添加 SMTP 配置"})]}),e.jsx(O,{data:r,columns:x,renderCell:s,onRowClick:o,loading:j,empty:r.length===0,emptyContent:"暂无 SMTP 配置"}),c>u&&e.jsx(F,{current:y,total:Math.ceil(c/u),onChange:w,showTotal:!0,totalItems:c})]})})}function ge({emailHistory:r=[],totalCount:c=0,currentPage:y=1,pageSize:u=10,loading:j=!1,onPageChange:w,onPageSizeChange:m,onViewEmail:h,onEmailClick:b,smtpAddress:o}){const l=[{key:"id",label:"ID",width:"5%"},{key:"from",label:"发件人",width:"15%"},{key:"to",label:"收件人",width:"15%"},{key:"subject",label:"主题",width:"20%"},{key:"status",label:"状态",width:"10%"},{key:"time",label:"发送时间",width:"15%"},{key:"actions",label:"操作",width:"5%"}],x=(s,n)=>{switch(n.key){case"id":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-neutral-50 font-medium",children:["#",s.id]})});case"from":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-50 font-medium",children:s.from})});case"to":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:s.to})});case"subject":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 text-sm truncate max-w-48",title:s.subject,children:s.subject||"无主题"})});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:s.success?e.jsx(M,{type:"success",text:"发送成功"}):e.jsx(M,{type:"error",text:"发送失败"})});case"time":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 text-sm",children:new Date(s.time).toLocaleString()})});case"actions":return e.jsx("div",{className:"flex gap-2",children:e.jsx(k,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),h==null||h(s)},className:"p-1",title:"查看详情",children:e.jsx(ce,{size:16})})});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(D.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{size:24,className:"text-neutral-50"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"邮件发送历史"}),o&&e.jsxs("p",{className:"text-sm text-neutral-400 mt-1",children:["当前查看: ",o]})]})]}),m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:"每页显示"}),e.jsxs("select",{value:u,onChange:s=>m(parseInt(s.target.value)),className:"px-2 py-1 text-sm bg-neutral-800 border border-neutral-700 rounded text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{className:"text-sm text-neutral-400",children:"条"})]})]}),e.jsx(O,{data:r,columns:l,renderCell:x,onRowClick:b,loading:j,empty:r.length===0,emptyContent:"暂无邮件发送记录"}),c>u&&e.jsx(F,{current:y,total:Math.ceil(c/u),onChange:w,showTotal:!0,totalItems:c})]})})}function Ie(){const[r,c]=i.useState([]),[y,u]=i.useState(0),[j,w]=i.useState(1),[m,h]=i.useState(10),[b,o]=i.useState(!1),[l,x]=i.useState(null),[s,n]=i.useState("edit"),[a,d]=i.useState({address:"",host:"",port:587,pwd:"",on:!1}),[_,q]=i.useState([]),[$,H]=i.useState(0),[S,C]=i.useState(1),[N,R]=i.useState(10),[B,T]=i.useState(!1),[p,G]=i.useState(null),[g,E]=i.useState("smtp");i.useEffect(()=>{g==="smtp"?P():g==="history"&&U()},[j,S,g,m,N]);const P=async()=>{try{const t=await xe({limit:m,offset:(j-1)*m});t.code===200&&(c(t.data.smtps||t.data),u(t.data.count||t.data.length))}catch(t){f.danger({description:"获取SMTP配置列表失败"}),console.error(t)}},U=async()=>{try{let t;l?t=await fe(l.id,{limit:N,offset:(S-1)*N}):t=await je({limit:N,offset:(S-1)*N}),t.code===200&&(q(t.data.emails||t.data),H(t.data.count||t.data.length))}catch(t){f.danger({description:"获取邮件历史记录失败"}),console.error(t)}},J=()=>{n("create"),x(null),d({address:"",host:"",port:587,pwd:"",on:!1}),o(!0)},z=t=>{n("edit"),x(t),d({address:t.address,host:t.host,port:t.port,pwd:"",on:t.on}),o(!0)},K=t=>{n("delete"),x(t),o(!0)},Q=t=>{z(t)},A=t=>{G(t),T(!0)},W=t=>{A(t)},X=t=>{x(t),E("history"),C(1)},Y=t=>{R(t),C(1)},Z=async()=>{try{(await ue(a)).code===200&&(f.success({description:"创建SMTP配置成功"}),o(!1),P())}catch(t){f.danger({description:"创建SMTP配置失败"}),console.error(t)}},V=async()=>{try{const t={};a.address!==l.address&&(t.address=a.address),a.host!==l.host&&(t.host=a.host),a.port!==l.port&&(t.port=a.port),a.pwd&&(t.pwd=a.pwd),a.on!==l.on&&(t.on=a.on),(await he(l.id,t)).code===200&&(f.success({description:"更新SMTP配置成功"}),o(!1),P())}catch(t){f.danger({description:"更新SMTP配置失败"}),console.error(t)}},ee=async()=>{try{(await pe(l.id)).code===200&&(f.success({description:"删除SMTP配置成功"}),o(!1),P())}catch(t){f.danger({description:"删除SMTP配置失败"}),console.error(t)}},te=()=>s==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-neutral-300 mb-4",children:["确定要删除 SMTP 配置 ",e.jsx("span",{className:"font-semibold text-red-400",children:l==null?void 0:l.address})," 吗？"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"此操作不可撤销。"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮箱地址 *"}),e.jsx("input",{type:"email",required:!0,value:a.address,onChange:t=>d({...a,address:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: noreply@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"SMTP服务器 *"}),e.jsx("input",{type:"text",required:!0,value:a.host,onChange:t=>d({...a,host:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: smtp.gmail.com"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"端口 *"}),e.jsx("input",{type:"number",required:!0,value:a.port,onChange:t=>d({...a,port:parseInt(t.target.value)||587}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"587",min:"1",max:"65535"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:s==="create"?"密码 *":"密码 (留空不修改)"}),e.jsx("input",{type:"password",required:s==="create",value:a.pwd,onChange:t=>d({...a,pwd:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:s==="create"?"邮箱密码或应用专用密码":"留空不修改密码"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"on",checked:a.on,onChange:t=>d({...a,on:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"on",className:"text-neutral-300",children:"启用此SMTP配置"})]})]}),se=()=>e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>o(!1),children:"取消"}),e.jsx(I,{variant:s==="delete"?"danger":"primary",onClick:s==="create"?Z:s==="edit"?V:ee,children:s==="create"?"创建":s==="edit"?"保存":"删除"})]}),ae=()=>p?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件ID"}),e.jsxs("div",{className:"text-neutral-50 font-mono",children:["#",p.id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发送状态"}),e.jsx("div",{children:p.success?e.jsx("span",{className:"text-green-400",children:"发送成功"}):e.jsx("span",{className:"text-red-400",children:"发送失败"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发件人"}),e.jsx("div",{className:"text-neutral-50",children:p.from})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"收件人"}),e.jsx("div",{className:"text-neutral-50",children:p.to})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件主题"}),e.jsx("div",{className:"text-neutral-50",children:p.subject||"无主题"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发送时间"}),e.jsx("div",{className:"text-neutral-50",children:new Date(p.time).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件内容"}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3 max-h-60 overflow-y-auto",children:e.jsx("pre",{className:"text-neutral-300 text-sm whitespace-pre-wrap font-mono",children:p.content||"无内容"})})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full max-w-[1200px] mx-auto mb-6",children:e.jsxs("div",{className:"flex border-b border-neutral-700",children:[e.jsx("button",{className:`px-6 py-3 text-sm font-medium transition-colors ${g==="smtp"?"text-blue-400 border-b-2 border-blue-400":"text-neutral-400 hover:text-neutral-300"}`,onClick:()=>E("smtp"),children:"SMTP 配置"}),e.jsx("button",{className:`px-6 py-3 text-sm font-medium transition-colors ${g==="history"?"text-blue-400 border-b-2 border-blue-400":"text-neutral-400 hover:text-neutral-300"}`,onClick:()=>{x(null),E("history"),C(1)},children:"邮件历史"})]})}),g==="smtp"&&e.jsx(be,{smtpConfigs:r,totalCount:y,currentPage:j,pageSize:m,loading:!1,onPageChange:w,onCreateSmtp:J,onEditSmtp:z,onDeleteSmtp:K,onSmtpClick:Q,onViewHistory:X}),g==="history"&&e.jsx(ge,{emailHistory:_,totalCount:$,currentPage:S,pageSize:N,loading:!1,onPageChange:C,onPageSizeChange:Y,onViewEmail:A,onEmailClick:W,smtpAddress:l==null?void 0:l.address}),e.jsx(L,{isOpen:b,onClose:()=>o(!1),title:s==="create"?"创建 SMTP 配置":s==="edit"?"编辑 SMTP 配置":"删除 SMTP 配置",size:s!=="delete"?"lg":"sm",footer:se(),children:te()}),e.jsx(L,{isOpen:B,onClose:()=>T(!1),title:"邮件详情",size:"lg",footer:e.jsx(I,{onClick:()=>T(!1),children:"关闭"}),children:ae()})]})}export{Ie as default};
