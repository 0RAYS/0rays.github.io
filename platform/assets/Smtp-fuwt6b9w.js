import{c as V,r as g,j as e,m as L,B as y,a as o,t as u}from"./index-Db61s3TU.js";import{A as D,L as C}from"./AdminList-CdORAQiw.js";import{A as O}from"./AdminPagination-Ba71d1IJ.js";import{I as ee}from"./IconPlus-_X49BN-T.js";import{I as te}from"./IconEdit-TbRCHGRU.js";import{I as se,a as ae}from"./IconHistory-M5_FcCuI.js";import{I as le}from"./IconTrash-D6GVHslU.js";import{A,M as E}from"./AdminModal-DPfqu6Km.js";import"./IconChevronsRight-dvjrSZ7h.js";import"./IconX-DTt29-Vh.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z",key:"svg-0"}],["path",{d:"M3 7l9 6l9 -6",key:"svg-1"}]],ne=V("outline","mail","Mail",re),ce=(r={limit:10,offset:0})=>g({url:"/admin/smtp",method:"GET",params:r}),ie=r=>g({url:"/admin/smtp",method:"POST",data:r}),oe=(r,d)=>g({url:`/admin/smtp/${r}`,method:"PUT",data:d}),de=r=>g({url:`/admin/smtp/${r}`,method:"DELETE"}),me=(r,d={limit:10,offset:0})=>g({url:`/admin/smtp/${r}/email`,method:"GET",params:d}),xe=(r={limit:10,offset:0})=>g({url:"/admin/email",method:"GET",params:r});function ue({smtpConfigs:r=[],totalCount:d=0,currentPage:N=1,pageSize:h=10,loading:p=!1,onPageChange:v,onCreateSmtp:f,onEditSmtp:c,onDeleteSmtp:l,onSmtpClick:m,onViewHistory:n}){const i=[{key:"id",label:"ID",width:"5%"},{key:"address",label:"邮箱地址",width:"15%"},{key:"host",label:"SMTP服务器",width:"15%"},{key:"port",label:"端口",width:"8%"},{key:"status",label:"状态",width:"10%"},{key:"success",label:"成功次数",width:"10%"},{key:"failure",label:"失败次数",width:"10%"},{key:"actions",label:"操作",width:"5%"}],s=(a,S)=>{switch(S.key){case"id":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-neutral-50 font-medium",children:["#",a.id]})});case"address":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-50 font-medium",children:a.address})});case"host":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:a.host})});case"port":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:a.port})});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:a.on?e.jsx(C,{type:"success",text:"已启用"}):e.jsx(C,{type:"warning",text:"已禁用"})});case"success":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-green-400 font-medium",children:a.success||0}),a.success_last&&e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(a.success_last).toLocaleString()})]});case"failure":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-red-400 font-medium",children:a.failure||0}),a.failure_last&&e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(a.failure_last).toLocaleString()})]});case"actions":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),c==null||c(a)},className:"p-1",children:e.jsx(te,{size:16})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),n==null||n(a)},className:"p-1",title:"查看历史",children:e.jsx(se,{size:16})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),l==null||l(a)},className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(le,{size:16})})]});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(L.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"SMTP 管理"}),e.jsx(y,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(ee,{size:16}),onClick:f,children:"添加 SMTP 配置"})]}),e.jsx(D,{data:r,columns:i,renderCell:s,onRowClick:m,loading:p,empty:r.length===0,emptyContent:"暂无 SMTP 配置"}),d>h&&e.jsx(O,{current:N,total:Math.ceil(d/h),onChange:v,showTotal:!0,totalItems:d})]})})}function he({emailHistory:r=[],totalCount:d=0,currentPage:N=1,pageSize:h=10,loading:p=!1,onPageChange:v,onViewEmail:f,onEmailClick:c,smtpAddress:l}){const m=[{key:"id",label:"ID",width:"5%"},{key:"from",label:"发件人",width:"15%"},{key:"to",label:"收件人",width:"15%"},{key:"subject",label:"主题",width:"20%"},{key:"status",label:"状态",width:"10%"},{key:"time",label:"发送时间",width:"15%"},{key:"actions",label:"操作",width:"5%"}],n=(i,s)=>{switch(s.key){case"id":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-neutral-50 font-medium",children:["#",i.id]})});case"from":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-50 font-medium",children:i.from})});case"to":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:i.to})});case"subject":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 text-sm truncate max-w-48",title:i.subject,children:i.subject||"无主题"})});case"status":return e.jsx("div",{className:"flex flex-wrap gap-2",children:i.success?e.jsx(C,{type:"success",text:"发送成功"}):e.jsx(C,{type:"error",text:"发送失败"})});case"time":return e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-neutral-300 text-sm",children:new Date(i.time).toLocaleString()})});case"actions":return e.jsx("div",{className:"flex gap-2",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),f==null||f(i)},className:"p-1",title:"查看详情",children:e.jsx(ae,{size:16})})});default:return null}};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(L.div,{className:"rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{size:24,className:"text-neutral-50"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"邮件发送历史"}),l&&e.jsxs("p",{className:"text-sm text-neutral-400 mt-1",children:["当前查看: ",l]})]})]})}),e.jsx(D,{data:r,columns:m,renderCell:n,onRowClick:c,loading:p,empty:r.length===0,emptyContent:"暂无邮件发送记录"}),d>h&&e.jsx(O,{current:N,total:Math.ceil(d/h),onChange:v,showTotal:!0,totalItems:d})]})})}function Se(){const[r,d]=o.useState([]),[N,h]=o.useState(0),[p,v]=o.useState(1),[f,c]=o.useState(!1),[l,m]=o.useState(null),[n,i]=o.useState("edit"),[s,a]=o.useState({address:"",host:"",port:587,pwd:"",on:!1}),[S,j]=o.useState([]),[F,_]=o.useState(0),[w,M]=o.useState(1),[q,P]=o.useState(!1),[x,$]=o.useState(null),[b,T]=o.useState("smtp");o.useEffect(()=>{b==="smtp"?k():b==="history"&&H()},[p,w,b]);const k=async()=>{try{const t=await ce({limit:10,offset:(p-1)*10});t.code===200&&(d(t.data.smtps||t.data),h(t.data.count||t.data.length))}catch(t){u.danger({description:"获取SMTP配置列表失败"}),console.error(t)}},H=async()=>{try{let t;l?t=await me(l.id,{limit:20,offset:(w-1)*20}):t=await xe({limit:20,offset:(w-1)*20}),t.code===200&&(j(t.data.emails||t.data),_(t.data.count||t.data.length))}catch(t){u.danger({description:"获取邮件历史记录失败"}),console.error(t)}},R=()=>{i("create"),m(null),a({address:"",host:"",port:587,pwd:"",on:!1}),c(!0)},I=t=>{i("edit"),m(t),a({address:t.address,host:t.host,port:t.port,pwd:"",on:t.on}),c(!0)},B=t=>{i("delete"),m(t),c(!0)},G=t=>{I(t)},z=t=>{$(t),P(!0)},U=t=>{z(t)},J=t=>{m(t),T("history"),M(1)},K=async()=>{try{(await ie(s)).code===200&&(u.success({description:"创建SMTP配置成功"}),c(!1),k())}catch(t){u.danger({description:"创建SMTP配置失败"}),console.error(t)}},Q=async()=>{try{const t={};s.address!==l.address&&(t.address=s.address),s.host!==l.host&&(t.host=s.host),s.port!==l.port&&(t.port=s.port),s.pwd&&(t.pwd=s.pwd),s.on!==l.on&&(t.on=s.on),(await oe(l.id,t)).code===200&&(u.success({description:"更新SMTP配置成功"}),c(!1),k())}catch(t){u.danger({description:"更新SMTP配置失败"}),console.error(t)}},W=async()=>{try{(await de(l.id)).code===200&&(u.success({description:"删除SMTP配置成功"}),c(!1),k())}catch(t){u.danger({description:"删除SMTP配置失败"}),console.error(t)}},X=()=>n==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-neutral-300 mb-4",children:["确定要删除 SMTP 配置 ",e.jsx("span",{className:"font-semibold text-red-400",children:l==null?void 0:l.address})," 吗？"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"此操作不可撤销。"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮箱地址 *"}),e.jsx("input",{type:"email",required:!0,value:s.address,onChange:t=>a({...s,address:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: noreply@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"SMTP服务器 *"}),e.jsx("input",{type:"text",required:!0,value:s.host,onChange:t=>a({...s,host:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例如: smtp.gmail.com"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"端口 *"}),e.jsx("input",{type:"number",required:!0,value:s.port,onChange:t=>a({...s,port:parseInt(t.target.value)||587}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"587",min:"1",max:"65535"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:n==="create"?"密码 *":"密码 (留空不修改)"}),e.jsx("input",{type:"password",required:n==="create",value:s.pwd,onChange:t=>a({...s,pwd:t.target.value}),className:"w-full px-3 py-1.5 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:n==="create"?"邮箱密码或应用专用密码":"留空不修改密码"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"on",checked:s.on,onChange:t=>a({...s,on:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"on",className:"text-neutral-300",children:"启用此SMTP配置"})]})]}),Y=()=>e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:()=>c(!1),children:"取消"}),e.jsx(E,{variant:n==="delete"?"danger":"primary",onClick:n==="create"?K:n==="edit"?Q:W,children:n==="create"?"创建":n==="edit"?"保存":"删除"})]}),Z=()=>x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件ID"}),e.jsxs("div",{className:"text-neutral-50 font-mono",children:["#",x.id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发送状态"}),e.jsx("div",{children:x.success?e.jsx("span",{className:"text-green-400",children:"发送成功"}):e.jsx("span",{className:"text-red-400",children:"发送失败"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发件人"}),e.jsx("div",{className:"text-neutral-50",children:x.from})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"收件人"}),e.jsx("div",{className:"text-neutral-50",children:x.to})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件主题"}),e.jsx("div",{className:"text-neutral-50",children:x.subject||"无主题"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"发送时间"}),e.jsx("div",{className:"text-neutral-50",children:new Date(x.time).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-300 text-sm font-medium mb-2",children:"邮件内容"}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3 max-h-60 overflow-y-auto",children:e.jsx("pre",{className:"text-neutral-300 text-sm whitespace-pre-wrap font-mono",children:x.content||"无内容"})})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full max-w-[1200px] mx-auto mb-6",children:e.jsxs("div",{className:"flex border-b border-neutral-700",children:[e.jsx("button",{className:`px-6 py-3 text-sm font-medium transition-colors ${b==="smtp"?"text-blue-400 border-b-2 border-blue-400":"text-neutral-400 hover:text-neutral-300"}`,onClick:()=>T("smtp"),children:"SMTP 配置"}),e.jsx("button",{className:`px-6 py-3 text-sm font-medium transition-colors ${b==="history"?"text-blue-400 border-b-2 border-blue-400":"text-neutral-400 hover:text-neutral-300"}`,onClick:()=>{m(null),T("history"),M(1)},children:"邮件历史"})]})}),b==="smtp"&&e.jsx(ue,{smtpConfigs:r,totalCount:N,currentPage:p,pageSize:10,loading:!1,onPageChange:v,onCreateSmtp:R,onEditSmtp:I,onDeleteSmtp:B,onSmtpClick:G,onViewHistory:J}),b==="history"&&e.jsx(he,{emailHistory:S,totalCount:F,currentPage:w,pageSize:20,loading:!1,onPageChange:M,onViewEmail:z,onEmailClick:U,smtpAddress:l==null?void 0:l.address}),e.jsx(A,{isOpen:f,onClose:()=>c(!1),title:n==="create"?"创建 SMTP 配置":n==="edit"?"编辑 SMTP 配置":"删除 SMTP 配置",size:n!=="delete"?"lg":"sm",footer:Y(),children:X()}),e.jsx(A,{isOpen:q,onClose:()=>P(!1),title:"邮件详情",size:"lg",footer:e.jsx(E,{onClick:()=>P(!1),children:"关闭"}),children:Z()})]})}export{Se as default};
