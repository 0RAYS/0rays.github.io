import{r as k,j as e,B,a as r,t}from"./index-jDIg2lLK.js";import{A as ae,L as G}from"./AdminList-BMVnft9P.js";import{A as oe}from"./AdminPagination-DTSJVg5u.js";import{I as me}from"./IconPlus-Bl3ddmYu.js";import{I as te}from"./IconSearch-79AMYUUt.js";import{I as se}from"./IconEdit-D6LJwKPR.js";import{I as de}from"./IconTrash-Bv8W_iLs.js";import{A as ce,M as U}from"./AdminModal-A_7p_LOm.js";import{s as re}from"./contest-omffCjh1.js";import"./IconChevronsRight-BGvI8wkk.js";import"./IconX-AH9QJCni.js";const ie=(m={limit:6,offset:0})=>k({url:"/admin/users",method:"GET",params:m}),le=m=>k({url:"/admin/users",method:"POST",data:m}),ue=(m,i)=>k({url:`/admin/users/${m}`,method:"PUT",data:i}),Ee=m=>k({url:`/admin/users/${m}`,method:"DELETE"}),he=(m,i)=>{const E=new FormData;return E.append("avatar",i),k({url:`/admin/users/${m}/avatar`,method:"POST",data:E,headers:{"Content-Type":"multipart/form-data"}})},K=[{code:"AF",name:"阿富汗",nameEn:"Afghanistan"},{code:"AX",name:"奥兰群岛",nameEn:"Åland Islands"},{code:"AL",name:"阿尔巴尼亚",nameEn:"Albania"},{code:"DZ",name:"阿尔及利亚",nameEn:"Algeria"},{code:"AS",name:"美属萨摩亚",nameEn:"American Samoa"},{code:"AD",name:"安道尔",nameEn:"Andorra"},{code:"AO",name:"安哥拉",nameEn:"Angola"},{code:"AI",name:"安圭拉",nameEn:"Anguilla"},{code:"AQ",name:"南极洲",nameEn:"Antarctica"},{code:"AG",name:"安提瓜和巴布达",nameEn:"Antigua and Barbuda"},{code:"AR",name:"阿根廷",nameEn:"Argentina"},{code:"AM",name:"亚美尼亚",nameEn:"Armenia"},{code:"AW",name:"阿鲁巴",nameEn:"Aruba"},{code:"AU",name:"澳大利亚",nameEn:"Australia"},{code:"AT",name:"奥地利",nameEn:"Austria"},{code:"AZ",name:"阿塞拜疆",nameEn:"Azerbaijan"},{code:"BS",name:"巴哈马",nameEn:"Bahamas"},{code:"BH",name:"巴林",nameEn:"Bahrain"},{code:"BD",name:"孟加拉国",nameEn:"Bangladesh"},{code:"BB",name:"巴巴多斯",nameEn:"Barbados"},{code:"BY",name:"白俄罗斯",nameEn:"Belarus"},{code:"BE",name:"比利时",nameEn:"Belgium"},{code:"BZ",name:"伯利兹",nameEn:"Belize"},{code:"BJ",name:"贝宁",nameEn:"Benin"},{code:"BM",name:"百慕大",nameEn:"Bermuda"},{code:"BT",name:"不丹",nameEn:"Bhutan"},{code:"BO",name:"玻利维亚",nameEn:"Bolivia"},{code:"BQ",name:"荷兰加勒比区",nameEn:"Caribbean Netherlands"},{code:"BA",name:"波斯尼亚和黑塞哥维那",nameEn:"Bosnia and Herzegovina"},{code:"BW",name:"博茨瓦纳",nameEn:"Botswana"},{code:"BV",name:"布韦岛",nameEn:"Bouvet Island"},{code:"BR",name:"巴西",nameEn:"Brazil"},{code:"IO",name:"英属印度洋领地",nameEn:"British Indian Ocean Territory"},{code:"BN",name:"文莱",nameEn:"Brunei"},{code:"BG",name:"保加利亚",nameEn:"Bulgaria"},{code:"BF",name:"布基纳法索",nameEn:"Burkina Faso"},{code:"BI",name:"布隆迪",nameEn:"Burundi"},{code:"CV",name:"佛得角",nameEn:"Cape Verde"},{code:"KH",name:"柬埔寨",nameEn:"Cambodia"},{code:"CM",name:"喀麦隆",nameEn:"Cameroon"},{code:"CA",name:"加拿大",nameEn:"Canada"},{code:"KY",name:"开曼群岛",nameEn:"Cayman Islands"},{code:"CF",name:"中非共和国",nameEn:"Central African Republic"},{code:"TD",name:"乍得",nameEn:"Chad"},{code:"CL",name:"智利",nameEn:"Chile"},{code:"CN",name:"中国",nameEn:"China"},{code:"CX",name:"圣诞岛",nameEn:"Christmas Island"},{code:"CC",name:"科科斯（基林）群岛",nameEn:"Cocos (Keeling) Islands"},{code:"CO",name:"哥伦比亚",nameEn:"Colombia"},{code:"KM",name:"科摩罗",nameEn:"Comoros"},{code:"CG",name:"刚果共和国",nameEn:"Republic of the Congo"},{code:"CD",name:"刚果民主共和国",nameEn:"DR Congo"},{code:"CK",name:"库克群岛",nameEn:"Cook Islands"},{code:"CR",name:"哥斯达黎加",nameEn:"Costa Rica"},{code:"CI",name:"科特迪瓦",nameEn:"Côte d'Ivoire"},{code:"HR",name:"克罗地亚",nameEn:"Croatia"},{code:"CU",name:"古巴",nameEn:"Cuba"},{code:"CW",name:"库拉索",nameEn:"Curaçao"},{code:"CY",name:"塞浦路斯",nameEn:"Cyprus"},{code:"CZ",name:"捷克",nameEn:"Czech Republic"},{code:"DK",name:"丹麦",nameEn:"Denmark"},{code:"DJ",name:"吉布提",nameEn:"Djibouti"},{code:"DM",name:"多米尼克",nameEn:"Dominica"},{code:"DO",name:"多米尼加共和国",nameEn:"Dominican Republic"},{code:"EC",name:"厄瓜多尔",nameEn:"Ecuador"},{code:"EG",name:"埃及",nameEn:"Egypt"},{code:"SV",name:"萨尔瓦多",nameEn:"El Salvador"},{code:"GQ",name:"赤道几内亚",nameEn:"Equatorial Guinea"},{code:"ER",name:"厄立特里亚",nameEn:"Eritrea"},{code:"EE",name:"爱沙尼亚",nameEn:"Estonia"},{code:"SZ",name:"斯威士兰",nameEn:"Eswatini"},{code:"ET",name:"埃塞俄比亚",nameEn:"Ethiopia"},{code:"FK",name:"福克兰群岛",nameEn:"Falkland Islands"},{code:"FO",name:"法罗群岛",nameEn:"Faroe Islands"},{code:"FJ",name:"斐济",nameEn:"Fiji"},{code:"FI",name:"芬兰",nameEn:"Finland"},{code:"FR",name:"法国",nameEn:"France"},{code:"GF",name:"法属圭亚那",nameEn:"French Guiana"},{code:"PF",name:"法属波利尼西亚",nameEn:"French Polynesia"},{code:"TF",name:"法属南部和南极领地",nameEn:"French Southern Territories"},{code:"GA",name:"加蓬",nameEn:"Gabon"},{code:"GM",name:"冈比亚",nameEn:"Gambia"},{code:"GE",name:"格鲁吉亚",nameEn:"Georgia"},{code:"DE",name:"德国",nameEn:"Germany"},{code:"GH",name:"加纳",nameEn:"Ghana"},{code:"GI",name:"直布罗陀",nameEn:"Gibraltar"},{code:"GR",name:"希腊",nameEn:"Greece"},{code:"GL",name:"格陵兰",nameEn:"Greenland"},{code:"GD",name:"格林纳达",nameEn:"Grenada"},{code:"GP",name:"瓜德罗普",nameEn:"Guadeloupe"},{code:"GU",name:"关岛",nameEn:"Guam"},{code:"GT",name:"危地马拉",nameEn:"Guatemala"},{code:"GG",name:"根西岛",nameEn:"Guernsey"},{code:"GN",name:"几内亚",nameEn:"Guinea"},{code:"GW",name:"几内亚比绍",nameEn:"Guinea-Bissau"},{code:"GY",name:"圭亚那",nameEn:"Guyana"},{code:"HT",name:"海地",nameEn:"Haiti"},{code:"HM",name:"赫德岛和麦克唐纳群岛",nameEn:"Heard Island and McDonald Islands"},{code:"VA",name:"梵蒂冈",nameEn:"Vatican City"},{code:"HN",name:"洪都拉斯",nameEn:"Honduras"},{code:"HK",name:"中国香港",nameEn:"Hong Kong"},{code:"HU",name:"匈牙利",nameEn:"Hungary"},{code:"IS",name:"冰岛",nameEn:"Iceland"},{code:"IN",name:"印度",nameEn:"India"},{code:"ID",name:"印度尼西亚",nameEn:"Indonesia"},{code:"IR",name:"伊朗",nameEn:"Iran"},{code:"IQ",name:"伊拉克",nameEn:"Iraq"},{code:"IE",name:"爱尔兰",nameEn:"Ireland"},{code:"IM",name:"马恩岛",nameEn:"Isle of Man"},{code:"IL",name:"以色列",nameEn:"Israel"},{code:"IT",name:"意大利",nameEn:"Italy"},{code:"JM",name:"牙买加",nameEn:"Jamaica"},{code:"JP",name:"日本",nameEn:"Japan"},{code:"JE",name:"泽西岛",nameEn:"Jersey"},{code:"JO",name:"约旦",nameEn:"Jordan"},{code:"KZ",name:"哈萨克斯坦",nameEn:"Kazakhstan"},{code:"KE",name:"肯尼亚",nameEn:"Kenya"},{code:"KI",name:"基里巴斯",nameEn:"Kiribati"},{code:"KP",name:"朝鲜",nameEn:"North Korea"},{code:"KR",name:"韩国",nameEn:"South Korea"},{code:"KW",name:"科威特",nameEn:"Kuwait"},{code:"KG",name:"吉尔吉斯斯坦",nameEn:"Kyrgyzstan"},{code:"LA",name:"老挝",nameEn:"Laos"},{code:"LV",name:"拉脱维亚",nameEn:"Latvia"},{code:"LB",name:"黎巴嫩",nameEn:"Lebanon"},{code:"LS",name:"莱索托",nameEn:"Lesotho"},{code:"LR",name:"利比里亚",nameEn:"Liberia"},{code:"LY",name:"利比亚",nameEn:"Libya"},{code:"LI",name:"列支敦士登",nameEn:"Liechtenstein"},{code:"LT",name:"立陶宛",nameEn:"Lithuania"},{code:"LU",name:"卢森堡",nameEn:"Luxembourg"},{code:"MO",name:"中国澳门",nameEn:"Macao"},{code:"MG",name:"马达加斯加",nameEn:"Madagascar"},{code:"MW",name:"马拉维",nameEn:"Malawi"},{code:"MY",name:"马来西亚",nameEn:"Malaysia"},{code:"MV",name:"马尔代夫",nameEn:"Maldives"},{code:"ML",name:"马里",nameEn:"Mali"},{code:"MT",name:"马耳他",nameEn:"Malta"},{code:"MH",name:"马绍尔群岛",nameEn:"Marshall Islands"},{code:"MQ",name:"马提尼克",nameEn:"Martinique"},{code:"MR",name:"毛里塔尼亚",nameEn:"Mauritania"},{code:"MU",name:"毛里求斯",nameEn:"Mauritius"},{code:"YT",name:"马约特",nameEn:"Mayotte"},{code:"MX",name:"墨西哥",nameEn:"Mexico"},{code:"FM",name:"密克罗尼西亚",nameEn:"Micronesia"},{code:"MD",name:"摩尔多瓦",nameEn:"Moldova"},{code:"MC",name:"摩纳哥",nameEn:"Monaco"},{code:"MN",name:"蒙古",nameEn:"Mongolia"},{code:"ME",name:"黑山",nameEn:"Montenegro"},{code:"MS",name:"蒙特塞拉特",nameEn:"Montserrat"},{code:"MA",name:"摩洛哥",nameEn:"Morocco"},{code:"MZ",name:"莫桑比克",nameEn:"Mozambique"},{code:"MM",name:"缅甸",nameEn:"Myanmar"},{code:"NA",name:"纳米比亚",nameEn:"Namibia"},{code:"NR",name:"瑙鲁",nameEn:"Nauru"},{code:"NP",name:"尼泊尔",nameEn:"Nepal"},{code:"NL",name:"荷兰",nameEn:"Netherlands"},{code:"NC",name:"新喀里多尼亚",nameEn:"New Caledonia"},{code:"NZ",name:"新西兰",nameEn:"New Zealand"},{code:"NI",name:"尼加拉瓜",nameEn:"Nicaragua"},{code:"NE",name:"尼日尔",nameEn:"Niger"},{code:"NG",name:"尼日利亚",nameEn:"Nigeria"},{code:"NU",name:"纽埃",nameEn:"Niue"},{code:"NF",name:"诺福克岛",nameEn:"Norfolk Island"},{code:"MK",name:"北马其顿",nameEn:"North Macedonia"},{code:"MP",name:"北马里亚纳群岛",nameEn:"Northern Mariana Islands"},{code:"NO",name:"挪威",nameEn:"Norway"},{code:"OM",name:"阿曼",nameEn:"Oman"},{code:"PK",name:"巴基斯坦",nameEn:"Pakistan"},{code:"PW",name:"帕劳",nameEn:"Palau"},{code:"PS",name:"巴勒斯坦",nameEn:"Palestine"},{code:"PA",name:"巴拿马",nameEn:"Panama"},{code:"PG",name:"巴布亚新几内亚",nameEn:"Papua New Guinea"},{code:"PY",name:"巴拉圭",nameEn:"Paraguay"},{code:"PE",name:"秘鲁",nameEn:"Peru"},{code:"PH",name:"菲律宾",nameEn:"Philippines"},{code:"PN",name:"皮特凯恩群岛",nameEn:"Pitcairn"},{code:"PL",name:"波兰",nameEn:"Poland"},{code:"PT",name:"葡萄牙",nameEn:"Portugal"},{code:"PR",name:"波多黎各",nameEn:"Puerto Rico"},{code:"QA",name:"卡塔尔",nameEn:"Qatar"},{code:"RE",name:"留尼汪",nameEn:"Réunion"},{code:"RO",name:"罗马尼亚",nameEn:"Romania"},{code:"RU",name:"俄罗斯",nameEn:"Russia"},{code:"RW",name:"卢旺达",nameEn:"Rwanda"},{code:"BL",name:"圣巴泰勒米",nameEn:"Saint Barthélemy"},{code:"SH",name:"圣赫勒拿",nameEn:"Saint Helena"},{code:"KN",name:"圣基茨和尼维斯",nameEn:"Saint Kitts and Nevis"},{code:"LC",name:"圣卢西亚",nameEn:"Saint Lucia"},{code:"MF",name:"法属圣马丁",nameEn:"Saint Martin"},{code:"PM",name:"圣皮埃尔和密克隆",nameEn:"Saint Pierre and Miquelon"},{code:"VC",name:"圣文森特和格林纳丁斯",nameEn:"Saint Vincent and the Grenadines"},{code:"WS",name:"萨摩亚",nameEn:"Samoa"},{code:"SM",name:"圣马力诺",nameEn:"San Marino"},{code:"ST",name:"圣多美和普林西比",nameEn:"Sao Tome and Principe"},{code:"SA",name:"沙特阿拉伯",nameEn:"Saudi Arabia"},{code:"SN",name:"塞内加尔",nameEn:"Senegal"},{code:"RS",name:"塞尔维亚",nameEn:"Serbia"},{code:"SC",name:"塞舌尔",nameEn:"Seychelles"},{code:"SL",name:"塞拉利昂",nameEn:"Sierra Leone"},{code:"SG",name:"新加坡",nameEn:"Singapore"},{code:"SX",name:"荷属圣马丁",nameEn:"Sint Maarten"},{code:"SK",name:"斯洛伐克",nameEn:"Slovakia"},{code:"SI",name:"斯洛文尼亚",nameEn:"Slovenia"},{code:"SB",name:"所罗门群岛",nameEn:"Solomon Islands"},{code:"SO",name:"索马里",nameEn:"Somalia"},{code:"ZA",name:"南非",nameEn:"South Africa"},{code:"GS",name:"南乔治亚和南桑威奇群岛",nameEn:"South Georgia and the South Sandwich Islands"},{code:"SS",name:"南苏丹",nameEn:"South Sudan"},{code:"ES",name:"西班牙",nameEn:"Spain"},{code:"LK",name:"斯里兰卡",nameEn:"Sri Lanka"},{code:"SD",name:"苏丹",nameEn:"Sudan"},{code:"SR",name:"苏里南",nameEn:"Suriname"},{code:"SJ",name:"斯瓦尔巴和扬马延",nameEn:"Svalbard and Jan Mayen"},{code:"SE",name:"瑞典",nameEn:"Sweden"},{code:"CH",name:"瑞士",nameEn:"Switzerland"},{code:"SY",name:"叙利亚",nameEn:"Syria"},{code:"TW",name:"中国台湾",nameEn:"Taiwan"},{code:"TJ",name:"塔吉克斯坦",nameEn:"Tajikistan"},{code:"TZ",name:"坦桑尼亚",nameEn:"Tanzania"},{code:"TH",name:"泰国",nameEn:"Thailand"},{code:"TL",name:"东帝汶",nameEn:"Timor-Leste"},{code:"TG",name:"多哥",nameEn:"Togo"},{code:"TK",name:"托克劳",nameEn:"Tokelau"},{code:"TO",name:"汤加",nameEn:"Tonga"},{code:"TT",name:"特立尼达和多巴哥",nameEn:"Trinidad and Tobago"},{code:"TN",name:"突尼斯",nameEn:"Tunisia"},{code:"TR",name:"土耳其",nameEn:"Turkey"},{code:"TM",name:"土库曼斯坦",nameEn:"Turkmenistan"},{code:"TC",name:"特克斯和凯科斯群岛",nameEn:"Turks and Caicos Islands"},{code:"TV",name:"图瓦卢",nameEn:"Tuvalu"},{code:"UG",name:"乌干达",nameEn:"Uganda"},{code:"UA",name:"乌克兰",nameEn:"Ukraine"},{code:"AE",name:"阿拉伯联合酋长国",nameEn:"United Arab Emirates"},{code:"GB",name:"英国",nameEn:"United Kingdom"},{code:"US",name:"美国",nameEn:"United States"},{code:"UM",name:"美国本土外小岛屿",nameEn:"United States Minor Outlying Islands"},{code:"UY",name:"乌拉圭",nameEn:"Uruguay"},{code:"UZ",name:"乌兹别克斯坦",nameEn:"Uzbekistan"},{code:"VU",name:"瓦努阿图",nameEn:"Vanuatu"},{code:"VE",name:"委内瑞拉",nameEn:"Venezuela"},{code:"VN",name:"越南",nameEn:"Vietnam"},{code:"VG",name:"英属维尔京群岛",nameEn:"British Virgin Islands"},{code:"VI",name:"美属维尔京群岛",nameEn:"U.S. Virgin Islands"},{code:"WF",name:"瓦利斯和富图纳",nameEn:"Wallis and Futuna"},{code:"EH",name:"西撒哈拉",nameEn:"Western Sahara"},{code:"YE",name:"也门",nameEn:"Yemen"},{code:"ZM",name:"赞比亚",nameEn:"Zambia"},{code:"ZW",name:"津巴布韦",nameEn:"Zimbabwe"}],R=m=>{const i=K.find(E=>E.code===m.toUpperCase());return i||{code:"",name:"",nameEn:""}};function pe({users:m=[],totalCount:i=0,currentPage:E=1,pageSize:y=6,loading:N=!1,onPageChange:I,onCreateUser:C,onEditUser:S,onDeleteUser:l,onUserClick:h,onAvatarUpload:x,searchQuery:c="",searchLoading:g=!1,isSearchMode:a=!1,onSearchChange:s}){const w=[{key:"avatar",label:"头像",width:"10%"},{key:"name",label:"用户名",width:"15%"},{key:"email",label:"邮箱",width:"20%"},{key:"status",label:"状态",width:"15%"},{key:"country",label:"国家/地区",width:"15%"},{key:"contests",label:"参赛次数",width:"10%"},{key:"teams",label:"组队次数",width:"10%"},{key:"actions",label:"操作",width:"5%"}],T=(o,p)=>{switch(p.key){case"avatar":return e.jsxs("div",{className:"relative w-10 h-10 rounded-full overflow-hidden cursor-pointer group",onClick:f=>{f.stopPropagation(),x==null||x(o)},children:[e.jsx("img",{src:o.avatar,alt:o.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-neutral-300 text-xs",children:"更换"})})]});case"name":return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-neutral-50",children:o.name}),e.jsxs("span",{className:"text-xs text-neutral-400",children:["ID: ",o.id]})]});case"status":return e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.verified&&e.jsx(G,{type:"success",text:"已验证"}),o.banned&&e.jsx(G,{type:"error",text:"已封禁"}),o.hidden&&e.jsx(G,{type:"warning",text:"已隐藏"})]});case"country":return o.country?e.jsx("span",{className:"text-neutral-300",children:o.country}):e.jsx("span",{className:"text-neutral-400",children:"未设置"});case"actions":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{variant:"ghost",size:"icon",className:"!bg-yellow-400/20 !text-yellow-400 hover:!bg-yellow-400/30",onClick:f=>{f.stopPropagation(),S==null||S(o)},children:e.jsx(se,{size:18})}),e.jsx(B,{variant:"ghost",size:"icon",className:"!bg-red-400/20 !text-red-400 hover:!bg-red-400/30",onClick:f=>{f.stopPropagation(),l==null||l(o)},children:e.jsx(de,{size:18})})]});default:return o[p.key]}},A=i>y&&!a&&e.jsx(oe,{total:Math.ceil(i/y),current:E,pageSize:y,onChange:I,totalItems:i});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h2",{className:"text-3xl font-mono text-neutral-50",children:"用户管理"}),e.jsx(B,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(me,{size:16}),onClick:C,children:"创建用户"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"搜索用户"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:c,placeholder:"输入用户名搜索...",onChange:o=>s==null?void 0:s(o.target.value),className:`w-full h-10 pl-10 pr-10 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`}),g&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border border-geek-400 border-t-transparent rounded-full animate-spin"})})]})]})})}),e.jsx(ae,{columns:w,data:m,renderCell:T,onRowClick:h,loading:N,empty:m.length===0,emptyContent:a?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-neutral-300/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("span",{className:"font-mono",children:"未找到匹配的用户"})]}):void 0,footer:A,searchQuery:c,searchLoading:g,onSearchChange:s})]})}function ke(){const[m,i]=r.useState([]),[E,y]=r.useState(0),[N,I]=r.useState(1),C=6,[S,l]=r.useState(!1),[h,x]=r.useState(null),[c,g]=r.useState("edit"),[a,s]=r.useState({name:"",email:"",desc:"",country:"",hidden:!1,verified:!1,banned:!1,password:""}),w=r.useRef(null),[T,A]=r.useState(""),[o,p]=r.useState([]),[f,F]=r.useState(!1),[j,M]=r.useState(!1);r.useEffect(()=>{j||v()},[N,j]);const v=async()=>{try{const n=await ie({limit:C,offset:(N-1)*C});if(n.code===200){const d=n.data.users.map(b=>{var u;return{...b,countryName:((u=R(b.country))==null?void 0:u.name)||"未设置"}});i(d),y(n.data.count)}else t.danger({description:n.msg||"Failed to fetch user list"})}catch(n){t.danger({description:"Failed to fetch user list"}),console.error(n)}},D=async n=>{if(!n||n.trim()===""){p([]),M(!1);return}F(!0);try{const d=await re({model:"user",name:n.trim(),limit:10,offset:0});if(d.code===200){const u=(d.data.results||[]).map(P=>{var L;return{...P,countryName:((L=R(P.country))==null?void 0:L.name)||"未设置"}});p(u),M(!0)}else t.danger({description:d.msg||"搜索失败"}),p([]),M(!1)}catch(d){console.error("搜索失败:",d),t.danger({description:"搜索失败"}),p([]),M(!1)}finally{F(!1)}},H=(()=>{let n;return d=>{clearTimeout(n),n=setTimeout(()=>{D(d)},300)}})(),V=n=>{A(n),!n||n.trim()===""?(M(!1),p([])):H(n)},O=()=>{s({name:"",email:"",desc:"",country:"",hidden:!1,verified:!0,banned:!1,password:""}),g("create"),l(!0)},z=n=>{x(n),s({name:n.name,email:n.email,desc:n.desc||"",country:n.country||"",hidden:n.hidden,verified:n.verified,banned:n.banned}),g("edit"),l(!0)},Z=n=>{x(n),g("delete"),l(!0)},W=n=>{console.log("User clicked:",n)},J=async()=>{try{const n=await le(a);n.code===200?(t.success({description:"User created successfully"}),l(!1),v()):t.danger({description:n.msg||"Failed to create user"})}catch(n){console.error("Failed to create user:",n),t.danger({description:"Failed to create user"})}},Y=async()=>{try{const n=await ue(h.id,a);n.code===200?(t.success({description:"User updated successfully"}),l(!1),v()):t.danger({description:n.msg||"Failed to update user"})}catch(n){console.error("Failed to update user:",n),t.danger({description:"Failed to update user"})}},Q=async()=>{try{const n=await Ee(h.id);n.code===200?(t.success({description:"User deleted successfully"}),l(!1),v()):t.danger({description:n.msg||"Failed to delete user"})}catch(n){console.error("Failed to delete user:",n),t.danger({description:"Failed to delete user"})}},q=n=>{var d;x(n),(d=w.current)==null||d.click()},X=async n=>{var b;const d=(b=n.target.files)==null?void 0:b[0];if(n.target.value="",!!d)try{const u=await he(h.id,d);u.code===200?(t.success({description:"Avatar updated successfully"}),v()):t.danger({description:u.msg||"Failed to update avatar"})}catch(u){console.error("Failed to update avatar:",u),t.danger({description:"Failed to update avatar"})}},_=()=>c==="delete"?e.jsxs("p",{className:"text-neutral-300",children:["Are you sure you want to delete user ",e.jsx("span",{className:"text-white font-semibold",children:h==null?void 0:h.name}),"? This action cannot be undone."]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-400 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:a.name,onChange:n=>s({...a,name:n.target.value}),className:"w-full px-3 py-2 bg-black/50 border border-neutral-700 rounded-md text-white focus:outline-none focus:border-geek-400",placeholder:"Enter username"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-400 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:n=>s({...a,email:n.target.value}),className:"w-full px-3 py-2 bg-black/50 border border-neutral-700 rounded-md text-white focus:outline-none focus:border-geek-400",placeholder:"Enter email"})]}),c==="create"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-400 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:n=>s({...a,password:n.target.value}),className:"w-full px-3 py-2 bg-black/50 border border-neutral-700 rounded-md text-white focus:outline-none focus:border-geek-400",placeholder:"Enter password"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-400 mb-1",children:"Description"}),e.jsx("textarea",{value:a.desc,onChange:n=>s({...a,desc:n.target.value}),className:"w-full px-3 py-2 bg-black/50 border border-neutral-700 rounded-md text-white focus:outline-none focus:border-geek-400 min-h-[80px]",placeholder:"Enter user description"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-400 mb-1",children:"Country"}),e.jsxs("select",{value:a.country,onChange:n=>s({...a,country:n.target.value}),className:"select-custom select-custom-md",children:[e.jsx("option",{value:"",children:"Select country"}),K.map(n=>e.jsxs("option",{value:n.code,children:[n.name," (",n.code,")"]},n.code))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"verified",checked:a.verified,onChange:n=>s({...a,verified:n.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"verified",className:"text-neutral-300",children:"Verified"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"banned",checked:a.banned,onChange:n=>s({...a,banned:n.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"banned",className:"text-neutral-300",children:"Banned"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"hidden",checked:a.hidden,onChange:n=>s({...a,hidden:n.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"hidden",className:"text-neutral-300",children:"Hidden"})]})]})]}),$=()=>e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>l(!1),children:"CANCEL"}),e.jsx(U,{variant:c==="delete"?"danger":"primary",onClick:c==="create"?J:c==="edit"?Y:Q,children:c==="create"?"CREATE":c==="edit"?"SAVE":"DELETE"})]}),ee=j?o:m,ne=j?o.length:E;return e.jsxs(e.Fragment,{children:[e.jsx(pe,{users:ee,totalCount:ne,currentPage:N,pageSize:C,loading:!1,onPageChange:I,onCreateUser:O,onEditUser:z,onDeleteUser:Z,onUserClick:W,onAvatarUpload:q,searchQuery:T,searchLoading:f,isSearchMode:j,onSearchChange:V}),e.jsx(ce,{isOpen:S,onClose:()=>l(!1),title:c==="create"?"Create User":c==="edit"?"Edit User":"Delete User",size:c!=="delete"?"lg":"sm",footer:$(),children:_()}),e.jsx("input",{type:"file",ref:w,className:"hidden",accept:"image/*",onChange:X})]})}export{ke as default};
