import{c as K,j as e,B as x,m as S,a as o,h as Se,t as p}from"./index-D2Yzijmo.js";import{A as V}from"./AdminPagination-Df6DGPbV.js";import{I as D}from"./IconPlus-sBoH389S.js";import{I as Fe}from"./IconEdit-CoV0FDlD.js";import{I as Q}from"./IconTrash-B2jorrnw.js";import{I as Y}from"./IconX-Pvzn4-wk.js";import{I as ze}from"./IconSearch-CBKqVjqD.js";import{I as Me}from"./IconDeviceFloppy-D_7k9bNB.js";import{e as Te,r as $e,f as Ae,h as Pe,s as Ee}from"./contest-DVKf_9w8.js";import{b as _e,j as He,k as Re,c as Le}from"./challenge-XBnumWB9.js";import"./IconChevronsRight-DNm20Ug4.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7",key:"svg-0"}],["path",{d:"M9 16a5 5 0 1 1 6 0a3.5 3.5 0 0 0 -1 3a2 2 0 0 1 -4 0a3.5 3.5 0 0 0 -1 -3",key:"svg-1"}],["path",{d:"M9.7 17l4.6 0",key:"svg-2"}]],Oe=K("outline","bulb","Bulb",Be);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M7.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M3 6v5.172a2 2 0 0 0 .586 1.414l7.71 7.71a2.41 2.41 0 0 0 3.408 0l5.592 -5.592a2.41 2.41 0 0 0 0 -3.408l-7.71 -7.71a2 2 0 0 0 -1.414 -.586h-5.172a3 3 0 0 0 -3 3z",key:"svg-1"}]],We=K("outline","tag","Tag",qe);function De({challenges:h=[],totalCount:v=0,currentPage:m=1,pageSize:N=10,categories:C=[],filterCategory:b="all",filterType:c="all",onPageChange:w,onAddChallenge:I,onEditChallenge:k,onDeleteChallenge:M,onFilterTypeChange:g,onFilterCategoryChange:T}){const $=t=>{const r={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[t.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${r}`,children:t})},y=t=>{const r={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-green-400/20 text-green-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[t]||{label:t,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${r.class}`,children:r.label})},F=t=>!t||t.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((l,r)=>e.jsx("span",{className:"px-2 py-0.5 bg-black/30 border border-geek-600/30 rounded-full text-xs font-mono text-geek-300",children:l},r))}),j=t=>!t||t.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((l,r)=>e.jsxs("span",{className:"px-2 py-0.5 bg-black/30 border border-yellow-400/30 rounded text-xs font-mono text-yellow-300",title:l,children:["提示 ",r+1]},r))});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"赛题管理"}),e.jsx(x,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(D,{size:18}),onClick:I,children:"添加赛题"})]}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsxs(x,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="all"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("all"),children:["全部",c==="all"&&e.jsx(S.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(x,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="static"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("static"),children:["静态题目",c==="static"&&e.jsx(S.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(x,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="question"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("question"),children:["问答题目",c==="question"&&e.jsx(S.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(x,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="dynamic"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("dynamic"),children:["动态题目",c==="dynamic"&&e.jsx(S.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(x,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="pods"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("pods"),children:["容器题目",c==="pods"&&e.jsx(S.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]})]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:b,onChange:t=>T(t.target.value),className:"select-custom select-custom-sm",children:[e.jsx("option",{value:"all",children:"全部分类"}),C.map(t=>e.jsx("option",{value:t,children:t},t))]})})]})}),h.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:h.map(t=>e.jsx(S.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[$(t.category),y(t.type),t.hidden&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-mono bg-red-400/20 text-red-400",children:"隐藏"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>k(t),children:e.jsx(Fe,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>M(t),children:e.jsx(Q,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:t.desc}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"尝试次数:"}),e.jsx("span",{className:"text-white font-mono",children:t.attempt||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{size:14,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400 font-mono",children:"标签:"}),F(t.tags)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{size:14,className:"text-yellow-400"}),e.jsx("span",{className:"text-neutral-400 font-mono",children:"提示:"}),j(t.hints)]})]})]})},t.id||t.name))}),v>0&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx(V,{total:Math.ceil(v/N),current:m,onChange:w,showTotal:!0,totalItems:v})})]})}function Qe({isOpen:h=!1,challenges:v=[],selectedChallenges:m=[],categories:N=[],totalCount:C=0,currentPage:b=1,pageSize:c=10,onClose:w,onSearch:I,onSelect:k,onConfirm:M,onPageChange:g,onFilterCategoryChange:T,onFilterTypeChange:$}){const y="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",F=t=>{const r={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[t.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${r}`,children:t})},j=t=>{const r={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-green-400/20 text-green-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[t]||{label:t,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${r.class}`,children:r.label})};return h?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(S.div,{className:"w-full max-w-5xl h-[80vh] bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden flex flex-col",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:"选择赛题"}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:w,children:e.jsx(Y,{size:18})})]}),e.jsx("div",{className:"p-4 border-b border-neutral-700",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ze,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",className:`${y} pl-10`,placeholder:"搜索赛题...",onChange:t=>I(t.target.value)})]}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{onChange:t=>T(t.target.value),className:"select-custom select-custom-lg",children:[e.jsx("option",{value:"all",children:"全部分类"}),N.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{onChange:t=>$(t.target.value),className:"select-custom select-custom-lg",children:[e.jsx("option",{value:"all",children:"全部类型"}),e.jsx("option",{value:"question",children:"问答题目"}),e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[v.length===0?e.jsx("div",{className:"flex justify-center items-center h-full border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无匹配赛题"})}):e.jsx("div",{className:"space-y-3",children:v.map(t=>{const l=m.some(r=>r.id===t.id);return e.jsx(S.div,{className:`border rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden transition-colors duration-200 ${l?"border-geek-400":"border-neutral-300/30"}`,whileHover:{y:-1,boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:"p-3 flex items-start gap-3",children:[e.jsx("div",{className:`w-5 h-5 border-2 cursor-pointer transition-all duration-200 flex items-center justify-center flex-shrink-0 mt-1 ${l?"bg-geek-400 border-geek-400 text-white":"border-neutral-400 text-transparent hover:border-geek-400 hover:bg-geek-400/10"}`,onClick:()=>k(t),children:l&&e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20,6 9,17 4,12"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[F(t.category),j(t.type)]})]}),e.jsx("p",{className:"text-neutral-300 text-sm font-mono line-clamp-2",children:t.desc})]})]})},t.id||t.name)})}),C>c&&e.jsx("div",{className:"mt-6",children:e.jsx(V,{total:Math.ceil(C/c),current:b,pageSize:c,onChange:g,showTotal:!0,totalItems:C})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-neutral-700",children:[e.jsxs("div",{className:"text-neutral-300 font-mono",children:["已选择 ",e.jsx("span",{className:"text-geek-400 font-bold",children:m.length})," 个赛题"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(x,{variant:"ghost",onClick:w,children:"取消"}),e.jsx(x,{variant:"primary",onClick:M,disabled:m.length===0,children:"确认添加"})]})]})]})}):null}function Ue({isOpen:h=!1,mode:v="add",challenge:m={name:"",desc:"",attempt:0,hidden:!1,hints:[],tags:[]},flags:N=[{blood:[0,0,0],current_score:1e3,decay:100,id:1,last:"0001-01-01T00:00:00Z",min_score:100,score:1e3,score_type:0,solvers:0,value:""}],onClose:C,onSubmit:b,onChange:c,onAddHint:w,onRemoveHint:I,onHintChange:k,onAddTag:M,onRemoveTag:g,onTagChange:T,onFlagChange:$}){const[y,F]=o.useState([...N]),j=(n,i)=>{const d=[...y];d[n]=i,F(d)};o.useEffect(()=>{F(N)},[N]);const t=n=>{$(n,y[n])},l="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",r=`${l} min-h-[100px] resize-none`,E=`${l} opacity-70 cursor-not-allowed`;return h?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(S.div,{className:"w-full max-w-2xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:v==="add"?"添加赛题":"编辑赛题"}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:C,children:e.jsx(Y,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:m.name,onChange:n=>c({...m,name:n.target.value}),className:l,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:m.desc,onChange:n=>c({...m,desc:n.target.value}),className:r,placeholder:"输入题目描述内容"})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"尝试次数"}),e.jsx("input",{type:"number",value:m.attempt,onChange:n=>c({...m,attempt:parseInt(n.target.value)||0}),className:l,placeholder:"0"})]}),e.jsxs("div",{className:"w-1/3 flex items-center pt-6",children:[e.jsx("input",{type:"checkbox",id:"hidden-checkbox",checked:m.hidden,onChange:n=>c({...m,hidden:n.target.checked}),className:"mr-2 h-4 w-4 accent-geek-400"}),e.jsx("label",{htmlFor:"hidden-checkbox",className:"text-sm font-mono text-neutral-400",children:"隐藏题目"})]})]})]})]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag设置 (不可重复)"})}),y.map((n,i)=>e.jsxs("div",{className:"mb-6 p-4 border border-neutral-700 rounded-md bg-black/20",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("h4",{className:"text-md font-mono text-geek-400",children:["Flag #",i+1]}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300 !bg-geek-500/10 hover:!bg-geek-500/20",onClick:()=>t(i),title:"更新Flag",children:e.jsx(Me,{size:18})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Flag值: static{} uuid{} dynamic{}"}),e.jsx("input",{type:"text",value:n.value,onChange:d=>j(i,{...n,value:d.target.value}),className:l,placeholder:"输入Flag值"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"分数曲线"}),e.jsxs("select",{value:n.score_type,onChange:d=>j(i,{...n,score_type:parseInt(d.target.value)}),className:l,children:[e.jsx("option",{value:0,children:"静态分值"}),e.jsx("option",{value:1,children:"线性衰减"}),e.jsx("option",{value:2,children:"Log衰减"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"初始分值"}),e.jsx("input",{type:"number",value:n.score,onChange:d=>j(i,{...n,score:parseFloat(d.target.value)||0}),className:l,placeholder:"1000",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"当前分值"}),e.jsx("input",{type:"number",value:n.current_score,className:E,placeholder:"1000",disabled:!0})]}),n.score_type!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"衰减值"}),e.jsx("input",{type:"number",value:n.decay,onChange:d=>j(i,{...n,decay:parseFloat(d.target.value)||0}),className:l,placeholder:"100",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"最低分值"}),e.jsx("input",{type:"number",value:n.min_score,onChange:d=>j(i,{...n,min_score:parseFloat(d.target.value)||0}),className:l,placeholder:"100",step:"0.1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"解出人数"}),e.jsx("input",{type:"number",value:n.solvers,className:E,placeholder:"0",disabled:!0})]})]})]},i))]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"标签设置"}),e.jsx(x,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(D,{size:16}),onClick:M,children:"添加标签"})]}),e.jsx("div",{className:"space-y-2",children:m.tags.map((n,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:d=>T(i,d.target.value),className:l,placeholder:`标签 ${i+1}`}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>g(i),children:e.jsx(Q,{size:18})})]},i))})]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"提示设置"}),e.jsx(x,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(D,{size:16}),onClick:w,children:"添加提示"})]}),e.jsx("div",{className:"space-y-2",children:m.hints.map((n,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:d=>k(i,d.target.value),className:l,placeholder:`提示 ${i+1}`}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>I(i),children:e.jsx(Q,{size:18})})]},i))})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(x,{variant:"ghost",onClick:C,children:"取消"}),e.jsx(x,{variant:"primary",onClick:()=>b(m,N),children:v==="add"?"添加赛题":"保存更改"})]})]})}):null}function nt(){const{id:h}=Se(),[v,m]=o.useState([]),[N,C]=o.useState(0),[b,c]=o.useState(1),[w,I]=o.useState([]),[k,M]=o.useState("all"),[g,T]=o.useState("all"),[$,y]=o.useState(!1),[F,j]=o.useState([]),[t,l]=o.useState(""),[r,E]=o.useState([]),[n,i]=o.useState("all"),[d,U]=o.useState("all"),[X,H]=o.useState(1),[ee,Z]=o.useState(0),[te,G]=o.useState(!1),B=5,[se,O]=o.useState(!1),[q,ae]=o.useState(null),[J,ne]=o.useState([{name:"",desc:"",attempt:0,hidden:!1,hints:[""],tags:[""]}]),[f,z]=o.useState({name:"",desc:"",attempt:0,hidden:!1,hints:[],tags:[]}),W=10;o.useEffect(()=>{le()},[]),o.useEffect(()=>{h&&_(1)},[h]),o.useEffect(()=>{h&&re()},[k,g]),o.useEffect(()=>{h&&b>0&&_(b)},[b,h]);const le=async()=>{try{const s=["Web","Misc","Pwn","Crypto","Reverse"],a=await _e();if(a.code===200){const u=[...new Set([...s,...a.data||[]])];I(u)}else I(s)}catch(s){console.error("获取题目分类失败:",s),p.danger({description:"获取题目分类失败"}),I(["Web","Misc","Pwn","Crypto","Reverse"])}},re=()=>{c(1),_(1)},_=async s=>{try{const a={limit:W,offset:(s-1)*W};k!=="all"&&(a.type=k),g!=="all"&&(a.category=g);const u=await Te(parseInt(h),a);if(u.code===200){const L=u.data===null?[]:u.data;m(L.challenges||[]),C(L.count||0)}else p.danger({description:u.msg||"获取题目列表失败"})}catch(a){p.danger({description:"获取题目列表失败"}),console.error(a)}},R=async(s=X,a=n,u=d,L="")=>{G(!0);try{const A={limit:B,offset:(s-1)*B};if(a!=="all"&&(A.type=a),u!=="all"&&(A.category=u),L.trim()!==""){const P=await Ee({model:"challenge",limit:6,offset:0,name:L,type:A.type,category:A.category});P.code===200&&(j(P.data.results||[]),Z(P.data.count||0))}else{const P=await Le(A);P.code===200&&(j(P.data.challenges||[]),Z(P.data.count||0))}}catch(A){console.error("获取题库列表失败:",A),p.danger({description:"获取题库列表失败"})}finally{G(!1)}},oe=s=>{M(s)},ie=s=>{T(s)},ce=s=>{i(s),H(1),R(1,s,d,t)},de=s=>{U(s),H(1),R(1,n,s,t)},me=s=>{l(s),H(1),R(1,n,d,s)},xe=async s=>{H(s),R(s,n,d,t)},he=async()=>{E([]),i("all"),U("all"),H(1),await R(1,"all","all",""),y(!0)},ue=s=>{r.some(a=>a.id===s.id)?E(r.filter(a=>a.id!==s.id)):E([...r,s])},pe=async()=>{if(r.length===0){p.warning({description:"请选择要添加的题目"});return}try{const s=await Ae(parseInt(h),r.map(a=>a.id));s.code===200?(p.success({description:"添加题目成功"}),y(!1),await _(b)):p.danger({description:s.msg||"添加题目失败"})}catch(s){console.error("添加题目失败:",s),p.danger({description:"添加题目失败"})}},ge=async s=>{ae(s),z({name:s.name||"",desc:s.desc||"",attempt:s.attempt||0,hidden:s.hidden||!1,hints:s.hints||[],tags:s.tags||[]});const a=await He(parseInt(h),s.id);a.code===200?ne(a.data):p.danger({description:a.msg||"获取题目flag失败"}),O(!0)},be=s=>{z(s)},fe=()=>{z({...f,hints:[...f.hints,""]})},je=s=>{const a=[...f.hints];a.splice(s,1),z({...f,hints:a})},ve=(s,a)=>{const u=[...f.hints];u[s]=a,z({...f,hints:u})},ye=()=>{z({...f,tags:[...f.tags,""]})},Ne=s=>{const a=[...f.tags];a.splice(s,1),z({...f,tags:a})},Ce=(s,a)=>{const u=[...f.tags];u[s]=a,z({...f,tags:u})},ke=async s=>{if(q)try{const a=await Pe(parseInt(h),q.id,s);a.code===200?(p.success({description:"更新题目成功"}),O(!1),await _(b)):p.danger({description:a.msg||"更新题目失败"})}catch(a){console.error("更新题目失败:",a),p.danger({description:"更新题目失败"})}},we=async s=>{try{const a=await $e(parseInt(h),s.id);a.code===200?(p.success({description:"移出题目成功"}),await _(b)):p.danger({description:a.msg||"移出题目失败"})}catch(a){console.error("移出题目失败:",a),p.danger({description:"移出题目失败"})}},Ie=async(s,a)=>{console.log("flag",a);const u=await Re(parseInt(h),q.id,J[s].id,a);u.code===200?p.success({description:"更新题目flag成功"}):p.danger({description:u.msg||"更新题目flag失败"})};return e.jsxs(e.Fragment,{children:[e.jsx(De,{challenges:v,totalCount:N,currentPage:b,pageSize:W,categories:w,filterCategory:g,filterType:k,onPageChange:c,onAddChallenge:he,onEditChallenge:ge,onDeleteChallenge:we,onFilterTypeChange:oe,onFilterCategoryChange:ie}),e.jsx(Qe,{isOpen:$,challenges:F,selectedChallenges:r,categories:w,totalCount:ee,currentPage:X,pageSize:B,loading:te,onClose:()=>y(!1),onSearch:me,onSelect:ue,onConfirm:pe,onPageChange:xe,onFilterCategoryChange:de,onFilterTypeChange:ce}),e.jsx(Ue,{isOpen:se,mode:"edit",challenge:f,flags:J,onClose:()=>O(!1),onSubmit:ke,onChange:be,onAddHint:fe,onRemoveHint:je,onHintChange:ve,onAddTag:ye,onRemoveTag:Ne,onTagChange:Ce,onFlagChange:Ie})]})}export{nt as default};
