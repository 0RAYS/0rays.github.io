import{h as K,a as l,j as e,m as S,B as d,t as R}from"./index-jDIg2lLK.js";import{J as V,K as W}from"./contest-omffCjh1.js";import{A as $,L as m}from"./AdminList-BMVnft9P.js";import{A as q}from"./AdminPagination-DTSJVg5u.js";import{A as D,M as g}from"./AdminModal-A_7p_LOm.js";import{I as G}from"./IconFilter-D-TUECNQ.js";import{I as Q}from"./IconEye-HIm1GCYd.js";import{I as U}from"./IconEdit-D6LJwKPR.js";import"./IconChevronsRight-BGvI8wkk.js";import"./IconX-AH9QJCni.js";function ce(){const{id:x}=K(),[i,M]=l.useState([]),[h,z]=l.useState(0),[u,k]=l.useState(1),[p]=l.useState(10),[r,E]=l.useState(""),[b,F]=l.useState(!1),[s,N]=l.useState(null),[P,c]=l.useState(!1),[_,j]=l.useState(!1),[a,o]=l.useState({reason:"",type:"",checked:!1,comment:""});l.useEffect(()=>{y()},[x,u,r]);const y=async()=>{try{const t={limit:p,offset:(u-1)*p};r&&(t.type=r);const n=await V(parseInt(x),t);n.code===200&&(M(n.data.cheats||[]),z(n.data.count||0))}catch(t){console.error("获取作弊事件失败:",t)}},T=t=>{k(t)},A=t=>{E(t),k(1)},L=t=>{N(t),o({reason:t.reason||"",type:t.type||"",checked:t.checked||!1,comment:t.comment||""}),c(!0)},B=t=>{N(t),j(!0)},O=async()=>{try{const t={};if(a.reason!==s.reason&&(t.reason=a.reason),a.type!==s.type&&(t.type=a.type),a.checked!==s.checked&&(t.checked=a.checked),a.comment!==s.comment&&(t.comment=a.comment),Object.keys(t).length===0){c(!1);return}(await W(parseInt(x),s.id,t)).code===200&&(R.success({description:"更新作弊事件成功"}),c(!1),y())}catch(t){console.error("更新作弊事件失败:",t)}},v=t=>t?new Date(t).toLocaleString("zh-CN"):"-",w=t=>({cheater:"确认作弊",suspicious:"疑似作弊",pass:"误报"})[t]||t,C=t=>({cheater:"error",suspicious:"warning",pass:"default"})[t]||"default",H=[{key:"id",label:"ID",width:"8%"},{key:"user_id",label:"用户ID",width:"10%"},{key:"team_id",label:"团队ID",width:"10%"},{key:"type",label:"类型",width:"12%"},{key:"reason",label:"原因",width:"15%"},{key:"ip",label:"IP地址",width:"12%"},{key:"checked",label:"状态",width:"8%"},{key:"time",label:"时间",width:"15%"},{key:"actions",label:"操作",width:"10%"}],J=(t,n)=>{switch(n.key){case"type":return e.jsx(m,{type:C(t.type),text:w(t.type)});case"reason":return e.jsx("span",{className:"max-w-[200px] truncate block",title:t.reason,children:t.reason||"-"});case"checked":return e.jsx(m,{type:t.checked?"success":"warning",text:t.checked?"已处理":"未处理"});case"time":return v(t.time);case"actions":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:f=>{f.stopPropagation(),B(t)},className:"!p-1 !h-6 !w-6",children:e.jsx(Q,{size:14})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:f=>{f.stopPropagation(),L(t)},className:"!p-1 !h-6 !w-6",children:e.jsx(U,{size:14})})]});default:return t[n.key]||"-"}},I=[{value:"cheater",label:"确认作弊"},{value:"suspicious",label:"疑似作弊"},{value:"pass",label:"误报"}];return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"作弊事件管理"})}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>F(!b),className:`!bg-black/30 ${b?"!bg-geek-400/20":""}`,children:[e.jsx(G,{size:16}),"筛选"]})]}),b&&e.jsx(S.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-4 mb-6",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"类型筛选:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(t=>e.jsx(d,{variant:r===t.value?"primary":"ghost",size:"sm",onClick:()=>A(t.value),className:r===t.value?"":"!bg-black/30",children:t.label},t.value))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-4",children:[e.jsx("h3",{className:"text-sm font-mono text-neutral-400 mb-2",children:"总作弊事件"}),e.jsx("p",{className:"text-2xl text-neutral-50",children:h})]}),e.jsxs("div",{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-4",children:[e.jsx("h3",{className:"text-sm font-mono text-neutral-400 mb-2",children:"已处理"}),e.jsx("p",{className:"text-2xl text-green-400",children:i.filter(t=>t.checked).length})]}),e.jsxs("div",{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-4",children:[e.jsx("h3",{className:"text-sm font-mono text-neutral-400 mb-2",children:"未处理"}),e.jsx("p",{className:"text-2xl text-yellow-400",children:i.filter(t=>!t.checked).length})]})]}),e.jsx("div",{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",children:e.jsx($,{columns:H,data:i,renderCell:J,empty:i.length===0,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-neutral-300/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-mono text-neutral-400",children:"暂无作弊事件"})]}),footer:e.jsx(q,{total:Math.ceil(h/p),current:u,onChange:T,showTotal:!0,totalItems:h})})})]}),e.jsx(D,{isOpen:P,onClose:()=>c(!1),title:"编辑作弊事件",size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"default",onClick:()=>c(!1),children:"取消"}),e.jsx(g,{variant:"primary",onClick:O,children:"保存"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"判断结果"}),e.jsx("select",{value:a.type,onChange:t=>o({...a,type:t.target.value}),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:I.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"作弊原因"}),e.jsx("textarea",{value:a.reason,onChange:t=>o({...a,reason:t.target.value}),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"请输入作弊原因"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"处理状态"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.checked,onChange:t=>o({...a,checked:t.target.checked}),className:"w-4 h-4 text-blue-600 bg-neutral-800 border-neutral-700 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-neutral-300",children:"已处理"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"备注"}),e.jsx("textarea",{value:a.comment,onChange:t=>o({...a,comment:t.target.value}),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"请输入备注"})]})]})}),e.jsx(D,{isOpen:_,onClose:()=>j(!1),title:"作弊事件详情",size:"lg",footer:e.jsx(g,{variant:"default",onClick:()=>j(!1),children:"关闭"}),children:s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"事件ID"}),e.jsx("p",{className:"text-neutral-300",children:s.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"用户ID"}),e.jsx("p",{className:"text-neutral-300",children:s.user_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"团队ID"}),e.jsx("p",{className:"text-neutral-300",children:s.team_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"比赛ID"}),e.jsx("p",{className:"text-neutral-300",children:s.contest_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目ID"}),e.jsx("p",{className:"text-neutral-300",children:s.contest_challenge_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Flag ID"}),e.jsx("p",{className:"text-neutral-300",children:s.contest_flag_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"IP地址"}),e.jsx("p",{className:"text-neutral-300",children:s.ip})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"时间"}),e.jsx("p",{className:"text-neutral-300",children:v(s.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"作弊类型"}),e.jsx(m,{type:C(s.type),text:w(s.type)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"作弊原因"}),e.jsx("p",{className:"text-neutral-300 bg-neutral-800 p-3 rounded",children:s.reason||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"处理状态"}),e.jsx(m,{type:s.checked?"success":"warning",text:s.checked?"已处理":"未处理"})]}),s.comment&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"处理备注"}),e.jsx("p",{className:"text-neutral-300 bg-neutral-800 p-3 rounded",children:s.comment})]}),s.magic&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Magic值"}),e.jsx("p",{className:"text-neutral-300 font-mono text-sm bg-neutral-800 p-3 rounded break-all",children:s.magic})]}),s.hash&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Hash值"}),e.jsx("p",{className:"text-neutral-300 font-mono text-sm bg-neutral-800 p-3 rounded break-all",children:s.hash})]})]})})]})}export{ce as default};
