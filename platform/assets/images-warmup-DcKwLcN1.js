import{j as e,B as y,m as g,h as I,a as i,t as j}from"./index-3olWmlYE.js";import{E as S,F as P}from"./contest-B1aSRHnb.js";import{I as k}from"./IconRefresh-1l82559U.js";import{I as C}from"./IconServer-DPPDJXC9.js";import{I as A}from"./IconDownload-8CMg94qi.js";function W({images:a=[],selectedImages:n=[],pullPolicy:u="IfNotPresent",loading:b=!1,submitting:x=!1,onImageToggle:o,onSelectAll:N,onPullPolicyChange:l,onWarmup:c,onRefresh:h}){const v=t=>t?e.jsx("span",{className:"px-2 py-1 text-xs font-mono rounded border bg-green-400/20 text-green-400 border-green-400/30",children:"已存在"}):e.jsx("span",{className:"px-2 py-1 text-xs font-mono rounded border bg-neutral-400/20 text-neutral-400 border-neutral-400/30",children:"未加载"}),d=[{value:"Always",label:"Always - 总是拉取最新镜像"},{value:"IfNotPresent",label:"IfNotPresent - 本地不存在时拉取"},{value:"Never",label:"Never - 仅使用本地镜像"}];return b?e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex items-center gap-3 text-neutral-400",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(k,{size:20})}),e.jsx("span",{className:"font-mono",children:"加载中..."})]})})}):e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"镜像预热"}),e.jsx(y,{variant:"outline",size:"sm",align:"icon-left",icon:e.jsx(k,{size:18}),onClick:h,children:"刷新状态"})]}),e.jsxs(g.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-mono text-neutral-50",children:"预热控制"}),e.jsxs("div",{className:"flex items-center gap-2 text-neutral-400 font-mono text-sm",children:[e.jsx(C,{size:16}),e.jsx("span",{children:"预热比赛中使用到的Docker镜像"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"拉取策略"}),e.jsx("select",{value:u,onChange:t=>l(t.target.value),className:"select-custom select-custom-md",children:d.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(y,{variant:"outline",onClick:N,className:"w-full",children:n.length===a.length?"取消全选":"全选"})}),e.jsx("div",{className:"flex items-end",children:e.jsxs(y,{variant:"primary",onClick:c,loading:x,disabled:n.length===0,className:"w-full",align:"icon-left",icon:e.jsx(A,{size:18}),children:["执行预热 (",n.length,")"]})})]})]}),e.jsxs(g.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("div",{className:"px-6 py-4 border-b border-neutral-300/30",children:e.jsx("h2",{className:"text-lg font-mono text-neutral-50",children:"镜像状态"})}),a.length===0?e.jsx("div",{className:"py-12 flex justify-center items-center",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无镜像数据"})}):e.jsx("div",{className:"divide-y divide-neutral-300/10",children:a.map((t,p)=>{const r=Object.keys(t)[0],s=t[r],m=n.includes(r);return e.jsx(g.div,{className:"p-6 hover:bg-neutral-300/5 transition-colors duration-200",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:p*.05},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"pt-1",children:e.jsx("input",{type:"checkbox",checked:m,onChange:()=>o(r),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                   focus:ring-geek-400 focus:ring-offset-0 bg-black/20\r
                                   transition-colors duration-200`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-mono text-neutral-50 mb-4 break-all",children:r}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-3",children:s.map((f,w)=>e.jsxs(g.div,{className:"flex items-center gap-3 p-3 bg-black/20 border border-neutral-300/20 rounded-md",whileHover:{backgroundColor:"rgba(0,0,0,0.4)"},transition:{duration:.2},children:[e.jsx("span",{className:"text-sm font-mono text-neutral-300 flex-1 truncate",children:f.node}),v(f.status)]},w))})]})]})},p)})})]})]})}function D(){const{id:a}=I(),[n,u]=i.useState(!0),[b,x]=i.useState(!1),[o,N]=i.useState([]),[l,c]=i.useState([]),[h,v]=i.useState("IfNotPresent");i.useEffect(()=>{d()},[a]);const d=async()=>{u(!0);try{const s=await S(parseInt(a));s.code===200&&N(s.data||[])}catch(s){console.error("获取预热镜像信息失败:",s),j.danger({description:"获取预热镜像信息失败"})}finally{u(!1)}},t=s=>{c(m=>m.includes(s)?m.filter(f=>f!==s):[...m,s])},p=()=>{l.length===o.length?c([]):c(o.map(s=>Object.keys(s)[0]))},r=async()=>{if(l.length===0){j.warning({description:"请选择要预热的镜像"});return}x(!0);try{(await P(parseInt(a),{images:l,pull_policy:h})).code===200&&(j.success({description:"预热镜像任务已提交"}),setTimeout(()=>{d()},2e3))}catch(s){console.error("预热镜像失败:",s),j.danger({description:"预热镜像失败"})}finally{x(!1)}};return e.jsx(W,{images:o,selectedImages:l,pullPolicy:h,loading:n,submitting:b,onImageToggle:t,onSelectAll:p,onPullPolicyChange:v,onWarmup:r,onRefresh:d})}export{D as default};
