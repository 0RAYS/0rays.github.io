import{a as c,j as e,B as N,m as M,g as _,t as n}from"./index-DWnK0TXq.js";import{A as z,M as v}from"./AdminModal-CcpQgLj_.js";import{A}from"./AdminPagination-DluKrlAy.js";import{I as P}from"./IconPlus-L0q5EmfX.js";import{I as E}from"./IconEdit-DtBBU1XU.js";import{I as B}from"./IconTrash-zHFLqkpL.js";import{A as D,B as F,C as T,D as q}from"./contest-COzySu5P.js";import"./IconX-DnOZQPbW.js";import"./IconChevronsRight-BoKb-jjv.js";function U({notices:i=[],totalCount:p=0,currentPage:g=1,pageSize:f=10,onPageChange:b,onCreateNotice:u,onUpdateNotice:j,onDeleteNotice:m}){const[d,l]=c.useState(!1),[o,x]=c.useState("create"),[s,a]=c.useState(null),[r,h]=c.useState({title:"",content:"",type:""}),k=()=>{x("create"),h({title:"",content:"",type:"normal"}),l(!0)},C=t=>{x("edit"),a(t),h({title:t.title,content:t.content,type:t.type}),l(!0)},w=t=>{x("delete"),a(t),l(!0)},y=()=>{o==="create"?u(r):o==="edit"?j(s.id,r):m(s.id),l(!1)},I=()=>o==="delete"?e.jsxs("p",{className:"text-neutral-300",children:['确定要删除公告 "',s==null?void 0:s.title,'" 吗？此操作不可恢复。']}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"公告标题"}),e.jsx("input",{type:"text",value:r.title,onChange:t=>h({...r,title:t.target.value}),placeholder:"请输入公告标题",className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"公告类型"}),e.jsxs("select",{value:r.type,onChange:t=>h({...r,type:t.target.value}),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`,children:[e.jsx("option",{value:"normal",className:"bg-black/90 text-neutral-50",children:"normal"}),e.jsx("option",{value:"important",className:"bg-black/90 text-neutral-50",children:"important"}),e.jsx("option",{value:"update",className:"bg-black/90 text-neutral-50",children:"update"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"公告内容"}),e.jsx("textarea",{"aria-required":!0,value:r.content,onChange:t=>h({...r,content:t.target.value}),placeholder:"请输入公告内容",rows:5,className:`w-full p-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200 resize-none`})]})]}),S=()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{onClick:()=>l(!1),children:"取消"}),e.jsx(v,{variant:o==="delete"?"danger":"primary",onClick:y,children:"确认"})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"公告管理"}),e.jsx(N,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(P,{size:18}),onClick:k,children:"发布公告"})]}),e.jsx("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/50 text-left",children:[e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"标题"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"类型"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"内容"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-right",children:"操作"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs(M.tr,{className:"border-t border-neutral-700 hover:bg-black/20",whileHover:{backgroundColor:"rgba(0,0,0,0.3)"},children:[e.jsx("td",{className:"p-4 text-neutral-50 font-medium",children:t.title}),e.jsx("td",{className:"p-4 text-neutral-300 font-medium",children:t.type}),e.jsx("td",{className:"p-4 text-neutral-300",children:e.jsx("div",{className:"max-w-lg truncate",children:t.content})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>C(t),children:e.jsx(E,{size:18})}),e.jsx(N,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>w(t),children:e.jsx(B,{size:18})})]})})]},t.id))})]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(A,{total:Math.ceil(p/f),current:g,pageSize:f,onChange:b,showTotal:!0,totalItems:p})}),e.jsx(z,{isOpen:d,onClose:()=>l(!1),title:o==="create"?"发布公告":o==="edit"?"编辑公告":"删除公告",size:o==="delete"?"sm":"md",footer:S(),children:I()})]})}function W(){const{id:i}=_(),[p,g]=c.useState([]),[f,b]=c.useState(0),[u,j]=c.useState(1),m=10;c.useEffect(()=>{d()},[i,u]);const d=async()=>{try{const s=await D(parseInt(i),{limit:m,offset:(u-1)*m});s.code===200&&(g(s.data.notices),b(s.data.count))}catch(s){console.error("获取公告列表失败:",s),n.danger({description:"获取公告列表失败"})}},l=async s=>{try{const a=await q(parseInt(i),s);a.code===200?(n.success({description:"创建公告成功"}),d()):n.danger({description:a.msg||"创建公告失败"})}catch(a){console.error("创建公告失败:",a),n.danger({description:"创建公告失败"})}},o=async(s,a)=>{try{const r=await T(parseInt(i),s,a);r.code===200?(n.success({description:"更新公告成功"}),d()):n.danger({description:r.msg||"更新公告失败"})}catch(r){console.error("更新公告失败:",r),n.danger({description:"更新公告失败"})}},x=async s=>{try{const a=await F(parseInt(i),s);a.code===200?(n.success({description:"删除公告成功"}),d()):n.danger({description:a.msg||"删除公告失败"})}catch(a){console.error("删除公告失败:",a),n.danger({description:"删除公告失败"})}};return e.jsx(U,{notices:p,totalCount:f,currentPage:u,pageSize:m,onPageChange:j,onCreateNotice:l,onUpdateNotice:o,onDeleteNotice:x})}export{W as default};
