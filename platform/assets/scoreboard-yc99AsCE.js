import{j as e,m as I,g as q,a as l,t as f,B as v}from"./index-BBMUkGmi.js";import{a as F,i as J,j as Q,k as V}from"./contest-u8QN84w8.js";import{A}from"./AdminPagination-D4-iUx_J.js";import{S as X}from"./ScrollingText-CiwSk9ud.js";import{S as ee,I as te,a as se,b as ae,c as ne}from"./ScoreboardStats-Cfupn3pu.js";import{I as oe}from"./IconTable-B8tXSoA2.js";import"./IconChevronsRight-BNaHSBQK.js";import"./index-BDhsyBzv.js";const re={WEB:"bg-blue-400",CRYPTO:"bg-purple-400",PWN:"bg-red-400",REVERSE:"bg-green-400",MISC:"bg-yellow-400"};function le({solved:r,totalSolved:d}){const a=d-Object.values(r).reduce((t,i)=>t+i,0);return e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[Object.entries(r).map(([t,i])=>i<=0?null:e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`${t}: ${i}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${re[t]||"bg-gray-400"}`}),e.jsx("span",{className:"text-neutral-300",children:i})]},t)),a>0&&e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`未解题目: ${a}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-600"}),e.jsx("span",{className:"text-neutral-400",children:a})]})]})}function ie({teams:r=[],currentPage:d=1,pageSize:a=6,totalCount:t=0,onPageChange:i}){return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs(I.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[60px_240px_160px_auto_180px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:r.length===0?e.jsx("div",{className:"py-12 flex justify-center items-center",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):r.map((n,S)=>e.jsxs(I.div,{className:"grid grid-cols-[60px_240px_160px_auto_180px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("span",{className:`font-mono text-xl
                                      ${n.rank===1?"text-yellow-400":n.rank===2?"text-neutral-300":n.rank===3?"text-orange-400":"text-neutral-400"}
                                  `,children:["#",n.rank]})}),e.jsxs("div",{className:"flex items-center gap-4 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300/30 bg-neutral-700/50 bg-cover bg-center",style:{backgroundImage:`url(${n.avatar})`}}),e.jsx(X,{text:n.name,className:"text-neutral-50 font-mono",maxWidth:240,speed:15})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-geek-400 font-mono",children:n.score.toLocaleString()})}),n.solved&&e.jsx(le,{solved:n.solved,totalSolved:n.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:n.lastSubmit})})]},S))})]}),t>a&&e.jsx("div",{className:"mt-6",children:e.jsx(A,{total:Math.ceil(t/a),current:d,pageSize:a,onChange:i,showTotal:!0,totalItems:t})})]})}function ce({teams:r=[],challenges:d=[],totalCount:a=0,currentPage:t=1,pageSize:i=10,onPageChange:n}){return e.jsx(ee,{teams:r,challenges:d,totalCount:a,currentPage:t,pageSize:i,onPageChange:n,isAdmin:!0,PaginationComponent:A})}function je({viewMode:r,onViewModeChange:d}){const{id:a}=q(),[t,i]=l.useState(r||"ranking"),[n,S]=l.useState([]),[L,R]=l.useState(0),[g,C]=l.useState(1),p=10,[z,M]=l.useState({totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0}),[_,$]=l.useState([]),[B,D]=l.useState([]),[y,T]=l.useState(1),[O,W]=l.useState(0),N=10,[k,G]=l.useState([]),[H,w]=l.useState(!1),h=o=>{const s=o;i(s),d&&d(s),s==="table"?T(1):s==="ranking"&&C(1)},K=async()=>{w(!0);try{const o=await V(a);o.code===200&&G(o.data||[])}catch(o){console.error("获取时间线数据失败:",o),f.danger({description:"获取时间线数据失败"})}finally{w(!1)}};l.useEffect(()=>{t==="ranking"?U():t==="table"?Y():t==="timeline"&&k.length===0&&K()},[a,t,g,y]),l.useEffect(()=>{r&&r!==t&&i(r)},[r]);const U=async(o=!1)=>{try{const s=await F(parseInt(a)),m=await J(parseInt(a),{limit:p,offset:(g-1)*p},o);if(m.code===200&&s.code===200){M({totalTeams:s.data.teams||0,totalSolves:s.data.solved||0,highestScore:s.data.highest||0,totalPlayers:s.data.users||0});const j=m.data.teams.map((c,x)=>{const u={};let P=0;return c.solved&&Array.isArray(c.solved)&&c.solved.forEach(b=>{b.category&&(u[b.category]=b.solved||0,P+=b.all||0)}),{...c,rank:(g-1)*p+x+1,lastSubmit:Z(c.last),solved:u,totalSolved:P}});S(j),R(m.data.count)}else f.danger({description:m.msg||"获取团队列表失败"})}catch(s){console.error("获取团队列表失败:",s),f.danger({description:"获取团队列表失败"})}},Y=async()=>{var o;try{const s=await Q(parseInt(a),{limit:N,offset:(y-1)*N});if(s.code===200){$(s.data.teams||[]),W(s.data.count||0);const m=[],j=new Map;(o=s.data.teams)==null||o.forEach(c=>{var x;(x=c.challenges)==null||x.forEach(u=>{j.has(u.id)||(j.set(u.id,u),m.push(u))})}),m.sort((c,x)=>c.category!==x.category?c.category.localeCompare(x.category):c.name.localeCompare(x.name)),D(m)}else f.danger({description:s.msg||"获取积分榜失败"})}catch(s){console.error("获取积分榜失败:",s),f.danger({description:"获取积分榜失败"})}},Z=o=>!o||o==="0001-01-01T00:00:00Z"?"无提交":new Date(o).toLocaleString(),E=async()=>{f.info({description:"此功能暂未实现"})};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"积分榜管理"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/30 border border-neutral-300/30 rounded-md",children:[e.jsx(v,{variant:t==="ranking"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:16}),onClick:()=>h("ranking")}),e.jsx(v,{variant:t==="table"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(oe,{size:16}),onClick:()=>h("table")}),e.jsx(v,{variant:t==="timeline"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:16}),onClick:()=>h("timeline")})]}),e.jsx(v,{variant:"outline",size:"sm",onClick:E,children:"导出积分榜"})]})]}),e.jsx(ae,{...z}),t==="ranking"?e.jsx(ie,{teams:n,currentPage:g,pageSize:p,totalCount:L,onPageChange:C,onExportScoreboard:E,viewMode:t,onViewModeChange:h}):t==="table"?e.jsx(ce,{teams:_,challenges:B,totalCount:O,currentPage:y,pageSize:N,onPageChange:T}):e.jsx(ne,{timelineData:k,loading:H})]})}export{je as default};
