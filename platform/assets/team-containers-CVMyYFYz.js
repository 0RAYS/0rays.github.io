import{c as K,j as e,B as M,m as z,a,t as I,g as xe}from"./index-CGfkfi28.js";import{q as he,t as ue,v as fe,w as pe,x as ge,y as je,z as be}from"./contest-CJIq-IFE.js";import{A as X}from"./AdminPagination-Bz9TGggw.js";import{I as ee}from"./IconDownload-Dprrwa1C.js";import{I as Ne}from"./IconServer-CAYq4ns7.js";import{A as ve}from"./AdminModal-DQWuAHfX.js";import{E as we}from"./index-CKdG0TQW.js";import{I as ye}from"./IconRefresh-DdLLNdMo.js";import{I as ke}from"./IconPlayerPlay-CqDU_jj5.js";import{I as Ce}from"./IconX-Dek9knIy.js";import"./IconChevronsRight-DLBn-j29.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M9 15l2 2l4 -4",key:"svg-2"}]],Se=K("outline","file-check","FileCheck",Ie);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]],Me=K("outline","file","File",Te);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M4 18v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M7 14l3 -3l2 2l3 -3l2 2",key:"svg-1"}]],Pe=K("outline","graph","Graph",ze);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]],$e=K("outline","player-pause","PlayerPause",De);function Ee(r){try{if(r=r.replace(/\s/g,""),!/^[0-9A-Fa-f]*$/.test(r))return"无效的hex数据";const i=new Uint8Array(r.match(/.{1,2}/g).map(f=>parseInt(f,16)));return new TextDecoder("utf-8").decode(i)}catch(i){return console.error("Hex解析错误:",i),"解析错误"}}function Re({recentSubmissions:r=[],teamWriteups:i=[],containerTraffic:o=[],submissionCount:f=0,writeupCount:y=0,trafficCount:g=0,currentSubmissionPage:k=1,currentWriteupPage:W=1,currentTrafficPage:C=1,onPageChange:$,onViewTrafficGraph:j,onDownloadTraffic:E,onDownloadWriteup:N,loading:R={submissions:!1,writeups:!1,traffic:!1},activeTab:c="submissions",onTabChange:S}){const _=s=>new Date(s).toLocaleString("zh-CN"),T=s=>s<1024?s+" B":s<1048576?(s/1024).toFixed(2)+" KB":(s/1048576).toFixed(2)+" MB",U=s=>{const x=s/1e9;if(x<60)return`${Math.round(x)}秒`;if(x<3600)return`${Math.floor(x/60)}分钟${Math.round(x%60)}秒`;{const F=Math.floor(x/3600),A=Math.floor(x%3600/60);return`${F}小时${A>0?`${A}分钟`:""}`}},P=s=>Math.ceil(s/10);return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50",children:"队伍详情"}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsxs(M,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="submissions"?"text-geek-400":"text-neutral-400"}`,onClick:()=>S("submissions"),children:["最近提交",c==="submissions"&&e.jsx(z.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTabIndicator"})]}),e.jsxs(M,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="writeups"?"text-geek-400":"text-neutral-400"}`,onClick:()=>S("writeups"),children:["题解列表",c==="writeups"&&e.jsx(z.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTabIndicator"})]}),e.jsxs(M,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="traffic"?"text-geek-400":"text-neutral-400"}`,onClick:()=>S("traffic"),children:["靶机流量",c==="traffic"&&e.jsx(z.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTabIndicator"})]})]})}),c==="submissions"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-xl font-mono text-neutral-50 flex items-center",children:[e.jsx(Se,{size:20,className:"mr-2 text-geek-400"}),"最近提交"]})}),R.submissions?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-geek-500 rounded-full border-t-transparent"})}):r.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无提交记录"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:r.map((s,x)=>e.jsx(z.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden p-4",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"赛题ID:"}),e.jsx("span",{className:"text-white font-mono",children:s.challenge_id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"队伍ID:"}),e.jsx("span",{className:"text-white font-mono",children:s.team_id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"用户ID:"}),e.jsx("span",{className:"text-white font-mono",children:s.user_id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"提交Flag:"}),e.jsx("span",{className:"text-white font-mono max-w-xxs truncate",children:s.value})]})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-mono ${s.solved?"bg-green-400/20 text-green-400":"bg-red-400/20 text-red-400"}`,children:s.solved?"正确":"错误"})})]})},x))}),e.jsx("div",{className:"mt-6",children:e.jsx(X,{total:P(f),current:k,pageSize:10,onChange:s=>$("submissions",s),showTotal:!0,totalItems:f})})]})]}),c==="writeups"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-xl font-mono text-neutral-50 flex items-center",children:[e.jsx(Me,{size:20,className:"mr-2 text-geek-400"}),"题解列表"]})}),R.writeups?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-geek-500 rounded-full border-t-transparent"})}):i.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无题解提交"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsx(z.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden p-4",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"提交日期:"}),e.jsx("span",{className:"text-white font-mono",children:_(s.date)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"文件名:"}),e.jsx("span",{className:"text-white font-mono",children:s.filename})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"大小:"}),e.jsx("span",{className:"text-white font-mono",children:T(s.size)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"哈希值:"}),e.jsx("span",{className:"text-white font-mono text-xs max-w-xs truncate",children:s.hash})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"上传者:"}),e.jsx("span",{className:"text-white font-mono",children:s.uploader})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(M,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>N(s),title:"下载题解",children:e.jsx(ee,{size:18})})})]})},s.id))}),e.jsx("div",{className:"mt-6",children:e.jsx(X,{total:P(y),current:W,pageSize:10,onChange:s=>$("writeups",s),showTotal:!0,totalItems:y})})]})]}),c==="traffic"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-xl font-mono text-neutral-50 flex items-center",children:[e.jsx(Ne,{size:20,className:"mr-2 text-geek-400"}),"靶机流量"]})}),R.traffic?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-geek-500 rounded-full border-t-transparent"})}):o.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无靶机流量数据"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsx(z.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden p-4",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"容器ID:"}),e.jsx("span",{className:"text-white font-mono",children:s.id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"开始时间:"}),e.jsx("span",{className:"text-white font-mono",children:_(s.start)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"持续时间:"}),e.jsx("span",{className:"text-white font-mono",children:U(s.duration)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"状态:"}),e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-mono ${Le(s.start,s.duration)}`,children:_e(s.start,s.duration)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>j(s),title:"查看流量",children:e.jsx(Pe,{size:18})}),e.jsx(M,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>E(s),title:"下载流量文件",children:e.jsx(ee,{size:18})})]})]})},s.id))}),e.jsx("div",{className:"mt-6",children:e.jsx(X,{total:P(g),current:C,pageSize:10,onChange:s=>$("traffic",s),showTotal:!0,totalItems:g})})]})]})]})}const _e=(r,i)=>{const o=new Date,f=new Date(r),y=i/1e6,g=new Date(f.getTime()+y);return o<f?"未开始":o>g?"已结束":"运行中"},Le=(r,i)=>{const o=new Date,f=new Date(r),y=i/1e6,g=new Date(f.getTime()+y);return o<f?"bg-blue-400/20 text-blue-400":o>g?"bg-red-400/20 text-red-400":"bg-green-400/20 text-green-400"};function Ue({isOpen:r,onClose:i,container:o,contestId:f,teamId:y}){const g=a.useRef(null),[k,W]=a.useState([]),[C,$]=a.useState([]),[j,E]=a.useState(0),[N,R]=a.useState(1),[c,S]=a.useState(60),[p,_]=a.useState(!1),[T,U]=a.useState(null),P=async(n=0,v=1)=>{if(o!=null&&o.id)try{const d=await he(f,y,o.id,{time_shift:n,duration:v});d.code===200&&(W(d.data.connections||[]),$(d.data.ip||[]),S(d.data.duration||60))}catch(d){console.error("获取流量数据失败:",d),I.danger({description:"获取流量数据失败"})}},s=()=>{if(p)return;_(!0);let n=j;const v=setInterval(()=>{n>=c?(n=0,E(0)):(n+=1,E(n))},1e3);U(v)},x=()=>{p&&(_(!1),T&&(clearInterval(T),U(null)))},F=()=>{if(!k||!C)return{nodes:[],links:[]};const n=[],v=[],d=new Map,D=0,O=0,q=200;return C.forEach((h,u)=>{const b=`ip_${u}`,L=u/C.length*2*Math.PI,H=D+q*Math.cos(L),V=O+q*Math.sin(L);n.push({id:b,name:h,symbolSize:35,x:H,y:V,itemStyle:{color:"#3b82f6"}}),d.set(h,b)}),k.forEach(h=>{const u=d.get(h.src_ip),b=d.get(h.dst_ip);u&&b&&v.push({source:u,target:b,value:h.size,count:h.count,type:h.type,subtype:h.subtype,lineStyle:{color:A(h.type),width:Math.min(h.count/10,5)+1}})}),C.forEach(h=>{const u=d.get(h);u&&Math.random()>.5&&v.push({source:"container",target:u,value:Math.floor(Math.random()*1e3)+100,lineStyle:{color:"#10b981",width:Math.random()*2+1}})}),{nodes:n,links:v}},A=n=>{switch(n==null?void 0:n.toUpperCase()){case"TCP":return"#3b82f6";case"UDP":return"#ef4444";default:return"#6b7280"}},Y=()=>{const{nodes:n,links:v}=F();return{tooltip:{trigger:"item",formatter:function(d){if(d.dataType==="node")return`<div style="color: #f3f4f6;">
              <strong>${d.data.name}</strong>
            </div>`;{const D=d.data;return`<div style="color: #f3f4f6;">
              <strong>流量连接</strong><br/>
              流量大小: ${D.value} bytes<br/>
              连接次数: ${D.count||"N/A"}<br/>
              协议类型: ${D.type||"Unknown"} / ${D.subtype||"Unknown"}
            </div>`}},backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"#374151",borderWidth:1,textStyle:{color:"#f3f4f6"}},legend:{top:"bottom",textStyle:{color:"#f3f4f6",fontSize:12},itemGap:20},animation:!0,animationDuration:500,animationEasingUpdate:"quinticOut",series:[{type:"graph",layout:"none",data:n,links:v,edgeSymbol:["circle","arrow"],edgeSymbolSize:[4,10],roam:!0,label:{show:!0,position:"bottom",formatter:"{b}",color:"#f3f4f6",fontSize:11,backgroundColor:"rgba(0, 0, 0, 0.7)",padding:[4,8],borderRadius:4},emphasis:{focus:"adjacency",itemStyle:{shadowBlur:10,shadowColor:"#fff"}},labelLayout:{hideOverlap:!0},lineStyle:{color:"source",curveness:.2}}]}};a.useEffect(()=>{r&&(o!=null&&o.id)&&P(j,N)},[r,o==null?void 0:o.id,j,N]),a.useEffect(()=>{r&&g.current&&g.current.getEchartsInstance().resize()},[r]),a.useEffect(()=>()=>{T&&clearInterval(T)},[T]);const J=()=>{P(j,N)},Q=n=>{E(n)},G=n=>{R(n)},B=()=>{p?x():s()};return r?e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:i,children:e.jsxs(z.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative w-full max-w-7xl h-[90vh] bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl overflow-hidden flex flex-col",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-700 bg-neutral-800 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:"网络流量关系图"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:"时间偏移:"}),e.jsx("input",{type:"number",min:"0",max:c,value:j,onChange:n=>Q(parseInt(n.target.value)||0),className:"w-20 px-2 py-1 bg-neutral-700 border border-neutral-600 rounded text-white text-sm"}),e.jsx("span",{className:"text-sm text-neutral-400",children:"秒"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:"时间片:"}),e.jsx("input",{type:"number",min:"1",max:c,value:N,onChange:n=>G(parseInt(n.target.value)||60),className:"w-20 px-2 py-1 bg-neutral-700 border border-neutral-600 rounded text-white text-sm"}),e.jsx("span",{className:"text-sm text-neutral-400",children:"秒"})]}),e.jsx(M,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:J,children:e.jsx(ye,{size:16})}),e.jsx(M,{variant:"ghost",size:"icon",className:`${p?"!text-red-400 hover:!text-red-300":"!text-green-400 hover:!text-green-300"}`,onClick:B,children:p?e.jsx($e,{size:16}):e.jsx(ke,{size:16})})]}),e.jsx(M,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-200",onClick:i,children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{className:"flex-1 p-4 min-h-0",children:e.jsx(we,{ref:g,option:Y(),style:{height:"100%",width:"100%"},opts:{renderer:"canvas"}})}),e.jsx("div",{className:"p-4 border-t border-neutral-700 bg-neutral-800 flex-shrink-0",children:e.jsx("div",{className:"flex items-center justify-between text-sm text-neutral-400",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-mono",children:["IP数量: ",C.length||0]}),e.jsxs("span",{className:"font-mono",children:["连接数: ",k.length||0]}),e.jsxs("span",{className:"font-mono",children:["最大时长: ",c||0,"秒"]}),e.jsxs("span",{className:"font-mono",children:["时间片: ",N||0,"秒"]}),p&&e.jsxs("span",{className:"font-mono text-green-400",children:["播放中: ",j,"/",c,"秒"]})]}),e.jsxs("span",{className:"font-mono",children:["更新时间: ",new Date().toLocaleString("zh-CN")]})]})})})]})}):null}function Ye(){const{id:r,teamId:i}=xe(),[o,f]=a.useState(!1),[y,g]=a.useState(!1),[k,W]=a.useState(null),[C,$]=a.useState([]),[j,E]=a.useState(0),[N,R]=a.useState(1),[c,S]=a.useState(null),[p,_]=a.useState("submissions"),[T,U]=a.useState([]),[P,s]=a.useState(0),[x,F]=a.useState(1),[A,Y]=a.useState([]),[J,Q]=a.useState(0),[G,B]=a.useState(1),[n,v]=a.useState([]),[d,D]=a.useState(0),[O,q]=a.useState(1),[h,u]=a.useState({submissions:!1,writeups:!1,traffic:!1,modalTraffic:!1}),b=10,L=6;a.useEffect(()=>{switch(p){case"submissions":H();break;case"writeups":V();break;case"traffic":Z();break}},[p]),a.useEffect(()=>{p==="submissions"&&H()},[x]),a.useEffect(()=>{p==="writeups"&&V()},[G]),a.useEffect(()=>{p==="traffic"&&Z()},[O]);const H=async()=>{u(t=>({...t,submissions:!0}));try{const t=await ue(parseInt(r),parseInt(i),{limit:b,offset:(x-1)*b});t.code===200&&(U(t.data.submissions||[]),s(t.data.count||0))}catch(t){console.log(t),I.danger({description:"获取提交记录失败"})}finally{u(t=>({...t,submissions:!1}))}},V=async()=>{u(t=>({...t,writeups:!0}));try{const t=await fe(parseInt(r),parseInt(i),{limit:b,offset:(G-1)*b});t.code===200?(Y(t.data.writeups||[]),Q(t.data.count||0)):I.danger({description:t.msg||"获取题解列表失败"})}catch(t){console.log(t),I.danger({description:"获取题解列表失败"})}finally{u(t=>({...t,writeups:!1}))}},Z=async()=>{u(t=>({...t,traffic:!0}));try{const t=await pe(parseInt(r),parseInt(i),{limit:b,offset:(O-1)*b});t.code===200?(v(t.data.victims||[]),D(t.data.count||0)):I.danger({description:t.msg||"获取容器列表失败"})}catch(t){console.log(t),I.danger({description:"获取容器列表失败"})}finally{u(t=>({...t,traffic:!1}))}},te=t=>{W(t),g(!0)},se=async t=>{try{const l=await ge(parseInt(r),parseInt(i),t,{limit:L,offset:(N-1)*L});l.code===200?($(l.data.traffics||[]),E(l.data.count||0)):I.danger({description:l.msg||"获取流量数据失败"})}catch(l){console.log(l),I.danger({description:"获取流量数据失败"})}};a.useEffect(()=>{k&&o&&se(k.id)},[N,k,o]);const ae=(t,l)=>{switch(t){case"submissions":F(l);break;case"writeups":B(l);break;case"traffic":q(l);break}},ne=()=>{f(!1),S(null)},re=()=>{g(!1)},oe=t=>{switch(console.log("切换标签页",t),_(t),t){case"submissions":F(1);break;case"writeups":B(1);break;case"traffic":q(1);break}},le=async t=>{try{const l=await be(parseInt(r),parseInt(i),t.id),w=window.URL.createObjectURL(new Blob([l.data])),m=document.createElement("a");m.href=w,m.setAttribute("download",`traffic_${t.id}.zip`),document.body.appendChild(m),m.click(),m.parentNode.removeChild(m),window.URL.revokeObjectURL(w)}catch(l){console.log(l),I.danger({description:"下载流量文件失败"})}},ie=async t=>{try{const l=await je(parseInt(r),parseInt(i),t.id),w=window.URL.createObjectURL(new Blob([l.data])),m=document.createElement("a");m.href=w,m.setAttribute("download",`${t.filename}`),document.body.appendChild(m),m.click(),m.parentNode.removeChild(m),window.URL.revokeObjectURL(w)}catch(l){console.log(l),I.danger({description:"下载题解失败"})}},ce=({className:t=""})=>e.jsxs("div",{className:`flex justify-center items-center ${t}`,children:[e.jsxs("div",{className:"relative w-12 h-12",children:[e.jsx("div",{className:"absolute inset-0 border-2 border-t-geek-400 border-r-geek-400 border-b-transparent border-l-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-1 border-2 border-t-transparent border-r-transparent border-b-geek-400 border-l-geek-400 rounded-full animate-spin animate-delay-150"})]}),e.jsx("span",{className:"ml-3 text-neutral-300 font-mono",children:"加载中..."})]}),de=t=>{S(c===t?null:t)},me=(t,l)=>{if(!t)return e.jsx("span",{className:"text-neutral-400",children:"空"});try{const w=Ee(t),m=c===l;return e.jsxs("div",{children:[e.jsx("div",{onClick:()=>de(l),className:"cursor-pointer font-mono text-sm hover:text-geek-400 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:`line-clamp-2 ${m?"text-geek-400":""}`,children:[w.substring(0,100),w.length>100?"...":""]}),e.jsx("span",{className:"ml-2 text-xs text-neutral-400",children:m?"收起":"展开"})]})}),m&&e.jsx(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"mt-2 border border-neutral-800 rounded-md p-3 bg-black/50 max-h-[300px] overflow-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:w})})]})}catch(w){return console.log(w),e.jsx("span",{className:"text-red-400",children:"解析错误"})}};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{recentSubmissions:T,teamWriteups:A,containerTraffic:n,submissionCount:P,writeupCount:J,trafficCount:d,currentSubmissionPage:x,currentWriteupPage:G,currentTrafficPage:O,onPageChange:ae,onViewTrafficGraph:te,onDownloadTraffic:le,onDownloadWriteup:ie,loading:h,onTabChange:oe,activeTab:p}),e.jsxs(ve,{isOpen:o,onClose:ne,title:"容器流量记录",size:"lg",children:[h.modalTraffic?e.jsx(ce,{className:"h-40"}):C.length===0?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无流量数据"})}):e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:C.map((t,l)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md bg-black/30 p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"类型:"}),e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-mono ${t.type==="request"?"bg-geek-500/20 text-geek-400":t.type==="response"?"bg-green-400/20 text-green-400":"bg-blue-400/20 text-blue-400"}`,children:t.type==="request"?"请求":t.type==="response"?"响应":"TCP"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"源IP:"}),e.jsx("span",{className:"text-white font-mono",children:t.src_ip})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"源端口:"}),e.jsx("span",{className:"text-white font-mono",children:t.src_port})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"时间戳:"}),e.jsx("span",{className:"text-white font-mono",children:new Date(t.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"目标IP:"}),e.jsx("span",{className:"text-white font-mono",children:t.dst_ip})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"目标端口:"}),e.jsx("span",{className:"text-white font-mono",children:t.dst_port})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"负载:"}),e.jsx("div",{className:"mt-2",children:me(t.payload,l)})]})]},t.id||l))}),j>L&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(X,{total:Math.ceil(j/L),current:N,onChange:R,showTotal:!0,totalItems:j})})]}),e.jsx(Ue,{isOpen:y,onClose:re,container:k,contestId:parseInt(r),teamId:parseInt(i)})]})}export{Ye as default};
