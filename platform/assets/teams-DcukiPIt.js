import{c as G,j as e,m as H,B as x,g as ce,u as oe,a as n,t as l}from"./index-CGfkfi28.js";import{A as de,M as O}from"./AdminModal-DQWuAHfX.js";import{A as ie}from"./AdminPagination-Bz9TGggw.js";import{S as Q}from"./ScrollingText-B2U2Q_wK.js";import{I as xe}from"./IconSearch-Cipjq7rg.js";import{I as W}from"./IconEdit-BaCsBMQe.js";import{I as K}from"./IconTrash-B-Auo0pt.js";import{l as he,m as ue,n as me,o as pe,p as ge,s as fe}from"./contest-CJIq-IFE.js";import"./IconX-Dek9knIy.js";import"./IconChevronsRight-DLBn-j29.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M20 4v.01",key:"svg-0"}],["path",{d:"M20 20v.01",key:"svg-1"}],["path",{d:"M20 16v.01",key:"svg-2"}],["path",{d:"M20 12v.01",key:"svg-3"}],["path",{d:"M20 8v.01",key:"svg-4"}],["path",{d:"M8 4m0 1a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-6a1 1 0 0 1 -1 -1z",key:"svg-5"}],["path",{d:"M4 4v.01",key:"svg-6"}],["path",{d:"M4 20v.01",key:"svg-7"}],["path",{d:"M4 16v.01",key:"svg-8"}],["path",{d:"M4 12v.01",key:"svg-9"}],["path",{d:"M4 8v.01",key:"svg-10"}]],V=G("outline","container","Container",je);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4c.348 0 .686 .045 1.009 .128",key:"svg-1"}],["path",{d:"M16 19h6",key:"svg-2"}]],q=G("outline","user-minus","UserMinus",be);function ve({teams:o=[],totalCount:f=0,currentPage:_=1,pageSize:j=6,teamMembers:b=[],loadingMembers:z=!1,editForm:r={},selectedUserId:S="",showModal:T=!1,modalMode:c="edit",selectedTeam:d=null,onPageChange:v,onEditTeam:h,onDeleteTeam:m,onKickMember:N,onViewContainers:k,onModalClose:p,onModalSubmit:y,onFormChange:u,onUserSelect:I,searchQuery:E="",searchResults:w=[],searchLoading:C=!1,onSearchChange:$,searchRef:A,isSearchMode:g=!1}){const i=()=>c==="delete"?e.jsxs("p",{className:"text-neutral-300",children:["确定要删除团队 ",d==null?void 0:d.name," 吗？此操作不可恢复。"]}):c==="kick"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-neutral-300",children:["从团队 ",d==null?void 0:d.name," 中移出成员："]}),z?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("p",{className:"text-neutral-400",children:"加载成员列表中..."})}):b.length===0?e.jsx("p",{className:"text-neutral-400",children:"暂无团队成员"}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"选择要移出的成员"}),e.jsxs("select",{value:S,onChange:t=>I(t.target.value),className:"select-custom select-custom-md",children:[e.jsx("option",{value:"",children:"请选择成员"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"团队名称"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>u({...r,name:t.target.value}),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"团队描述"}),e.jsx("textarea",{value:r.desc,onChange:t=>u({...r,desc:t.target.value}),rows:3,className:`w-full p-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200 resize-none`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"队长"}),e.jsxs("select",{value:S,onChange:t=>I(t.target.value),className:"select-custom select-custom-md",children:[e.jsx("option",{value:"",children:"选择队长"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"邀请码"}),e.jsx("input",{type:"text",value:r.captcha,onChange:t=>u({...r,captcha:t.target.value}),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"banned",checked:r.banned,onChange:t=>u({...r,banned:t.target.checked}),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:"banned",className:"text-sm font-mono text-neutral-400",children:"封禁"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"hidden",checked:r.hidden,onChange:t=>u({...r,hidden:t.target.checked}),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:"hidden",className:"text-sm font-mono text-neutral-400",children:"隐藏"})]})]})]}),L=()=>e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:p,children:"取消"}),e.jsx(O,{variant:c==="delete"?"danger":"primary",onClick:y,children:"确认"})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"团队管理"})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",ref:A,children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"搜索团队"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:E,placeholder:"输入团队名称搜索...",onChange:t=>$(t.target.value),className:`w-full h-10 pl-10 pr-10 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`}),C&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border border-geek-400 border-t-transparent rounded-full animate-spin"})})]})]})})}),g?w.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300/30 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"未找到匹配的团队"})}):e.jsx("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/50 text-center",children:[e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"团队"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"得分"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"成员数"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"最后提交"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"状态"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"操作"})]})}),e.jsx("tbody",{children:w.map(t=>e.jsxs(H.tr,{className:"border-t border-neutral-700 hover:bg-black/20",whileHover:{backgroundColor:"rgba(0,0,0,0.3)"},children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300/30 bg-neutral-700/50 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar})`}}),e.jsxs("div",{children:[e.jsx(Q,{text:t.name,className:"text-neutral-50 font-medium",maxWidth:240,speed:15}),t.desc&&e.jsx("div",{className:"text-sm text-neutral-400 mt-0.5",children:t.desc})]})]})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono text-center",children:t.score}),e.jsxs("td",{className:"p-4 text-neutral-300 font-mono text-center",children:[t.users," 人"]}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono text-center",children:t.last?new Date(t.last).toLocaleString():"无提交"}),e.jsx("td",{className:"p-4 items-center",children:e.jsx("div",{className:"flex gap-4 items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono 
                                                          ${t.banned?"bg-red-400/20 text-red-400":"bg-neutral-400/20 text-neutral-400"}`,children:t.banned?"已封禁":"正常"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono
                                                          ${t.hidden?"bg-yellow-400/20 text-yellow-400":"bg-neutral-400/20 text-neutral-400"}`,children:t.hidden?"已隐藏":"可见"})]})})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>h(t),children:e.jsx(W,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-yellow-400 hover:!text-yellow-300",onClick:()=>N(t),children:e.jsx(q,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:()=>k(t),children:e.jsx(V,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>m(t),children:e.jsx(K,{size:18})})]})})]},t.id))})]})})}):o.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300/30 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/50 text-center",children:[e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"团队"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-center",children:"得分"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-center",children:"成员数"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-center",children:"最后提交"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-center",children:"状态"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-center",children:"操作"})]})}),e.jsx("tbody",{children:o.map(t=>e.jsxs(H.tr,{className:"border-t border-neutral-700 hover:bg-black/20",whileHover:{backgroundColor:"rgba(0,0,0,0.3)"},children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300/30 bg-neutral-700/50 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar})`}}),e.jsxs("div",{children:[e.jsx(Q,{text:t.name,className:"text-neutral-50 font-medium",maxWidth:240,speed:15}),t.desc&&e.jsx("div",{className:"text-sm text-neutral-400  text-center mt-0.5",children:t.desc})]})]})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono text-center",children:t.score}),e.jsxs("td",{className:"p-4 text-neutral-300 font-mono text-center",children:[t.users," 人"]}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono text-center",children:t.last?new Date(t.last).toLocaleString():"无提交"}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex gap-4 items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono
                                                        ${t.banned?"bg-red-400/20 text-red-400":"bg-neutral-400/20 text-neutral-400"}`,children:t.banned?"已封禁":"正常"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono
                                                        ${t.hidden?"bg-yellow-400/20 text-yellow-400":"bg-neutral-400/20 text-neutral-400"}`,children:t.hidden?"已隐藏":"可见"})]})})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>h(t),children:e.jsx(W,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-yellow-400 hover:!text-yellow-300",onClick:()=>N(t),children:e.jsx(q,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:()=>k(t),children:e.jsx(V,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>m(t),children:e.jsx(K,{size:18})})]})})]},t.id))})]})})}),!g&&f>j&&e.jsx("div",{className:"mt-6",children:e.jsx(ie,{total:Math.ceil(f/j),current:_,pageSize:j,onChange:v,showTotal:!0,totalItems:f})}),e.jsx(de,{isOpen:T,onClose:p,title:c==="edit"?"编辑团队信息":c==="delete"?"删除团队":"移出团队成员",size:c==="edit"?"lg":"sm",footer:L(),children:i()})]})}function Te(){const{id:o}=ce(),f=oe(),[_,j]=n.useState([]),[b,z]=n.useState(0),[r,S]=n.useState(1),[T,c]=n.useState(!1),[d,v]=n.useState(null),[h,m]=n.useState("edit"),[N,k]=n.useState({name:"",desc:"",hidden:!1,banned:!1,captcha:"",captain_id:""}),[p,y]=n.useState(""),[u,I]=n.useState([]),[E,w]=n.useState(!1),C=6,[$,A]=n.useState(""),[g,i]=n.useState([]),[L,t]=n.useState(!1),[P,M]=n.useState(!1),R=n.useRef(null);n.useEffect(()=>{B()},[o,r]),n.useEffect(()=>{const s=a=>{R.current&&!R.current.contains(a.target)&&g.length>0&&!P&&i([])};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[g,P]);const B=async()=>{try{const s=await he(parseInt(o),{limit:C,offset:(r-1)*C});s.code===200?(console.log(s.data),j(s.data.teams),z(s.data.count)):l.danger({description:s.msg||"获取团队列表失败"})}catch(s){console.log(s),l.danger({description:"获取团队列表失败"})}},D=async s=>{try{w(!0);const a=await ge(parseInt(o),s.id);a.code===200?I(a.data||[]):l.danger({description:a.msg||"获取团队成员失败"})}catch(a){console.log(a),l.danger({description:"获取团队成员失败"})}finally{w(!1)}},J=async s=>{if(!s||s.trim()===""){i([]),M(!1);return}t(!0);try{const a=await fe({model:"team",name:s.trim(),limit:10,offset:0});if(a.code===200){let U=a.data.results||[];U=U.filter(le=>le.contest_id===parseInt(o)),i(U),M(!0)}else l.danger({description:a.msg||"搜索失败"}),i([]),M(!1)}catch(a){console.error("搜索失败:",a),l.danger({description:"搜索失败"}),i([]),M(!1)}finally{t(!1)}},X=(()=>{let s;return a=>{clearTimeout(s),s=setTimeout(()=>{J(a)},300)}})(),Y=s=>{A(s),!s||s.trim()===""?(M(!1),i([])):X(s)},Z=s=>{v(s),y(""),k({name:s.name,desc:s.desc||"",hidden:s.hidden,banned:s.banned,captcha:s.captcha||"",captain_id:s.captain_id||""}),m("edit"),D(s),c(!0)},F=s=>{v(s),m("delete"),c(!0)},ee=s=>{v(s),y(""),m("kick"),D(s),c(!0)},te=s=>{f(`/admin/contests/${o}/teams/${s.id}/containers`)},se=()=>{c(!1)},ne=s=>{k(s)},ae=s=>{y(s)},re=async()=>{try{if(h==="edit"){const s=await ue(parseInt(o),d.id,N);s.code===200?l.success({description:"更新团队信息成功"}):l.danger({description:s.msg||"更新团队信息失败"})}else if(h==="delete"){const s=await me(parseInt(o),d.id);s.code===200?l.success({description:"删除团队成功"}):l.danger({description:s.msg||"删除团队失败"})}else if(h==="kick"){if(!p){l.warning({description:"请选择要移出的成员"});return}const s=await pe(parseInt(o),d.id,p);s.code===200?l.success({description:"移出成员成功"}):l.danger({description:s.msg||"移出成员失败"})}c(!1),B()}catch(s){console.log(s),l.danger({description:"操作失败"})}};return e.jsx(ve,{teams:_,totalCount:b,currentPage:r,pageSize:C,teamMembers:u,loadingMembers:E,editForm:N,selectedUserId:p,showModal:T,modalMode:h,selectedTeam:d,onPageChange:S,onEditTeam:Z,onDeleteTeam:F,onKickMember:ee,onViewContainers:te,onModalClose:se,onModalSubmit:re,onFormChange:ne,onUserSelect:ae,searchQuery:$,searchResults:g,searchLoading:L,onSearchChange:Y,searchRef:R,isSearchMode:P})}export{Te as default};
